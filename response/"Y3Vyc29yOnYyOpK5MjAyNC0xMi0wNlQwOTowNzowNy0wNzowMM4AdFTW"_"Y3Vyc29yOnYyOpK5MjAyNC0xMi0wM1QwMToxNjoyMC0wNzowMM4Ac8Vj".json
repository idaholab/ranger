{
  "discussions": {
    "pageInfo": {
      "hasNextPage": true,
      "endCursor": "Y3Vyc29yOnYyOpK5MjAyNC0xMi0wM1QwMToxNjoyMC0wNzowMM4Ac8Vj"
    },
    "edges": [
      {
        "node": {
          "title": "error: \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\" and missing modules pyaml, jinja2",
          "author": {
            "login": "smpeyres"
          },
          "bodyText": "Check these boxes if you have followed the posting rules.\n\n I have consulted the Posting Guidelines.\n I have searched the Discussions Forum and MOOSE Framework Troubleshooting and have not found what I was looking for\n Q&A Getting Started is the most appropriate category for my question (trouble installing, beginner user, ...)\n\nIssue or question about MOOSE\nI am trying to compile MOOSE on Apple Silicon (M1), but I get this error on multiple occurrences after running make -j8 in tests. Seems that similar posts are trying to compile on HPC, not me. I completely removed conda and re-installed, current version is 24.9.1\nI ran diagnostics.sh, and it looks like my python is not up to date and I missing some packages like pyaml and jinja2.\nHow do I update python and update these modules and fix this error? I attached the error and diagnostic output\n(Optional) code in question / simulation log / errors\n(moose) wirelessprv-10-192-133-5:test seanpeyres$ make -j8\nWARNING: Failed to initialize PreMake for version checking; this may be ignored but may suggest an environment issue.\n\nTraceback (most recent call last):\n  File \"/Users/seanpeyres/moose-projects/moose/framework/../scripts/premake.py\", line 20, in __init__\n    from versioner import Versioner\n  File \"/Users/seanpeyres/moose-projects/moose/scripts/versioner.py\", line 25, in <module>\n    import yaml\nModuleNotFoundError: No module named 'yaml'\n\nTraceback (most recent call last):\n  File \"/Users/seanpeyres/moose-projects/moose/framework/../scripts/premake.py\", line 261, in <module>\n    PreMake().check()\n    ^^^^^^^^^\n  File \"/Users/seanpeyres/moose-projects/moose/framework/../scripts/premake.py\", line 27, in __init__\n    self.versioner_meta = Versioner().version_meta()\n                          ^^^^^^^^^\nUnboundLocalError: cannot access local variable 'Versioner' where it is not associated with a value\nmake: [/Users/seanpeyres/moose-projects/moose/framework/moose.mk:399: prebuild] Error 1 (ignored)\nCompiling C++ (in opt mode) /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/linesearches_Unity.C...\nCompiling C++ (in opt mode) /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/mesh_Unity.C...\nCompiling C++ (in opt mode) /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/fvics_Unity.C...\nCompiling C++ (in opt mode) /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/auxkernels_Unity.C...\nCompiling C++ (in opt mode) /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/kernels_Unity.C...\nCompiling C++ (in opt mode) /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/executioners_Unity.C...\nCompiling C++ (in opt mode) /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/bounds_Unity.C...\nCompiling C++ (in opt mode) /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/scalarkernels_Unity.C...\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/mesh_Unity.C:2:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/src/mesh/AnnularMesh.C:10:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/AnnularMesh.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseMesh.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseObject.h:13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseUtils.h:13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseTypes.h:26:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/libmesh/include/libmesh/petsc_macro.h:56:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petsc.h:6:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petscbag.h:3:\n/Users/seanpeyres/miniforge/envs/moose/petsc/include/petscsys.h:92:6: error: \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\n    #error \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\n     ^\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/executioners_Unity.C:2:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/src/executioners/EigenExecutionerBase.C:10:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/EigenExecutionerBase.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/Executioner.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseObject.h:13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseUtils.h:13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseTypes.h:26:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/libmesh/include/libmesh/petsc_macro.h:56:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petsc.h:6:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petscbag.h:3:\n/Users/seanpeyres/miniforge/envs/moose/petsc/include/petscsys.h:92:6: error: \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\n    #error \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\n     ^\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/kernels_Unity.C:2:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/src/kernels/ADConservativeAdvection.C:10:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/ADConservativeAdvection.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/ADKernel.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/KernelBase.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/ResidualObject.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseObject.h:13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseUtils.h:13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseTypes.h:26:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/libmesh/include/libmesh/petsc_macro.h:56:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petsc.h:6:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petscbag.h:3:\n/Users/seanpeyres/miniforge/envs/moose/petsc/include/petscsys.h:92:6: error: \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/scalarkernels_Unity.C:2:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/src/scalarkernels/ADScalarKernel.C:10:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/ADScalarKernel.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/ScalarKernelBase.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/ResidualObject.h:12    #error \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\":\n\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseObject.h     ^:\n13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseUtils.h:13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseTypes.h:26:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/libmesh/include/libmesh/petsc_macro.h:56:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petsc.h:6:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petscbag.h:3:\n/Users/seanpeyres/miniforge/envs/moose/petsc/include/petscsys.h:92:6: error: \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\n    #error \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\n     ^\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/linesearches_Unity.C:2:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/src/linesearches/LineSearch.C:10:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/LineSearch.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseObject.h:13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseUtils.h:13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseTypes.h:26:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/libmesh/include/libmesh/petsc_macro.h:56:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petsc.h:6:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petscbag.h:3:\n/Users/seanpeyres/miniforge/envs/moose/petsc/include/petscsys.h:92:6: error: \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\n    #error \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\n     ^\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/auxkernels_Unity.C:2:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/src/auxkernels/AdvectiveFluxAux.C:10:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/AdvectiveFluxAux.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/AuxKernel.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseObject.h:13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseUtils.h:13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseTypes.h:26:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/libmesh/include/libmesh/petsc_macro.h:56:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petsc.h:6:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petscbag.h:3:\n/Users/seanpeyres/miniforge/envs/moose/petsc/include/petscsys.h:92:6: error: \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\n    #error \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\n     ^\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/bounds_Unity.C:2:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/src/bounds/BoundsBase.C:10:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/BoundsBase.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/AuxKernel.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseObject.h:13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseUtils.h:13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseTypes.h:26:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/libmesh/include/libmesh/petsc_macro.h:56:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petsc.h:6:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petscbag.h:3:\n/Users/seanpeyres/miniforge/envs/moose/petsc/include/petscsys.h:92:6: error: \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\n    #error \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\n     ^\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/fvics_Unity.C:2:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/src/fvics/FVConstantIC.C:10:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/FVConstantIC.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/FVInitialConditionTempl.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/FVInitialConditionBase.h:12:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseObject.h:13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseUtils.h:13:\nIn file included from /Users/seanpeyres/moose-projects/moose/framework/build/header_symlinks/MooseTypes.h:26:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/libmesh/include/libmesh/petsc_macro.h:56:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petsc.h:6:\nIn file included from /Users/seanpeyres/miniforge/envs/moose/petsc/include/petscbag.h:3:\n/Users/seanpeyres/miniforge/envs/moose/petsc/include/petscsys.h:92:6: error: \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\n    #error \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\n     ^\n1 error generated.\nmake: *** [/Users/seanpeyres/moose-projects/moose/framework/build.mk:151: /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/linesearches_Unity.aarch64-apple-darwin20.0.0.opt.lo] Error 1\nmake: *** Waiting for unfinished jobs....\n1 error generated.\n1 error generated.\nmake: *** [/Users/seanpeyres/moose-projects/moose/framework/build.mk:151: /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/executioners_Unity.aarch64-apple-darwin20.0.0.opt.lo] Error 1\nmake: *** [/Users/seanpeyres/moose-projects/moose/framework/build.mk:151: /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/bounds_Unity.aarch64-apple-darwin20.0.0.opt.lo] Error 1\n1 error generated.\nmake: *** [/Users/seanpeyres/moose-projects/moose/framework/build.mk:151: /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/fvics_Unity.aarch64-apple-darwin20.0.0.opt.lo] Error 1\n1 error generated.\nmake: *** [/Users/seanpeyres/moose-projects/moose/framework/build.mk:151: /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/scalarkernels_Unity.aarch64-apple-darwin20.0.0.opt.lo] Error 1\n1 error generated.\nmake: *** [/Users/seanpeyres/moose-projects/moose/framework/build.mk:151: /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/kernels_Unity.aarch64-apple-darwin20.0.0.opt.lo] Error 1\n1 error generated.\nmake: *** [/Users/seanpeyres/moose-projects/moose/framework/build.mk:151: /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/mesh_Unity.aarch64-apple-darwin20.0.0.opt.lo] Error 1\n1 error generated.\nmake: *** [/Users/seanpeyres/moose-projects/moose/framework/build.mk:151: /Users/seanpeyres/moose-projects/moose/framework/build/unity_src/auxkernels_Unity.aarch64-apple-darwin20.0.0.opt.lo] Error 1\nEncountering Errors? Please include diagnostic output\n(moose) wirelessprv-10-192-133-5:scripts seanpeyres$ bash diagnostics.sh\n################################################################################\nInfluential Environment Variables\n\nCC=mpicc\nCC_FOR_BUILD=/Users/seanpeyres/miniforge/envs/moose/bin/arm64-apple-darwin20.0.0-clang\nCFLAGS= -fPIC -fstack-protector-strong  -pipe -isystem /Users/seanpeyres/miniforge/envs/moose/include \nCONDA_CHANNEL=https://conda.software.inl.gov/public\nCONDA_DEFAULT_ENV=moose\nCONDA_EXE=/Users/seanpeyres/miniforge/bin/conda\nCONDA_PREFIX=/Users/seanpeyres/miniforge/envs/moose\nCONDA_PREFIX_1=/Users/seanpeyres/miniforge\nCONDA_PROMPT_MODIFIER=(moose) \nCONDA_PYTHON_EXE=/Users/seanpeyres/miniforge/bin/python\nCONDA_SHLVL=2\nCONDA_TOOLCHAIN_BUILD=arm64-apple-darwin20.0.0\nCONDA_TOOLCHAIN_HOST=arm64-apple-darwin20.0.0\nCPPFLAGS= -isystem /Users/seanpeyres/miniforge/envs/moose/include -mmacosx-version-min=11.3 \nCURL_CA_BUNDLE=\nCXX=mpicxx\nCXXFLAGS= -fPIC -fstack-protector-strong  -pipe -stdlib=libc++ -fvisibility-inlines-hidden -fmessage-length=0 -isystem /Users/seanpeyres/miniforge/envs/moose/include  -std=c++17\nCXX_FOR_BUILD=/Users/seanpeyres/miniforge/envs/moose/bin/arm64-apple-darwin20.0.0-clang++\nF77=mpif77\nF90=mpif90\nF95=/Users/seanpeyres/miniforge/envs/moose/bin/arm64-apple-darwin20.0.0-gfortran\nFC=mpif90\nFC_FOR_BUILD=/Users/seanpeyres/miniforge/envs/moose/bin/arm64-apple-darwin20.0.0-gfortran\nFFLAGS=  -fPIC   -pipe -isystem /Users/seanpeyres/miniforge/envs/moose/include \nFI_PROVIDER=tcp\nHDF5_DIR=/Users/seanpeyres/miniforge/envs/moose\nLD=arm64-apple-darwin20.0.0-ld\nLDFLAGS=-Wl,-headerpad_max_install_names  -Wl,-rpath,/Users/seanpeyres/miniforge/envs/moose/lib -L/Users/seanpeyres/miniforge/envs/moose/lib  -Wl,-ld_classic -Wl,-commons,use_dylibs\nLDFLAGS_LD=-headerpad_max_install_names -dead_strip_dylibs -rpath /Users/seanpeyres/miniforge/envs/moose/lib -L/Users/seanpeyres/miniforge/envs/moose/lib\nLIBMESH_DIR=/Users/seanpeyres/miniforge/envs/moose/libmesh\nMOOSE_JOBS=6\nMOOSE_NO_CODESIGN=true\nPATH=/Users/seanpeyres/.cargo/bin:/Users/seanpeyres/.juliaup/bin:/opt/homebrew/bin:/Users/seanpeyres/miniforge/envs/moose/bin:/Users/seanpeyres/miniforge/condabin:/usr/local/bin:/System/Cryptexes/App/usr/bin:/usr/bin:/bin:/usr/sbin:/sbin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/local/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/bin:/var/run/com.apple.security.cryptexd/codex.system/bootstrap/usr/appleinternal/bin:/Library/TeX/texbin:/Users/seanpeyres/miniforge/envs/moose/wasp/bin\nPETSC_DIR=/Users/seanpeyres/miniforge/envs/moose/petsc\nREQUESTS_CA_BUNDLE=\nSSL_CERT_FILE=\nWASP_DIR=/Users/seanpeyres/miniforge/envs/moose/wasp\n################################################################################\nCompiler(s) (CC CXX FC F77 F90):\n\nwhich $CC; /opt/homebrew/bin/mpicc\n$CC --version; clang version 16.0.6\n$CC -show; clang -I/opt/homebrew/Cellar/open-mpi/5.0.3_1/include -L/opt/homebrew/Cellar/open-mpi/5.0.3_1/lib -lmpi\n\nwhich $CXX; /opt/homebrew/bin/mpicxx\n$CXX --version; clang version 16.0.6\n$CXX -show; clang++ -I/opt/homebrew/Cellar/open-mpi/5.0.3_1/include -L/opt/homebrew/Cellar/open-mpi/5.0.3_1/lib -lmpi\n\nwhich $FC; /opt/homebrew/bin/mpif90\n$FC --version; GNU Fortran (Homebrew GCC 14.2.0) 14.2.0\n$FC -show; gfortran -I/opt/homebrew/Cellar/open-mpi/5.0.3_1/include -Wl,-flat_namespace -Wl,-commons,use_dylibs -Wl,-ld_classic -I/opt/homebrew/Cellar/open-mpi/5.0.3_1/lib -L/opt/homebrew/Cellar/open-mpi/5.0.3_1/lib -lmpi_usempif08 -lmpi_usempi_ignore_tkr -lmpi_mpifh -lmpi\n\nwhich $F77; /opt/homebrew/bin/mpif77\n$F77 --version; GNU Fortran (Homebrew GCC 14.2.0) 14.2.0\n$F77 -show; gfortran -I/opt/homebrew/Cellar/open-mpi/5.0.3_1/include -Wl,-flat_namespace -Wl,-commons,use_dylibs -Wl,-ld_classic -I/opt/homebrew/Cellar/open-mpi/5.0.3_1/lib -L/opt/homebrew/Cellar/open-mpi/5.0.3_1/lib -lmpi_usempif08 -lmpi_usempi_ignore_tkr -lmpi_mpifh -lmpi\n\nwhich $F90; /opt/homebrew/bin/mpif90\n$F90 --version; GNU Fortran (Homebrew GCC 14.2.0) 14.2.0\n$F90 -show; gfortran -I/opt/homebrew/Cellar/open-mpi/5.0.3_1/include -Wl,-flat_namespace -Wl,-commons,use_dylibs -Wl,-ld_classic -I/opt/homebrew/Cellar/open-mpi/5.0.3_1/lib -L/opt/homebrew/Cellar/open-mpi/5.0.3_1/lib -lmpi_usempif08 -lmpi_usempi_ignore_tkr -lmpi_mpifh -lmpi\n\nOK\n################################################################################\nPython Sanity Checks\n\n/usr/bin/env python3 --version; (reporting as: Python 3.12.5) matches\nwhich python3 python;\n\n/opt/homebrew/bin/python3 --version; == Python 3.12.5\nFAIL: /Users/seanpeyres/miniforge/envs/moose/bin/python --version (reporting as Python 3.11.8)) != Python 3.12.5\n\nThis will likely result in the TestHarness failing. Or WASP/HIT parsing errors.\n################################################################################\nPython Modules (TestHarness, run-ability)\n\n\nWARNING: missing module(s): pyaml jinja2 \n\nEither install the above packages, or perhaps you have yet\nto activate the moose environment: conda activate moose\n\nMissing 'warning' Python modules may cause miscellaneous runtime issues.\n\nWARNING: One or more Python issues present.\n################################################################################\nMOOSE Repository/Conda Version Checks\n\nWARNING: Unable to run Conda tests due to missing Python modules\n\n\nchecks FAILED",
          "url": "https://github.com/idaholab/moose/discussions/28854",
          "updatedAt": "2024-12-06T00:54:17Z",
          "publishedAt": "2024-10-15T21:25:20Z",
          "category": {
            "name": "Q&A Getting Started"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "GiudGiud"
                  },
                  "bodyText": "hello\nconda install pyaml jinja2\nshould solve that problem\nthe other problem, with mpi, stems from having multiple mpi distributions installed on your system.\nYou should set CC, CXX, FC to the mpicc mpicxx and mpif90 brought in by conda.\nRight now it must be finding the compilers from your systme\nGuillaume",
                  "url": "https://github.com/idaholab/moose/discussions/28854#discussioncomment-10952751",
                  "updatedAt": "2024-10-15T21:38:44Z",
                  "publishedAt": "2024-10-15T21:38:44Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "smpeyres"
                          },
                          "bodyText": "When I run conda install pyaml jinja2, I get the following output:\nChannels:\n - https://conda.software.inl.gov/public\n - conda-forge\nPlatform: osx-arm64\nCollecting package metadata (repodata.json): done\nSolving environment: done\n\n# All requested packages already installed.\n\nWhen I run diagnostics.sh, the same error occurs.\nAny thoughts?",
                          "url": "https://github.com/idaholab/moose/discussions/28854#discussioncomment-10952857",
                          "updatedAt": "2024-10-15T21:57:07Z",
                          "publishedAt": "2024-10-15T21:56:39Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "ah so conda is well setup\nbut you homebrew python is being found instead of the conda python\n/opt/homebrew/bin/python3 --version; == Python 3.12.5\n\nsame remedy, set the PATH to find the conda python first",
                          "url": "https://github.com/idaholab/moose/discussions/28854#discussioncomment-10952903",
                          "updatedAt": "2024-10-15T22:07:07Z",
                          "publishedAt": "2024-10-15T22:07:06Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "smpeyres"
                          },
                          "bodyText": "Okay, how do I do this?\nAlso, if I set the PATH to find conda python first, will it bother anything else? For example, if I naively try brew uninstall python, it warns me that there are a handful of modules/packages (gnuplot, scipy, matplotlib, etc...) that depend on python, so it doesn't uninstall it. I don't want these modules/packages to be unable to find the conda python.",
                          "url": "https://github.com/idaholab/moose/discussions/28854#discussioncomment-10953591",
                          "updatedAt": "2024-10-16T00:39:11Z",
                          "publishedAt": "2024-10-16T00:39:11Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "You might have to switch back and forth if other packages need your brew python.\nThis is the problem with brew. It does not compartmentalize at all. With conda you can de-activate the environment if you no longer want to use it, with brew you can't",
                          "url": "https://github.com/idaholab/moose/discussions/28854#discussioncomment-10953602",
                          "updatedAt": "2024-10-16T00:42:55Z",
                          "publishedAt": "2024-10-16T00:42:54Z",
                          "isAnswer": true
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "smpeyres"
                          },
                          "bodyText": "Interesting. I have both PATH's in my bash_profile, and I just comment out the one I'm not using (in this case, brew). This seemed to work fine as make -j8 had no further issues and bash diagnostics.sh also reported that everything looked OK.\nWhen I run the tests, I get a handful of errors for controls/web_server_control:\ncontrols/web_server_control.control/bool ...................................................... FAILED (CRASH)\ncontrols/web_server_control.control/real ...................................................... FAILED (CRASH)\ncontrols/web_server_control.control/int ....................................................... FAILED (CRASH)\ncontrols/web_server_control.control/string .................................................... FAILED (CRASH)\ncontrols/web_server_control.control/vec_real .................................................. FAILED (CRASH)\ncontrols/web_server_control.control/vec_int ................................................... FAILED (CRASH)\ncontrols/web_server_control.control/vec_string ................................................ FAILED (CRASH)\ncontrols/web_server_control.get_postprocessor ................................................. FAILED (CRASH)\ncontrols/web_server_control.parallel_consistent .................................. [min_cpus=2] FAILED (CRASH)\ncontrols/web_server_control.errors/set_controllable_no_exist ................. FAILED (EXPECTED ERROR MISSING)\ncontrols/web_server_control.errors/postprocessor_no_exist .................... FAILED (EXPECTED ERROR MISSING)\ncontrols/web_server_control.errors/set_controllable_unregistered_type ........ FAILED (EXPECTED ERROR MISSING)\ncontrols/web_server_control.errors/set_controllable_bad_convert_json ......... FAILED (EXPECTED ERROR MISSING)\ncontrols/web_server_control.errors/set_controllable_vector_non_array ......... FAILED (EXPECTED ERROR MISSING)\n--------------------------------------------------------------------------------------------------------------\nRan 4446 tests in 469.0 seconds. Average test time 0.5 seconds, maximum test time 28.6 seconds.\n4432 passed, 120 skipped, 0 pending, 14 FAILED\n\nThese failures don't look like the would inhibit the use of MOOSE, but I just want to make sure I'm not missing any other crucial dependencies. Please let me know if I should open a separate discussion for this.\nBelow is an example of how it shows up during the testing sequence:\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: Working Directory: /Users/seanpeyres/moose-projects/moose/test/tests/controls/web_server_control\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: Running command: RUNAPP_COMMAND=\"/Users/seanpeyres/moose-projects/moose/test/moose_test-opt -i wait_initial.i Outputs/json/type=JSON --error --error-override --libtorch-device cpu\" /Users/seanpeyres/moose-projects/moose/test/tests/controls/web_server_control/errors.py set_controllable_bad_convert\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: MooseControl: Determined file socket /var/folders/gk/ymz0v5rs0z962fcgr2zm40pw0000gn/T/moose_control_h49yxm for communication\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: MooseControl: Spawning MOOSE with command \"['/Users/seanpeyres/moose-projects/moose/test/moose_test-opt', '-i', 'wait_initial.i', 'Outputs/json/type=JSON', '--error', '--error-override', '--libtorch-device', 'cpu', 'Controls/web_server/file_socket=/var/folders/gk/ymz0v5rs0z962fcgr2zm40pw0000gn/T/moose_control_h49yxm']\"\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: MooseControl: Waiting for the webserver to start on \"http+unix:///var/folders/gk/ymz0v5rs0z962fcgr2zm40pw0000gn/T/moose_control_h49yxm\"\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: Traceback (most recent call last):\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:   File \"/Users/seanpeyres/miniforge/envs/moose/lib/python3.11/encodings/idna.py\", line 165, in encode\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:     raise UnicodeError(\"label too long\")\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: UnicodeError: label too long\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: \ncontrols/web_server_control.errors/set_controllable_bad_convert_json: The above exception was the direct cause of the following exception:\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: \ncontrols/web_server_control.errors/set_controllable_bad_convert_json: Traceback (most recent call last):\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:   File \"/Users/seanpeyres/moose-projects/moose/test/tests/controls/web_server_control/errors.py\", line 23, in <module>\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:     base_controller('web_server', run_control)\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:   File \"/Users/seanpeyres/moose-projects/moose/test/tests/controls/web_server_control/base_controller.py\", line 29, in base_controller\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:     control.initialize()\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:   File \"/Users/seanpeyres/moose-projects/moose/python/MooseControl/MooseControl.py\", line 287, in initialize\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:     if self.isListening():\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:        ^^^^^^^^^^^^^^^^^^\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:   File \"/Users/seanpeyres/moose-projects/moose/python/MooseControl/MooseControl.py\", line 214, in isListening\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:     r = self._requests_get(f'{self._url}/check')\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:   File \"/Users/seanpeyres/moose-projects/moose/python/MooseControl/MooseControl.py\", line 143, in _requests_get\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:     return self._requests_wrapper('get', *args, **kwargs)\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:   File \"/Users/seanpeyres/moose-projects/moose/python/MooseControl/MooseControl.py\", line 139, in _requests_wrapper\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:     return getattr(accessor, function_name)(*args, **kwargs)\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:   File \"/Users/seanpeyres/miniforge/envs/moose/lib/python3.11/site-packages/requests/sessions.py\", line 602, in get\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:     return self.request(\"GET\", url, **kwargs)\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:   File \"/Users/seanpeyres/miniforge/envs/moose/lib/python3.11/site-packages/requests/sessions.py\", line 579, in request\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:     settings = self.merge_environment_settings(\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:   File \"/Users/seanpeyres/miniforge/envs/moose/lib/python3.11/site-packages/requests/sessions.py\", line 760, in merge_environment_settings\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:     env_proxies = get_environ_proxies(url, no_proxy=no_proxy)\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:   File \"/Users/seanpeyres/miniforge/envs/moose/lib/python3.11/site-packages/requests/utils.py\", line 832, in get_environ_proxies\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:     if should_bypass_proxies(url, no_proxy=no_proxy):\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:   File \"/Users/seanpeyres/miniforge/envs/moose/lib/python3.11/site-packages/requests/utils.py\", line 816, in should_bypass_proxies\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:     bypass = proxy_bypass(parsed.hostname)\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:   File \"/Users/seanpeyres/miniforge/envs/moose/lib/python3.11/urllib/request.py\", line 2660, in proxy_bypass\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:     return proxy_bypass_macosx_sysconf(host)\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:   File \"/Users/seanpeyres/miniforge/envs/moose/lib/python3.11/urllib/request.py\", line 2637, in proxy_bypass_macosx_sysconf\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:     return _proxy_bypass_macosx_sysconf(host, proxy_settings)\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:   File \"/Users/seanpeyres/miniforge/envs/moose/lib/python3.11/urllib/request.py\", line 2605, in _proxy_bypass_macosx_sysconf\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:     hostIP = socket.gethostbyname(hostonly)\ncontrols/web_server_control.errors/set_controllable_bad_convert_json:              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: UnicodeError: encoding with 'idna' codec failed (UnicodeError: label too long)\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: ################################################################################\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: \ncontrols/web_server_control.errors/set_controllable_bad_convert_json: Unable to match the following pattern against the program's output:\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: \ncontrols/web_server_control.errors/set_controllable_bad_convert_json: The value \"foo\" of JSON type string is not of the expected JSON type bool\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: \ncontrols/web_server_control.errors/set_controllable_bad_convert_json: ################################################################################\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: Tester failed, reason: EXPECTED ERROR MISSING\ncontrols/web_server_control.errors/set_controllable_bad_convert_json: \ncontrols/web_server_control.errors/set_controllable_bad_convert_json ......... FAILED (EXPECTED ERROR MISSING)",
                          "url": "https://github.com/idaholab/moose/discussions/28854#discussioncomment-10960209",
                          "updatedAt": "2024-10-16T13:40:42Z",
                          "publishedAt": "2024-10-16T13:40:42Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "you can skip that one for now, unless you are planning to use it specifically.\nit would require some modifications to get this 'label' shorter",
                          "url": "https://github.com/idaholab/moose/discussions/28854#discussioncomment-10960419",
                          "updatedAt": "2024-10-16T13:56:35Z",
                          "publishedAt": "2024-10-16T13:56:34Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "smpeyres"
                          },
                          "bodyText": "Don't plan on it, so I'll stop here. Thank you for the help!",
                          "url": "https://github.com/idaholab/moose/discussions/28854#discussioncomment-10960499",
                          "updatedAt": "2024-10-16T14:02:05Z",
                          "publishedAt": "2024-10-16T14:02:04Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "bplcn"
                  },
                  "bodyText": "Hi,\nI face the same error \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\" when install moose on M3 Mac.\n/opt/homebrew/Caskroom/miniconda/base/envs/moose/petsc/include/petscsys.h:94:6: error: \"PETSc was configured with MPICH but now appears to be compiling using a non-MPICH mpi.h\"\n\nAnd the complier of the mpi is\n$CC -show; clang -I/opt/homebrew/Cellar/open-mpi/5.0.6/include -L/opt/homebrew/Cellar/open-mpi/5.0.6/lib -lmpi\n\nHow to switch the mpi complier ? Thank you",
                  "url": "https://github.com/idaholab/moose/discussions/28854#discussioncomment-11468834",
                  "updatedAt": "2024-12-05T05:09:48Z",
                  "publishedAt": "2024-12-05T05:09:47Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "You should follow the install from source instruction on the website\nyou ll want to set environment variables CC CXX FC F77 F90",
                          "url": "https://github.com/idaholab/moose/discussions/28854#discussioncomment-11472537",
                          "updatedAt": "2024-12-05T12:18:36Z",
                          "publishedAt": "2024-12-05T12:18:34Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "it is crucial that you use the same set of compilers for petsc, libmesh and MOOSE. Any deviation will fail the build. The environment variables will help with that.\nConsidering that you are using Brew, you may have two sets of compilers (at least) on your system.",
                          "url": "https://github.com/idaholab/moose/discussions/28854#discussioncomment-11475432",
                          "updatedAt": "2024-12-05T16:14:22Z",
                          "publishedAt": "2024-12-05T16:14:22Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "bplcn"
                          },
                          "bodyText": "it is crucial that you use the same set of compilers for petsc, libmesh and MOOSE. Any deviation will fail the build. The environment variables will help with that. Considering that you are using Brew, you may have two sets of compilers (at least) on your system.\n\nFollowing you advice, I tried to uninstall the open-mpi and the problem is fixed. Thank you for your help!",
                          "url": "https://github.com/idaholab/moose/discussions/28854#discussioncomment-11479345",
                          "updatedAt": "2024-12-06T00:54:18Z",
                          "publishedAt": "2024-12-06T00:54:17Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "PorousFlowSink: libMesh error in ThreadedElementLoopBase:Assertion `i < _val.size()' failed.",
          "author": {
            "login": "jmeier"
          },
          "bodyText": "Dear Moose Community,\nI'm trying to realize a hydro-mechanical coupled simulation using the PorousFlowSink to define boundary conditions:\n\nThe boundary condition is defined on one of my model boundaries\nThe first calculation steps all is fine and Moose works as expected.\nThe moment the boundary (or parts of it) my PorousFlowSink is active on is re-assinged to an 'inactive' subdomain via a TimedSubdomainModifier, I get the following message in DBG-mode and the model will not converge:\n\nWe caught a libMesh error in ThreadedElementLoopBase:Assertion `i < _val.size()' failed.\ni = 0\n_val.size() = 0\n\n[4] /home/mjg/mambaforge3/envs/moose/libmesh/include/libmesh/dense_vector.h, line 422, compiled Nov 16 2024 at 18:32:16\n\nTo recover, the solution will fail and then be re-attempted with a reduced time step.\n\n  Nonlinear solve did not converge due to DIVERGED_FUNCTION_DOMAIN iterations 0\n Solve Did NOT Converge!\nAborting as solve did not converge\n\nOPT-mode will work as expected and the model will converge.\nI can circumvent this message (and non-convergence) in DBG-mode by deactivating the PorousFlowSink using a TimesEnableControl. But this feels a little unnecessary and adds some complexity to the model I'd like to avoid.\nFurthermore, other boundary conditions (e.g. DirichletBC) will not produce any problems even if the boundary (or parts of it) they live on is re-assigned to an 'inactive' subdomain.\nI'd tried to understand what exactly is the problem for Moose but did not succeed. It is even unclear to me if this is a problem in Moose or in libmesh.\nCould you please comment on this behaviour:\n\nIs this a problem in Moose or in libmesh?\nShould Moose avoid this message/error? I am in favour of \u2018yes\u2019. But if no, then Moose should also fail to converge in OPT-mode.\nIf Moose should avoid this message/error: What has to be changed to do so?\n\nThanks in advance!\nPlease find a simple test-model below (run-time should be fast)\ninput-file\n\nThis model will fail in DBG-mode. Uncomment the TimesEnableControl to make it converge.\n[GlobalParams]\n  displacements = 'disp_x disp_y disp_z'\n  use_displaced_mesh = false\n  PorousFlowDictator = dictator\n[]\n\nBox1_inactive_name = 'Box1_inactive'\ninactive_domain_block_names = '${Box1_inactive_name}'\n\n[Problem]\n  solve = true\n  kernel_coverage_check = SKIP_LIST\n  kernel_coverage_block_list = '${inactive_domain_block_names}'\n  material_coverage_check = SKIP_LIST\n  material_coverage_block_list = '${inactive_domain_block_names}'\n[]\n\n[Mesh]\n  [BaseMesh]\n    type = GeneratedMeshGenerator\n    subdomain_name = 'BaseMesh'\n    elem_type = 'HEX8'\n    dim = 3\n    nx = 6\n    ny = 6\n    nz = 2\n    xmin = -3\n    xmax = +3\n    ymin = -3\n    ymax = +3\n    zmin = -2\n    zmax = +2\n  []\n\n  [Box1]\n    type = SubdomainBoundingBoxGenerator\n    block_name = 'Box1'\n    input = \"BaseMesh\"\n    block_id = 1\n    location = \"INSIDE\"\n    bottom_left = \"-1.0 -1.0 -0.0\"\n    top_right = \"+1.0 +1.0 +2.0\"\n  []\n\n  add_subdomain_names = '${inactive_domain_block_names}'\n  active_block_names = 'BaseMesh Box1'\n[]\n\n[Variables]\n  [disp_x]\n    block = '${Mesh/active_block_names}'\n  []\n  [disp_y]\n    block = '${Mesh/active_block_names}'\n  []\n  [disp_z]\n    block = '${Mesh/active_block_names}'\n  []\n  [porepressure]\n    scaling = 1e-5\n    block = '${Mesh/active_block_names}'\n  []\n[]\n\n[Physics]\n  [SolidMechanics]\n    [QuasiStatic]\n      [all]\n        strain = SMALL\n        incremental = true\n        add_variables = false\n        generate_output = 'stress_xx stress_yy stress_zz'\n        block = 'BaseMesh Box1'\n      []\n    []\n  []\n[]\n\n# ===== Kernels: PorousFlow =====\n[Kernels]\n  [mass0]\n    type = PorousFlowMassTimeDerivative\n    block = '${Mesh/active_block_names}'\n    fluid_component = 0\n    variable = porepressure\n  []\n  [flux]\n    type = PorousFlowFullySaturatedDarcyFlow\n    block = '${Mesh/active_block_names}'\n    variable = porepressure\n    gravity = '0 0 0'\n    fluid_component = 0\n  []\n  [poro_vol_exp]\n    type = PorousFlowMassVolumetricExpansion\n    block = '${Mesh/active_block_names}'\n    variable = porepressure\n    fluid_component = 0\n  []\n[]\n\n[UserObjects]\n  [dictator]\n    type = PorousFlowDictator\n    porous_flow_vars = 'porepressure disp_x disp_y disp_z'\n    number_fluid_phases = 1\n    number_fluid_components = 1\n  []\n[]\n\n[FluidProperties]\n  [simple_fluid]\n    type = SimpleFluidProperties\n    bulk_modulus = 2E3\n    density0 = 1000\n    thermal_expansion = 0\n    viscosity = 9.0E-10 #MPas -2.1e-12 * exp(1808/T) --> T = 298\n  []\n[]\n\n[AuxVariables]\n  [dummy]\n    type = MooseVariableFVReal\n  []\n[]\n\n# fix the lower model boundary in y and z direction\n[BCs]\n  [back_fix_y]\n    type = DirichletBC\n    variable = disp_y\n    boundary = 'back'\n    value = 0.0\n  []\n  [back_fix_z]\n    type = DirichletBC\n    variable = disp_z\n    boundary = 'back'\n    value = 0.0\n  []\n[]\n\n# fix the left model boundary in x direction\n[BCs]\n  [left_fix_x]\n    type = DirichletBC\n    variable = disp_x\n    boundary = 'left'\n    value = 0.0\n  []\n[]\n\n# put some pressure on the right model boundary\n[BCs]\n  [right_Dirichlet]\n    type = FunctionDirichletBC\n    variable = disp_x\n    boundary = 'right'\n    function = right_pressure_function\n  []\n[]\n[Functions]\n  [right_pressure_function]\n    type = ParsedFunction\n    expression = '-0.001 * t'\n  []\n[]\n\n# PorousFlowSink at 'front'\n[BCs]\n  [front_pfs]\n    type = PorousFlowSink\n    boundary = 'front'\n    variable = 'porepressure'\n    flux_function = 0.0\n  []\n[]\n# [Times]\n#   [times_on]\n#     type = InputTimes\n#     times = '0.2'\n#   []\n# []\n# [Controls]\n#   [times]\n#     type = TimesEnableControl\n#     times = times_on\n#     disable_objects = 'BCs::front_pfs'\n#     execute_on = 'INITIAL TIMESTEP_BEGIN'\n#   []\n# []\n\n# Material: Volume Elements\n[Materials]\n\n  [elasticity_tensor]\n    type = ComputeIsotropicElasticityTensor\n    block = 'BaseMesh Box1'\n    youngs_modulus = 1e6\n    poissons_ratio = 0.25\n  []\n\n  [stress]\n    type = ComputeFiniteStrainElasticStress\n    block = 'BaseMesh Box1'\n  []\n\n\n  [temperature]\n    type = PorousFlowTemperature\n    block = '${Mesh/active_block_names}'\n  []\n  [eff_fluid_pressure]\n    type = PorousFlowEffectiveFluidPressure\n    block = '${Mesh/active_block_names}'\n  []\n  [vol_strain]\n    type = PorousFlowVolumetricStrain\n    block = '${Mesh/active_block_names}'\n  []\n  [ppss]\n    type = PorousFlow1PhaseFullySaturated\n    porepressure = 'porepressure'\n    block = '${Mesh/active_block_names}'\n  []\n\n  [massfrac]\n    type = PorousFlowMassFraction\n    block = '${Mesh/active_block_names}'\n  []\n  [simple_fluid]\n    type = PorousFlowSingleComponentFluid\n    fp = simple_fluid\n    phase = 0\n    block = '${Mesh/active_block_names}'\n  []\n\n  [porosity_bulk]\n    type = PorousFlowPorosity\n    fluid = true\n    mechanical = true\n    ensure_positive = true\n    porosity_zero = 0.11\n    solid_bulk = 1.3333E10\n    block = '${Mesh/active_block_names}'\n  []\n\n  [undrained_density_0]\n    type = GenericConstantMaterial\n    block = '${Mesh/active_block_names}'\n    prop_names = density\n    prop_values = 2500\n  []\n\n  [permeability]\n    type = PorousFlowPermeabilityConst\n    permeability = '1.1 0 0 0 1.1 0 0 0 1.1'\n  []\n\n[]\n\n# move elements between subdomains back and forth\n[MeshModifiers]\n  [GlobalSubdomainModifier]\n    type = TimedSubdomainModifier\n    times = '0.2'\n    blocks_from = 'Box1'\n    blocks_to = 'Box1_inactive'\n    execute_on = 'INITIAL TIMESTEP_BEGIN'\n  []\n[]\n\n[Preconditioning]\n  [.\\SMP]\n    type = SMP\n    full = true\n  []\n[]\n\n[Executioner]\n  type = Transient\n\n  end_time = 1.0\n  dtmin = 0.001\n  [TimeSteppers]\n    [BlockEventTimeStepper]\n      type = TimeSequenceStepper\n      time_sequence = '0.05 0.1 0.2 0.4 1.0'\n    []\n  []\n\n  solve_type = 'PJFNK'\n  petsc_options = '-snes_converged_reason'\n  petsc_options_iname = '-pc_type -pc_factor_mat_solver_package'\n  petsc_options_value = ' lu       mumps'\n\n  l_tol = 1E-5\n  l_max_its = 20\n\n  nl_abs_tol = 1E-3\n  nl_rel_tol = 1e-7\n  nl_max_its = 20\n[]\n\n[Outputs]\n  exodus = true\n[]\n\nThe stack trace from bdg looks like:\nTime Step 3, time = 0.2, dt = 0.1\n\nThread 1 \"shale-dbg\" hit Catchpoint 2 (exception thrown), __cxxabiv1::__cxa_throw (obj=0x555556adc420, tinfo=0x7ffff7fb73c8 <typeinfo for libMesh::LogicError>, dest=0x7ffff45470c2 <libMesh::LogicError::~LogicError()>) at ../../../../libstdc++-v3/libsupc++/eh_throw.cc:80\n80      in ../../../../libstdc++-v3/libsupc++/eh_throw.cc\n(gdb) bt\n#0  __cxxabiv1::__cxa_throw (obj=0x555556adc420, tinfo=0x7ffff7fb73c8 <typeinfo for libMesh::LogicError>, dest=0x7ffff45470c2 <libMesh::LogicError::~LogicError()>)\n    at ../../../../libstdc++-v3/libsupc++/eh_throw.cc:80\n#1  0x00007ffff450116a in libMesh::DenseVector<double>::operator() (this=0x5555565b3828, i=0) at /home/mjg/mambaforge3/envs/moose/libmesh/include/libmesh/dense_vector.h:422\n#2  0x00007ffff5842cd8 in IntegratedBC::computeResidual (this=0x5555565b3440) at /home/mjg/projects/moose/framework/src/bcs/IntegratedBC.C:94\n#3  0x00007ffff5c45ee1 in ComputeResidualThread::compute (this=0x7fffffff87a0, ro=...) at /home/mjg/projects/moose/framework/src/loops/ComputeResidualThread.C:36\n#4  0x00007ffff5c4d448 in NonlinearThread::compute (this=0x7fffffff87a0, bc=...) at /home/mjg/projects/moose/framework/src/loops/NonlinearThread.C:281\n#5  0x00007ffff5c4cb46 in NonlinearThread::computeOnBoundary (this=0x7fffffff87a0, bnd_id=5) at /home/mjg/projects/moose/framework/src/loops/NonlinearThread.C:180\n#6  0x00007ffff5c4c9d6 in NonlinearThread::onBoundary (this=0x7fffffff87a0, elem=0x555555f98990, side=5, bnd_id=5, lower_d_elem=0x0)\n    at /home/mjg/projects/moose/framework/src/loops/NonlinearThread.C:164\n#7  0x00007ffff5c68116 in ThreadedElementLoopBase<libMesh::StoredRange<libMesh::MeshBase::const_element_iterator, libMesh::Elem const*> >::operator() (this=0x7fffffff87a0, range=..., \n    bypass_threading=false) at /home/mjg/projects/moose/framework/build/header_symlinks/ThreadedElementLoopBase.h:277\n#8  0x00007ffff5c4bf14 in NonlinearThread::operator() (this=0x7fffffff87a0, range=..., bypass_threading=false) at /home/mjg/projects/moose/framework/src/loops/NonlinearThread.C:60\n#9  0x00007ffff596e80f in libMesh::Threads::parallel_reduce<libMesh::StoredRange<libMesh::MeshBase::const_element_iterator, libMesh::Elem const*>, ComputeResidualThread> (range=..., body=...)\n    at /home/mjg/mambaforge3/envs/moose/libmesh/include/libmesh/threads_pthread.h:367\n#10 0x00007ffff5931661 in NonlinearSystemBase::computeResidualInternal (this=0x5555560053e0, tags=...) at /home/mjg/projects/moose/framework/src/systems/NonlinearSystemBase.C:1735\n#11 0x00007ffff5928b22 in NonlinearSystemBase::computeResidualTags (this=0x5555560053e0, tags=...) at /home/mjg/projects/moose/framework/src/systems/NonlinearSystemBase.C:826\n#12 0x00007ffff6392c82 in FEProblemBase::computeResidualTags (this=0x555555fd79e0, tags=...) at /home/mjg/projects/moose/framework/src/problems/FEProblemBase.C:7002\n#13 0x00007ffff638fef7 in FEProblemBase::computeResidualInternal (this=0x555555fd79e0, soln=..., residual=..., tags=...) at /home/mjg/projects/moose/framework/src/problems/FEProblemBase.C:6842\n#14 0x00007ffff638e27a in FEProblemBase::computeResidual (this=0x555555fd79e0, soln=..., residual=..., nl_sys_num=0) at /home/mjg/projects/moose/framework/src/problems/FEProblemBase.C:6646\n#15 0x00007ffff638ddad in FEProblemBase::computeResidualSys (this=0x555555fd79e0, sys=..., soln=..., residual=...) at /home/mjg/projects/moose/framework/src/problems/FEProblemBase.C:6617\n#16 0x00007ffff59121bb in ComputeResidualFunctor::residual (this=0x555556006cd8, soln=..., residual=..., sys=...) at /home/mjg/projects/moose/framework/src/systems/ComputeResidualFunctor.C:27\n#17 0x00007fffe9339337 in libmesh_petsc_snes_residual () from /home/mjg/mambaforge3/envs/moose/libmesh/lib/libmesh_dbg.so.0\n#18 0x00007fffe1f3e3a1 in SNESComputeFunction () from /home/mjg/mambaforge3/envs/moose/petsc/lib/libpetsc.so.3.21\n#19 0x00007fffe1f18481 in SNESSolve_NEWTONLS () from /home/mjg/mambaforge3/envs/moose/petsc/lib/libpetsc.so.3.21\n#20 0x00007fffe1f46065 in SNESSolve () from /home/mjg/mambaforge3/envs/moose/petsc/lib/libpetsc.so.3.21\n#21 0x00007fffe9340d9e in libMesh::PetscNonlinearSolver<double>::solve(libMesh::SparseMatrix<double>&, libMesh::NumericVector<double>&, libMesh::NumericVector<double>&, double, unsigned int) ()\n   from /home/mjg/mambaforge3/envs/moose/libmesh/lib/libmesh_dbg.so.0\n#22 0x00007fffe93de6a8 in libMesh::NonlinearImplicitSystem::solve() () from /home/mjg/mambaforge3/envs/moose/libmesh/lib/libmesh_dbg.so.0\n#23 0x00007ffff591e7d0 in NonlinearSystem::solve (this=0x5555560053e0) at /home/mjg/projects/moose/framework/src/systems/NonlinearSystem.C:197\n#24 0x00007ffff63840a5 in FEProblemBase::solve (this=0x555555fd79e0, nl_sys_num=0) at /home/mjg/projects/moose/framework/src/problems/FEProblemBase.C:6208\n#25 0x00007ffff5b3bbfa in FEProblemSolve::solve (this=0x5555560606c8) at /home/mjg/projects/moose/framework/src/executioners/FEProblemSolve.C:294\n#26 0x00007ffff5b41126 in FixedPointSolve::solveStep (this=0x555556060d10, begin_norm=@0x5555567da990: 0, end_norm=@0x5555567e8a60: 0, transformed_dofs=...)\n    at /home/mjg/projects/moose/framework/src/executioners/FixedPointSolve.C:439\n#27 0x00007ffff5b3ffb2 in FixedPointSolve::solve (this=0x555556060d10) at /home/mjg/projects/moose/framework/src/executioners/FixedPointSolve.C:291\n#28 0x00007ffff4edd150 in TimeStepper::step (this=0x555556122b40) at /home/mjg/projects/moose/framework/src/timesteppers/TimeStepper.C:168\n#29 0x00007ffff4edb22b in TimeSequenceStepperBase::step (this=0x555556122b40) at /home/mjg/projects/moose/framework/src/timesteppers/TimeSequenceStepperBase.C:124\n#30 0x00007ffff5b503f6 in Transient::takeStep (this=0x555556060310, input_dt=-1) at /home/mjg/projects/moose/framework/src/executioners/Transient.C:418\n#31 0x00007ffff5b4ee76 in Transient::execute (this=0x555556060310) at /home/mjg/projects/moose/framework/src/executioners/Transient.C:293\n#32 0x00007ffff65a9794 in MooseApp::executeExecutioner (this=0x555555946ae0) at /home/mjg/projects/moose/framework/src/base/MooseApp.C:1180\n#33 0x00007ffff65b0b64 in MooseApp::run (this=0x555555946ae0) at /home/mjg/projects/moose/framework/src/base/MooseApp.C:1562\n#34 0x0000555555558e94 in Moose::main<shaleTestApp> (argc=3, argv=0x7fffffffbf28) at /home/mjg/projects/moose/framework/build/header_symlinks/MooseMain.h:47\n#35 0x00005555555586fd in main (argc=3, argv=0x7fffffffbf28) at /home/mjg/projects/shale/src/main.C:17\n\n\n \nPS: here a similar error is described #9659",
          "url": "https://github.com/idaholab/moose/discussions/29131",
          "updatedAt": "2024-12-06T00:49:24Z",
          "publishedAt": "2024-11-25T11:12:52Z",
          "category": {
            "name": "Q&A Modules: Porous Flow"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "jmeier"
                  },
                  "bodyText": "I've seen that in my test-model above the error seems to be triggered in line 94 of IntegratedBC.C:\n\n  \n    \n      moose/framework/src/bcs/IntegratedBC.C\n    \n    \n        Lines 90 to 95\n      in\n      37b999b\n    \n  \n  \n    \n\n        \n          \n           for (_qp = 0; _qp < _qrule->n_points(); _qp++) \n        \n\n        \n          \n           { \n        \n\n        \n          \n             precalculateQpResidual(); \n        \n\n        \n          \n             for (_i = 0; _i < _test.size(); _i++) \n        \n\n        \n          \n               _local_re(_i) += _JxW[_qp] * _coord[_qp] * computeQpResidual(); \n        \n\n        \n          \n           } \n        \n    \n  \n\n\nHere, _test.size() returns 8 while _local_re.size() is 0. Would it be an option to change line 93 from\nfor (_i = 0; _i < _test.size(); _i++)\nto\nfor (_i = 0; _i < _local_re.size(); _i++)\n?\nSimilar are ...\n... line 117 + 118\n\n  \n    \n      moose/framework/src/bcs/IntegratedBC.C\n    \n    \n        Lines 116 to 120\n      in\n      37b999b\n    \n  \n  \n    \n\n        \n          \n             precalculateQpJacobian(); \n        \n\n        \n          \n             for (_i = 0; _i < _test.size(); _i++) \n        \n\n        \n          \n               for (_j = 0; _j < _phi.size(); _j++) \n        \n\n        \n          \n                 _local_ke(_i, _j) += _JxW[_qp] * _coord[_qp] * computeQpJacobian(); \n        \n\n        \n          \n           } \n        \n    \n  \n\n\n... line 161 + 162\n\n  \n    \n      moose/framework/src/bcs/IntegratedBC.C\n    \n    \n        Lines 158 to 164\n      in\n      37b999b\n    \n  \n  \n    \n\n        \n          \n           for (_qp = 0; _qp < _qrule->n_points(); _qp++) \n        \n\n        \n          \n           { \n        \n\n        \n          \n             precalculateQpOffDiagJacobian(jvar); \n        \n\n        \n          \n             for (_i = 0; _i < _test.size(); _i++) \n        \n\n        \n          \n               for (_j = 0; _j < phi_size; _j++) \n        \n\n        \n          \n                 _local_ke(_i, _j) += _JxW[_qp] * _coord[_qp] * computeQpOffDiagJacobian(jvar_num); \n        \n\n        \n          \n           } \n        \n    \n  \n\n\n... line 176\n\n  \n    \n      moose/framework/src/bcs/IntegratedBC.C\n    \n    \n        Lines 175 to 178\n      in\n      37b999b\n    \n  \n  \n    \n\n        \n          \n           for (_qp = 0; _qp < _qrule->n_points(); _qp++) \n        \n\n        \n          \n             for (_i = 0; _i < _test.size(); _i++) \n        \n\n        \n          \n               for (_j = 0; _j < jv.order(); _j++) \n        \n\n        \n          \n                 _local_ke(_i, _j) += _JxW[_qp] * _coord[_qp] * computeQpOffDiagJacobianScalar(jvar);",
                  "url": "https://github.com/idaholab/moose/discussions/29131#discussioncomment-11372275",
                  "updatedAt": "2024-11-25T13:00:07Z",
                  "publishedAt": "2024-11-25T13:00:06Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "Would it be an option to change line 93 from\n\nIt's not. We need to get every test function to contribute to the residual. Why the residual is size 0 is a mystery for now\nThanks for sharing an input, we'll investigate",
                          "url": "https://github.com/idaholab/moose/discussions/29131#discussioncomment-11372897",
                          "updatedAt": "2024-11-25T13:58:14Z",
                          "publishedAt": "2024-11-25T13:58:13Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "jmeier"
                          },
                          "bodyText": "Could it be that the IntegratedBC didn't get the memo that the mesh had changed?",
                          "url": "https://github.com/idaholab/moose/discussions/29131#discussioncomment-11392718",
                          "updatedAt": "2024-11-27T09:37:23Z",
                          "publishedAt": "2024-11-27T09:37:23Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "@lindsayad seems the kernels return early from computeQpResidual when they have no vector tags. When is that case relevant?\nI see the commit you added this to was for LSC studies. Were you using kernels that dont contribute to the residual then?\nIt seems to be what's happening to this integrated BC. No vector tags, so local_re gets resized to 0, then crash\nEDIT not the case here, there is a tag",
                          "url": "https://github.com/idaholab/moose/discussions/29131#discussioncomment-11400308",
                          "updatedAt": "2024-11-28T01:08:13Z",
                          "publishedAt": "2024-11-28T00:22:50Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "so the problem is the residual block which is of size 0, this size ends up being used for _local_re in the TaggingInterface",
                          "url": "https://github.com/idaholab/moose/discussions/29131#discussioncomment-11400352",
                          "updatedAt": "2024-11-28T00:33:12Z",
                          "publishedAt": "2024-11-28T00:33:12Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "so I guess the question is, what does it mean to a residual block size of 0 for a variable?",
                          "url": "https://github.com/idaholab/moose/discussions/29131#discussioncomment-11400953",
                          "updatedAt": "2024-11-28T01:08:02Z",
                          "publishedAt": "2024-11-28T01:08:01Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "lindsayad"
                          },
                          "bodyText": "that the dof_indices are of size 0, which sounds like it makes sense if you're on an inactive subdomain",
                          "url": "https://github.com/idaholab/moose/discussions/29131#discussioncomment-11442115",
                          "updatedAt": "2024-12-02T23:28:18Z",
                          "publishedAt": "2024-12-02T23:28:18Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "when the boundary condition gets activated, after the subdomain change, is the whole boundary covered by a subdomain on which the variable is defined? Or just part of it / parts of it are next to an inactive subdomain?",
                          "url": "https://github.com/idaholab/moose/discussions/29131#discussioncomment-11456483",
                          "updatedAt": "2024-12-04T03:33:06Z",
                          "publishedAt": "2024-12-04T03:33:04Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "jmeier"
                          },
                          "bodyText": "I'm not sure I understand the last question. I'll try to answer:\nIn the example attached in my initial post above, the BC is active from the beginning (t=0). The BC covers all of the model boundary at z=+2 (this boundary is named \"front\") as shown with the magenta dots in the image below.\n\nAt t=0.2 the GlobalSubdomainModifier re-assignes all elements of the subdomain \"Box1\" shown in red above to an 'inactive' subdomain \"Box1_inactive\". This is the moment, Moose will show the error reported.",
                          "url": "https://github.com/idaholab/moose/discussions/29131#discussioncomment-11459150",
                          "updatedAt": "2024-12-04T09:42:04Z",
                          "publishedAt": "2024-12-04T09:42:04Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "ok this makes sense now!\nWe need the boundary condition to not be defined on any boundary next to this inactive block anymore.\nThe easiest way is to modify the boundary at the same time as the block.",
                          "url": "https://github.com/idaholab/moose/discussions/29131#discussioncomment-11463333",
                          "updatedAt": "2024-12-04T16:01:42Z",
                          "publishedAt": "2024-12-04T16:01:40Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "jmeier"
                          },
                          "bodyText": "We need the boundary condition to not be defined\non any boundary next to this inactive block anymore.\nThe easiest way is to modify the boundary at the same time as the block.\n\nThe input file in the initial post uses a controller on the BC for this purpose (commented out to show the error).\nThe motivation of this discussion is to avoid those additional controller-blocks in the input file. Other boundary conditions (e.g. DirichletBC) will not produce any problems even if the boundary (or parts of it) they live on is re-assigned to an 'inactive' subdomain. It would be great it we can change the behaviour of IntegratedBC etc. to allow this.",
                          "url": "https://github.com/idaholab/moose/discussions/29131#discussioncomment-11469251",
                          "updatedAt": "2024-12-05T06:22:11Z",
                          "publishedAt": "2024-12-05T06:22:11Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "Why  I use automatic_scaling, Convergence is worse?",
          "author": {
            "login": "wangzhaohao"
          },
          "bodyText": "Check these boxes if you have followed the posting rules.\n\n Q&A General is the most appropriate section for my question\n I have consulted the posting Guidelines on the Discussions front page\n I have searched the Discussions forum and my question has not been asked before\n I have searched the MOOSE website and the documentation does not answer my question\n I have formatted my post following the posting guidelines (screenshots as a last resort, triple back quotes around pasted text)\n\nQuestion\nHello, MOOSE developers.\nI am going to use SUPG Method in a diffusion-advection problem. when I code this, follwing is the PDE.\n$$\\rho C \\frac{\\partial T}{\\partial t} - \\nabla \\cdot (k \\nabla T) - q = 0$$\n$$\\frac{\\partial p}{\\partial t} + \\nabla \\cdot [(1 - p) p \\vec{v} - \\nu \\nabla p] = 0$$\n$$0 = \\rho \\cdot \\Delta$$\nSo my Input file is\n[GlobalParams]\n  coord_type = RZ\n  displacements = 'disp_x'\n[]\n\n[Mesh]\n  [square]\n    type = GeneratedMeshGenerator\n    dim = 1\n    nx = 50\n    xmax = 2.675e-3\n  []\n[]\n\n[Variables]\n  [disp_x]\n  []\n  [scalar_strain_yy]\n    order = FIRST\n    family = SCALAR\n  []\n  [temp]\n    order = FIRST\n    family = LAGRANGE\n    initial_condition = 300\n  []\n  [porosity]\n    initial_condition = 0.15\n  []\n[]\n\n[AuxVariables]\n  [disp_z]\n  []\n  [velocity]\n    family = MONOMIAL_VEC\n    order = FIRST\n  []\n  [grad_temp_x]\n    family = MONOMIAL\n    order = CONSTANT\n  []\n[]\n\n[AuxKernels]\n  [velocity]\n    type = PoreVelocityAux\n    variable = velocity\n    temperature = temp\n    plutonium_concentration = 0\n  []\n  [grad_temp_x]\n    type = VariableGradientComponent\n    variable = grad_temp_x\n    component = x\n    gradient_variable = temp\n  []\n[]\n\n[Postprocessors]\n  [react_z]\n    type = MaterialTensorIntegral\n    rank_two_tensor = stress\n    index_i = 2\n    index_j = 2\n  []\n[]\n\n[Kernels]\n  inactive = 'heatsourceconst'\n  [heatconduction]\n    type = HeatConduction\n    variable = temp\n  []\n  [heatsourceconst]\n    type = HeatSource\n    function = source_fun\n    variable = temp\n  []\n  [heatsource]\n    type = OxidalHeatSource\n    function = source_fun\n    porosity = porosity\n    porosity_initial = 0.15\n    variable = temp\n  []\n  [heatconductiontimederivative]\n    type = HeatConductionTimeDerivative\n    specific_heat = 120\n    variable = temp\n  []\n\n  [porositymigration]\n    type = PoreMigration\n    variable = porosity\n    temperature = temp\n    plutonium_concentration = 0\n  []\n  [porosityadvectionSUPG]\n    type = PoreAdvectionSUPG\n    temperature = temp\n    variable = porosity\n    plutonium_concentration = 0\n  []\n  [poretimederivative]\n    type = TimeDerivative\n    variable = porosity\n  []\n  [porositytimederivativeSUPG]\n    type = PoreTimeDerivativeSUPG\n    temperature = temp\n    variable = porosity\n  []\n[]\n\n[Physics]\n\n  [SolidMechanics]\n\n    [QuasiStatic]\n      [all]\n        strain = SMALL\n        incremental = true\n        generate_output = 'stress_xx stress_xy stress_yy stress_zz strain_xx strain_xy strain_yy strain_zz'\n        planar_formulation = GENERALIZED_PLANE_STRAIN\n        eigenstrain_names = eigenstrain\n        scalar_out_of_plane_strain = scalar_strain_yy\n        temperature = temp\n        out_of_plane_direction = z\n      []\n    []\n  []\n[]\n\n[Functions]\n  [temp_bc]\n    type = PiecewiseLinear\n    xy_data = '0 0.63e3\n              1e4 1.3e3'\n  []\n  [pressure_bc]\n    type = PiecewiseLinear\n    xy_data = '0 0.2e6\n              1e4 0.4e6'\n  []\n  [source_fun]\n    type = PiecewiseLinear\n    xy_data = '0 0\n              1e4 2.2253216e9' #5e4W/m\n  []\n[]\n\n[BCs]\n  [bottomx]\n    type = DirichletBC\n    boundary = 0\n    variable = disp_x\n    value = 0.0\n  []\n  [temp]\n    type = FunctionDirichletBC\n    variable = temp\n    boundary = 1\n    function = temp_bc\n  []\n  [outpressure]\n    type = Pressure\n    boundary = 1\n    variable = disp_x\n    function = pressure_bc\n  []\n[]\n\n[Materials]\n  [elastic_tensor]\n    type = ComputeIsotropicElasticityTensor\n    poissons_ratio = 0.345\n    youngs_modulus = 200e9\n  []\n  [thermal_strain]\n    type = ComputeThermalExpansionEigenstrain\n    temperature = temp\n    thermal_expansion_coeff = 1e-6\n    stress_free_temperature = 300\n    eigenstrain_name = eigenstrain\n  []\n  [stress]\n    type = ComputeStrainIncrementBasedStress\n  []\n  [density]\n    type = Density\n    density = 1.0662e4\n  []\n  [mamox]\n    type = MAMOXThermal\n    temperature = temp\n    porosity = porosity\n  []\n[]\n\n[Preconditioning]\n  [smp]\n    type = SMP\n    full = true\n  []\n[]\n\n[Executioner]\n  type = Transient\n\n  solve_type = PJFNK\n  line_search = none\n  petsc_options_iname = '-pc_type'\n  petsc_options_value = 'lu'\n\n  automatic_scaling = true\n  scaling_group_variables = 'disp_x; temp; porosity'\n\n  # controls for linear iterations\n  l_max_its = 100\n  l_tol = 1e-4\n\n  # controls for nonlinear iterations\n  nl_max_its = 15\n  nl_rel_tol = 1e-5\n  nl_abs_tol = 1e-5\n\n  # time control\n  start_time = 0.0\n  dt = 40\n  dtmin = 1.0\n  end_time = 1e4\n  num_steps = 5000\n[]\n\n[Outputs]\n  [exodus]\n    type = Exodus\n    output_material_properties = true\n    show_material_properties = 'thermal_conductivity'\n  []\n[]\n\nIf I don't use the   automatic_scaling = true scaling_group_variables = 'disp_x; temp; porosity', the residual in the last step is like this\nTime Step 251, time = 10000, dt = 20\n 0 Nonlinear |R| = 1.028307e+04\n      0 Linear |R| = 1.028307e+04\n      1 Linear |R| = 8.921250e+02\n      2 Linear |R| = 2.291096e+01\n      3 Linear |R| = 1.745521e+01\n      4 Linear |R| = 1.601492e+01\n      5 Linear |R| = 9.808384e+00\n      6 Linear |R| = 9.610114e+00\n      7 Linear |R| = 6.457256e+00\n      8 Linear |R| = 5.269686e+00\n      9 Linear |R| = 3.571940e+00\n     10 Linear |R| = 3.205730e+00\n     11 Linear |R| = 2.177902e+00\n     12 Linear |R| = 2.091932e+00\n     13 Linear |R| = 1.138776e+00\n     14 Linear |R| = 1.097427e+00\n     15 Linear |R| = 8.563212e-01\n 1 Nonlinear |R| = 9.580684e+00\n      0 Linear |R| = 9.580684e+00\n      1 Linear |R| = 9.301138e+00\n      2 Linear |R| = 9.300915e+00\n      3 Linear |R| = 9.170254e+00\n      4 Linear |R| = 7.566562e+00\n      5 Linear |R| = 7.185175e+00\n      6 Linear |R| = 4.388656e+00\n      7 Linear |R| = 4.386418e+00\n      8 Linear |R| = 2.456251e+00\n      9 Linear |R| = 1.690797e+00\n     10 Linear |R| = 1.272286e+00\n     11 Linear |R| = 1.221710e+00\n     12 Linear |R| = 1.213552e+00\n     13 Linear |R| = 4.786498e-01\n     14 Linear |R| = 4.148035e-01\n     15 Linear |R| = 2.105089e-01\n     16 Linear |R| = 2.104989e-01\n     17 Linear |R| = 1.100865e-01\n     18 Linear |R| = 8.341243e-02\n     19 Linear |R| = 4.653824e-02\n     20 Linear |R| = 2.011911e-02\n     21 Linear |R| = 1.194144e-02\n     22 Linear |R| = 7.006019e-03\n     23 Linear |R| = 6.637877e-03\n     24 Linear |R| = 4.550686e-03\n     25 Linear |R| = 2.480034e-03\n     26 Linear |R| = 1.546153e-03\n     27 Linear |R| = 7.928538e-04\n 2 Nonlinear |R| = 1.277763e+00\n      0 Linear |R| = 1.277763e+00\n      1 Linear |R| = 1.187731e+00\n      2 Linear |R| = 1.169138e+00\n      3 Linear |R| = 8.000056e-01\n      4 Linear |R| = 5.099548e-01\n      5 Linear |R| = 5.094007e-01\n      6 Linear |R| = 2.483796e-01\n      7 Linear |R| = 2.460117e-01\n      8 Linear |R| = 1.194662e-01\n      9 Linear |R| = 1.133298e-01\n     10 Linear |R| = 4.650997e-02\n     11 Linear |R| = 3.583607e-02\n     12 Linear |R| = 1.449329e-02\n     13 Linear |R| = 1.068608e-02\n     14 Linear |R| = 6.163695e-03\n     15 Linear |R| = 6.135168e-03\n     16 Linear |R| = 2.384477e-03\n     17 Linear |R| = 2.370099e-03\n     18 Linear |R| = 1.001684e-03\n     19 Linear |R| = 9.856626e-04\n     20 Linear |R| = 4.689908e-04\n     21 Linear |R| = 3.381278e-04\n     22 Linear |R| = 1.462069e-04\n     23 Linear |R| = 6.179482e-05\n 3 Nonlinear |R| = 6.335172e-02\n Solve Converged!\n\nOutlier Variable Residual Norms:\n  disp_x: 6.335137e-02\n\nbut when i used\nFramework Information:\nMOOSE Version:           git commit 2e75e9d1e3 on 2024-11-26\nLibMesh Version:         \nPETSc Version:           3.22.1\nSLEPc Version:           3.22.1\nCurrent Time:            Mon Dec  2 11:27:08 2024\nExecutable Timestamp:    Sun Dec  1 17:13:12 2024\n\nCheckpoint:\n  Wall Time Interval:      Every 3600 s\n  User Checkpoint:         Disabled\n  # Checkpoints Kept:      2\n  Execute On:              TIMESTEP_END \n\nParallelism:\n  Num Processors:          1\n  Num Threads:             1\n\nMesh: \n  Parallel Type:           replicated\n  Mesh Dimension:          1\n  Spatial Dimension:       1\n  Nodes:                   51\n  Elems:                   50\n  Num Subdomains:          1\n\nNonlinear System:\n  Num DOFs:                154\n  Num Local DOFs:          154\n  Variables:               \"disp_x\" \"scalar_strain_yy\" { \"temp\" \"porosity\" } \n  Finite Element Types:    \"LAGRANGE\" \"SCALAR\" \"LAGRANGE\" \n  Approximation Orders:    \"FIRST\" \"FIRST\" \"FIRST\" \n\nAuxiliary System:\n  Num DOFs:                651\n  Num Local DOFs:          651\n  Variables:               \"disp_z\" \"velocity\" { \"grad_temp_x\" \"stress_xx\" \"stress_xy\" \"stress_yy\" \"stress_zz\" \n                             \"strain_xx\" \"strain_xy\" \"strain_yy\" \"strain_zz\" \"thermal_conductivity\" } \n  Finite Element Types:    \"LAGRANGE\" \"MONOMIAL_VEC\" \"MONOMIAL\" \n  Approximation Orders:    \"FIRST\" \"FIRST\" \"CONSTANT\" \n\nExecution Information:\n  Executioner:             Transient\n  TimeStepper:             ConstantDT\n  TimeIntegrator(s):       ImplicitEuler\n  Solver Mode:             Preconditioned JFNK\n  PETSc Preconditioner:    lu \n  MOOSE Preconditioner:    SMP\n\n\nTime Step 0, time = 0\n\nPostprocessor Values:\n+----------------+----------------+\n| time           | react_z        |\n+----------------+----------------+\n|   0.000000e+00 |   0.000000e+00 |\n+----------------+----------------+\n\n\nScalar Variable Values:\n+----------------+------------------+\n| time           | scalar_strain_yy |\n+----------------+------------------+\n|   0.000000e+00 |     0.000000e+00 |\n+----------------+------------------+\n\n\nTime Step 1, time = 40, dt = 40\n\nPerforming automatic scaling calculation\n\n 0 Nonlinear |R| = 6.263956e+09\n    Linear solve did not converge due to DIVERGED_PC_FAILED iterations 0\n                   PC failed due to FACTOR_NUMERIC_ZEROPIVOT \n\n\n*** Warning ***\n/home/wang/projects/miracle/test/tests/kernels/restructure/restructure_SUPG.i:194.3:\nThe following warning occurred in the MaterialBase 'mamox' of type MAMOXThermal.\n\nWARNING: In MAMOXThermal: negative temperature!\n         Reseting to zero.\n        _qp: 0\n        temp: -inf\n        elem: 0\n        proc: 0\nI also try to use analyzejacobian to check the Jacobian.\n** PETSc DEPRECATION WARNING ** : the option -snes_test_jacobian_display_threshold is deprecated as of version 3.13 and will be removed in a future release.\n   Use the option -snes_test_jacobian instead. -snes_test_jacobian accepts an optional threshold (since v3.10) (Silence this warning with -options_suppress_deprecated_warnings)\n  ---------- Testing Jacobian -------------\n  Testing hand-coded Jacobian, if (for double precision runs) ||J - Jfd||_F/||J||_F is\n    O(1.e-8), the hand-coded Jacobian is probably correct.\n  ||J - Jfd||_F/||J||_F = 3.52237e-08, ||J - Jfd||_F = 2.77796e+08\n  Hand-coded Jacobian ----------\nMat Object: (nl0_) 1 MPI process\nSo how to fix this problem, thanks for you help in advance.\nZhaohao Wang.",
          "url": "https://github.com/idaholab/moose/discussions/29176",
          "updatedAt": "2024-12-05T16:15:20Z",
          "publishedAt": "2024-12-02T03:38:48Z",
          "category": {
            "name": "Q&A General"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "GiudGiud"
                  },
                  "bodyText": "hello\nyou can try\n  petsc_options_iname = '-pc_type -pc_factor_shift_type'\n  petsc_options_value = 'lu NONZERO'\n\nto get around a zero-pivot in LU\nThis is fairly loose\n  nl_rel_tol = 1e-5\n  nl_abs_tol = 1e-5\n\nso you might want to tighten it or be mindful if it causes trouble later on\nGuillaume",
                  "url": "https://github.com/idaholab/moose/discussions/29176#discussioncomment-11432411",
                  "updatedAt": "2024-12-02T04:04:15Z",
                  "publishedAt": "2024-12-02T04:04:14Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": []
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "wangzhaohao"
                  },
                  "bodyText": "Thanks for your quick reply, I have tried the method you provided, and reduse the nl_rel_tol nl_abs_tol\nthe result seems not well.\nWhen I use the automatic_scaling, It's over very quickly, like noting happened. The variable 'porosity' doesn't have any redistribution. and the variable 'temperature' is quite strange.\n\nIf close the automatic_scaling,\n48 Nonlinear |R| = 8.139512e-04\n      0 Linear |R| = 8.139512e-04\n      1 Linear |R| = 8.133132e-04\n      2 Linear |R| = 8.118787e-04\n      3 Linear |R| = 7.965513e-04\n      4 Linear |R| = 7.382100e-04\n      5 Linear |R| = 7.006991e-04\n      6 Linear |R| = 2.310533e-04\n      7 Linear |R| = 1.289893e-04\n      8 Linear |R| = 3.198177e-05\n      9 Linear |R| = 1.427464e-05\n     10 Linear |R| = 4.980067e-06\n     11 Linear |R| = 1.327768e-06\n     12 Linear |R| = 6.281298e-07\n     13 Linear |R| = 2.168976e-07\n     14 Linear |R| = 7.426662e-08\n    |residual|_2 of individual variables:\n           disp_x:           0.000828241\n           scalar_strain_yy: 7.27083e-09\n           temp:             3.24275e-06\n           porosity:         6.98804e-12\n49 Nonlinear |R| = 8.282470e-04\n      0 Linear |R| = 8.282470e-04\n      1 Linear |R| = 8.264407e-04\n      2 Linear |R| = 8.238493e-04\n      3 Linear |R| = 8.086120e-04\n      4 Linear |R| = 7.590600e-04\n      5 Linear |R| = 6.051407e-04\n      6 Linear |R| = 2.515633e-04\n      7 Linear |R| = 1.100417e-04\n      8 Linear |R| = 2.456599e-05\n      9 Linear |R| = 1.323413e-05\n     10 Linear |R| = 3.790405e-06\n     11 Linear |R| = 1.344224e-06\n     12 Linear |R| = 6.340606e-07\n     13 Linear |R| = 2.036445e-07\n     14 Linear |R| = 7.245698e-08\n    |residual|_2 of individual variables:\n           disp_x:           0.000923801\n           scalar_strain_yy: 5.78936e-10\n           temp:             3.43356e-06\n           porosity:         4.3539e-12\n50 Nonlinear |R| = 9.238078e-04\n  Nonlinear solve did not converge due to DIVERGED_MAX_IT iterations 50\n Solve Did NOT Converge!\nAborting as solve did not converge\n\n\n*** ERROR ***\nThe following error occurred in the TimeStepper 'ConstantDT' of type ConstantDT.\n\nSolve failed and timestep already at or below dtmin, cannot continue!",
                  "url": "https://github.com/idaholab/moose/discussions/29176#discussioncomment-11433303",
                  "updatedAt": "2024-12-02T07:07:49Z",
                  "publishedAt": "2024-12-02T07:07:49Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "If automatic scaling does not scale the variables well, and that can happen as as you can see below, the differences in residual are very large, then you should consider manual scaling. This can improve the convergence issue that you see in your unscaled solve\n           disp_x:           0.000828241\n           scalar_strain_yy: 7.27083e-09\n           temp:             3.24275e-06\n           porosity:         6.98804e-12",
                          "url": "https://github.com/idaholab/moose/discussions/29176#discussioncomment-11436522",
                          "updatedAt": "2024-12-02T13:15:53Z",
                          "publishedAt": "2024-12-02T13:15:52Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "wangzhaohao"
                          },
                          "bodyText": "In my understand, I need to do is in the Variables part set the scaling=, I am a little confused about how to set the specific value, because this Residual is always change.",
                          "url": "https://github.com/idaholab/moose/discussions/29176#discussioncomment-11437063",
                          "updatedAt": "2024-12-02T14:11:32Z",
                          "publishedAt": "2024-12-02T14:11:31Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "A constant value should be good enough. You can look on the first time step what seems to work best, then keep those numbers.",
                          "url": "https://github.com/idaholab/moose/discussions/29176#discussioncomment-11437829",
                          "updatedAt": "2024-12-02T15:14:47Z",
                          "publishedAt": "2024-12-02T15:14:46Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "wangzhaohao"
                          },
                          "bodyText": "hello, Maybe I didn't make it clear.\nThe first time step residual is\nTime Step 1, time = 40, dt = 40\n    |residual|_2 of individual variables:\n           disp_x:           2.54423e+06\n           scalar_strain_yy: 48.0886\n           temp:             1.28539e+06\n           porosity:         1.18398e-50\nSo what is the rule for setting the Scaling ? Try to set all to close 1, but the residual worse.\nTime Step 1, time = 40, dt = 40\n    |residual|_2 of individual variables:\n           disp_x:           0.999881\n           scalar_strain_yy: 1.00024\n           temp:             1.00003\n           porosity:         1.18398\n 0 Nonlinear |R| = 2.098123e+00\n      0 Linear |R| = 2.098123e+00\n      1 Linear |R| = 1.694706e+00\n      2 Linear |R| = 1.539238e+00\n      3 Linear |R| = 1.538596e+00\n      4 Linear |R| = 1.097840e+00\n      5 Linear |R| = 7.229077e-03\n      6 Linear |R| = 2.306470e-04\n      7 Linear |R| = 1.631632e-04\n  Nonlinear solve did not converge due to DIVERGED_LINE_SEARCH iterations 0\n Solve Did NOT Converge!\nAborting as solve did not converge\n\nTime Step 1, time = 20, dt = 20\n    |residual|_2 of individual variables:\n           disp_x:           0.995851\n           scalar_strain_yy: 0.996215\n           temp:             0.997077\n           porosity:         0.931226\n 0 Nonlinear |R| = 1.960996e+00\n      0 Linear |R| = 1.960996e+00\n      1 Linear |R| = 1.603478e+00\n      2 Linear |R| = 1.527879e+00\n      3 Linear |R| = 1.527262e+00\n      4 Linear |R| = 1.287956e+00\n      5 Linear |R| = 3.603297e-04\n      6 Linear |R| = 8.068188e-06\n\n\n*** Warning ***\n/home/wang/projects/miracle/test/tests/kernels/restructure/restructure_SUPG.i:198.3:\nThe following warning occurred in the MaterialBase 'mamox' of type MAMOXThermal.\n\nWARNING: In MAMOXThermal: negative temperature!\n         Reseting to zero.\n        _qp: 0\n        temp: -102.753\n        elem: 0\n        proc: 0",
                          "url": "https://github.com/idaholab/moose/discussions/29176#discussioncomment-11443163",
                          "updatedAt": "2024-12-03T02:39:12Z",
                          "publishedAt": "2024-12-03T02:39:11Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "porosity:         1.18398e-50\n\n\ndont act on this one on the first iteration.\nTry 1e4 for scalar_strain and leave the others at 1",
                          "url": "https://github.com/idaholab/moose/discussions/29176#discussioncomment-11443262",
                          "updatedAt": "2024-12-03T02:52:47Z",
                          "publishedAt": "2024-12-03T02:52:46Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "wangzhaohao"
                          },
                          "bodyText": "Taking a step back, I am now experiencing poor convergence and automatic_scaling  fail after adding SUPG. Is there some useful information being ignored?\nthere is my SUPG part code.\n#include \"PoreAdvectionSUPG.h\"\n\nregisterMooseObject(\"MiracleApp\", PoreAdvectionSUPG);\n\nInputParameters\nPoreAdvectionSUPG::validParams()\n{\n  InputParameters params = KernelGrad::validParams();\n  params.addRequiredCoupledVar(\"temperature\", \"the MOX temperature in K\");\n  params.addCoupledVar(\"plutonium_concentration\", \"the plutonium concentration in range 0 - 1\");\n  params.addClassDescription(\"advection-part SUPG of pores\");\n  return params;\n}\n\nPoreAdvectionSUPG::PoreAdvectionSUPG(const InputParameters & parameters)\n  : KernelGrad(parameters),\n    _temperature(coupledValue(\"temperature\")),\n    _temperature_grad(coupledGradient(\"temperature\")),\n    _plutonium_concentration(coupledValue(\"plutonium_concentration\"))\n{\n}\n\nRealVectorValue\nPoreAdvectionSUPG::velocity() const\n{\n  Real universal_gas_constant = 8.31446261815324; //[J/mol/K]\n  Real Boltzmann_constant = 1.380649e-23;         //[J/K]\n  Real Avogadro_constant = 6.02214179e23;         //[molecules/mol]\n  Real corros_section_avg = 3e-10;                //[m^2]\n  Real uo2_molecules = 5e17;                      //[molecules/m^3]\n  Real He_molecules = 2.46e25;                    //[molecules/m^3]\n  Real He_molar = 4.0026020e-3;                   //[kg/mol]\n  Real uo2_molar = 270.03e-3;                     //[kg/mol]\n  Real diffusion_coeff =\n      std::sqrt(8 * universal_gas_constant * _temperature[_qp] / libMesh::pi) /\n      (3 * libMesh::pi * std::pow(corros_section_avg, 2) * (He_molecules + uo2_molecules)) *\n      std::sqrt((He_molar + uo2_molar) / (He_molar * uo2_molar)); //[m^2/s]\n\n  Real pre_factor_pressure = 0;\n  Real vaporization = 0;\n\n  if (_temperature[_qp] < 2000)\n  {\n    pre_factor_pressure = 0.1 * std::exp(33.785);\n    vaporization = 5.98e5;\n  }\n  else if (_temperature[_qp] < 2200)\n  {\n    pre_factor_pressure = 0.1 * std::exp(34.107);\n    vaporization = 6.17e5;\n  }\n  else\n  {\n    pre_factor_pressure = 0.1 * std::exp(35.813);\n    vaporization = 6.35e5;\n  }\n  Real vapour_pressure =\n      pre_factor_pressure * std::exp(-vaporization / universal_gas_constant / _temperature[_qp]);\n\n  RealVectorValue velocity_sens =\n      5.006e-12 *\n      (0.988 + 6.395e-6 * _temperature[_qp] + 3.543e-9 * std::pow(_temperature[_qp], 2) +\n       3e-12 * std::pow(_temperature[_qp], 3)) *\n      std::pow(_temperature[_qp], -2.5) * vaporization * vapour_pressure * _temperature_grad[_qp];\n  return velocity_sens;\n}\n\nRealGradient\nPoreAdvectionSUPG::precomputeQpResidual()\n{\n  // Real tau =\n  //     _current_elem->hmin() /\n  //     (std::pow((velocity() + RealVectorValue(libMesh::TOLERANCE * libMesh::TOLERANCE)).norm(), 2));\n  Real tau = _current_elem->hmin() /\n             (2 * (velocity() + RealVectorValue(libMesh::TOLERANCE * libMesh::TOLERANCE)).norm());\n  return tau * _grad_u[_qp] * velocity() * velocity();\n}\n\nRealGradient\nPoreAdvectionSUPG::precomputeQpJacobian()\n{\n  // auto tau = _current_elem->hmin() /\n  //            (std::pow((velocity() + RealVectorValue(libMesh::TOLERANCE * libMesh::TOLERANCE)).norm(),2));\n  Real tau = _current_elem->hmin() /\n             (2 * (velocity() + RealVectorValue(libMesh::TOLERANCE * libMesh::TOLERANCE)).norm());\n  return tau * _grad_phi[_j][_qp] * velocity() * velocity();\n}",
                          "url": "https://github.com/idaholab/moose/discussions/29176#discussioncomment-11443293",
                          "updatedAt": "2024-12-03T02:59:49Z",
                          "publishedAt": "2024-12-03T02:59:48Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "wangzhaohao"
                          },
                          "bodyText": "dont act on this one on the first iteration. Try 1e4 for scalar_strain and leave the others at 1\n\n[Variables]\n  [disp_x]\n  []\n  [scalar_strain_yy]\n    order = FIRST\n    family = SCALAR\n    scaling = 1e4\n  []\n  [temp]\n    order = FIRST\n    family = LAGRANGE\n    initial_condition = 300\n  []\n  [porosity]\n    initial_condition = 0.15\n  []\n[]\nStill does not converge at the end.",
                          "url": "https://github.com/idaholab/moose/discussions/29176#discussioncomment-11443373",
                          "updatedAt": "2024-12-03T03:11:29Z",
                          "publishedAt": "2024-12-03T03:11:29Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "this looks a simple for the Jacobian contribution?\n  return tau * _grad_phi[_j][_qp] * velocity() * velocity();\n\ndoes velocity not depend on any of the other main variables?",
                          "url": "https://github.com/idaholab/moose/discussions/29176#discussioncomment-11443374",
                          "updatedAt": "2024-12-03T03:11:36Z",
                          "publishedAt": "2024-12-03T03:11:35Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "Still does not converge at the end.\n\nis the convergence changed in the earlier iterations?\nI didnt see scalar_strain_yy was a scalar variable. I m not sure it needs an order? What are you representing with this order?",
                          "url": "https://github.com/idaholab/moose/discussions/29176#discussioncomment-11443378",
                          "updatedAt": "2024-12-03T03:13:35Z",
                          "publishedAt": "2024-12-03T03:13:34Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "wangzhaohao"
                          },
                          "bodyText": "return tau * _grad_phi[_j][_qp] * velocity() * velocity();\n\ndoes velocity not depend on any of the other main variables?\n\nRely on the temperature, but in this Kernel, porosity is variable",
                          "url": "https://github.com/idaholab/moose/discussions/29176#discussioncomment-11443407",
                          "updatedAt": "2024-12-03T03:19:09Z",
                          "publishedAt": "2024-12-03T03:18:53Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "Using the Newton solver for k-epsilon turbulence models",
          "author": {
            "login": "charlieowen3065"
          },
          "bodyText": "Check these boxes if you have followed the posting rules.\n\n Q&A Navier Stokes is the most appropriate category for my question\n I have consulted the posting Guidelines on the Discussions front page\n I have searched the Discussions forum and my question has not been asked before\n I have searched the MOOSE website and the documentation does not answer my question\n I have formatted my post following the posting guidelines (avoid screenshots if possible, triple back quotes before/after pasted text, etc)\n\nQuestion\nHello!\nI am currently attempting to design a RANS model using the k-epsilon formulation you all have implemented recently, and had a question on the matter.\nFor my specific purposes, it would be useful to use the Newton-solver to simulate my experiment (I am attempting to do some ROM analysis, and algorithms I have written in the past are based on the Newton update). For non-RANS models (just using simple mass, momentum, and heat transfers), the Newton algorithm seemed to be working, but once I added in TKE and TKED variables and kernels, it gave me the error\nFor iteration type 'nonlinear': solution state 1 was requested in nl0 but only up to state 0 is available.\n\nAnd it looks like the error is being given by the INSFVTKESourceSink object. Are Newton capabilities not implemented for the k-epsilon model yet? Or is there a work-around that I have not found?\nI've seen the SIMPLE algorithm, and I could probably work with it, but it would be nice to work with what I'm familiar with.\nAny ideas on where to go with this?\nThanks!\nCharlie\nAdditional information\nNo response",
          "url": "https://github.com/idaholab/moose/discussions/29236",
          "updatedAt": "2024-12-04T21:36:32Z",
          "publishedAt": "2024-12-04T20:20:23Z",
          "category": {
            "name": "Q&A Modules: Navier-Stokes"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "GiudGiud"
                  },
                  "bodyText": "And it looks like the error is being given by the INSFVTKESourceSink object. Are Newton capabilities not implemented for the k-epsilon model yet?\n\nThey are enabled, though we do not leverage them anywhere so you would be a first-adopter\n\nOr is there a work-around that I have not found?\n\nDid you set the parameters in the problem to request the previous solution? Did you follow the tests for TKE + Newton ?",
                  "url": "https://github.com/idaholab/moose/discussions/29236#discussioncomment-11465959",
                  "updatedAt": "2024-12-04T20:57:38Z",
                  "publishedAt": "2024-12-04T20:57:37Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": []
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "charlieowen3065"
                  },
                  "bodyText": "I did not manually set the parameters in the problem to request the previous solution - I was not aware of that functionality, but I will look into that!\nFor the tests of TKE + Newton, they all use the Physics block. To build my model, I wanted to start at the basics (I started with just steady-state mass-momentum) and have been building my model up from there, and recently reached the point where RANS was being necessary, and in that, I have not been using the physics block. Does this block work similar to the Modules block, where it is a short-hand for a larger set of input blocks (such that you could completely rebuild it with just blocks in the input file), or is it made deeper in the code?\nI was basing my Turbulence models on the channel_ERCOFTAC.i channel-test, and was trying to rework that to use Newton updates.\nI am mostly trying to learn how to properly use the Navier-Stokes module right now, so I was avoiding using the larger Module/Physics blocks to have a better handle of what is happening under the hood, and to try and do minor parametric studies to see how much various inputs affect response.",
                  "url": "https://github.com/idaholab/moose/discussions/29236#discussioncomment-11466164",
                  "updatedAt": "2024-12-04T21:18:10Z",
                  "publishedAt": "2024-12-04T21:18:09Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "For the tests of TKE + Newton, they all use the Physics block.\n\nonce #29177 is merged you ll be able to dump the Physics syntax to regular kernel syntax. It might already work in your case. Try setting (just once) Problem/type=DumpObjectsProblem\nRegardless, you can see the parameters of the Problem and executioner block and try to use those\n\nDoes this block work similar to the Modules block, where it is a short-hand for a larger set of input blocks (such that you could completely rebuild it with just blocks in the input file), or is it made deeper in the code?\n\nNo it's exactly the same as the Modules block, except that there's tons of additional helper and checks that we did not have back when using the Modules block",
                          "url": "https://github.com/idaholab/moose/discussions/29236#discussioncomment-11466184",
                          "updatedAt": "2024-12-04T21:22:00Z",
                          "publishedAt": "2024-12-04T21:21:59Z",
                          "isAnswer": true
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "charlieowen3065"
                          },
                          "bodyText": "Okay! the dump wasn't quite working, but it was a mpicxx error, which I haven't set up yet, so that may be on my end. I'll look into that.\nI see the source file, so I'll just parse through that in the meantime - since it does work though, I'm all good!\nThank you!\nCharlie",
                          "url": "https://github.com/idaholab/moose/discussions/29236#discussioncomment-11466286",
                          "updatedAt": "2024-12-04T21:36:08Z",
                          "publishedAt": "2024-12-04T21:36:07Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "How A Systems Engineer Uses MOOSE & Coreform Cubit",
          "author": {
            "login": "GregVernon"
          },
          "bodyText": "I wanted to share with the community one of Coreform's recent webinars that featured Paul Keutelian, owner at Quartermaster Consulting, demonstrating how he performs rapid design iteration and mesh refinement for a rod heater simulation using MOOSE and Coreform Cubit.\nYou can view the webinar on YouTube here: https://www.youtube.com/watch?v=ipkZ9QEaCtw\nWe hope that webinars like this are helpful for the MOOSE community, so let us know if you what sorts of topics you'd like to see covered in the future!",
          "url": "https://github.com/idaholab/moose/discussions/29187",
          "updatedAt": "2024-12-04T17:18:54Z",
          "publishedAt": "2024-12-04T17:18:53Z",
          "category": {
            "name": "Show and tell"
          },
          "comments": {
            "edges": []
          }
        }
      },
      {
        "node": {
          "title": "Sintering two particles",
          "author": {
            "login": "Judy-22"
          },
          "bodyText": "Hi @SudiptaBiswas,\nI am trying to reproduce the baseline case presented in your article https://link.springer.com/article/10.1007/s10853-017-1846-3   (table 2, case I).\nFor time less than 6 it seems perfect.\nt = 1s\n\nt = 6\n\nBut when the time is greater than 6, the time step reduces drastically, and tends to reduce more and more, which causes convergence problems.\nSee the result:\n\n\n\nThe input file:\n ## The phase field model to simulate sintering of two particles in 2D\n\n[GlobalParams]        # Automatically define order parameters \n  var_name_base = eta\n  op_num = 2\n[]\n\n[Mesh]                # Generate mesh\n  type = GeneratedMesh\n  dim = 2\n  nx = 80             # n\u00b0s element in x. \n  ny = 40             # n\u00b0s element in y.\n  xmin = 0  \n  xmax = 40      # \u00b5m\n  ymin = 0\n  ymax = 20      # \u00b5m\n  elem_type = QUAD4\n  uniform_refine = 2\n[]\n\n[Variables]\n  [./c]               # particle concentration (conserved variable)\n    order = FIRST\n    family = LAGRANGE\n  [../]\n  [./w]               # functional derivative of the total free energy  \n    order = FIRST\n    family = LAGRANGE\n  [../]\n  [./PolycrystalVariables] # Automatically creates order parameter variables\n  [../]\n[]\n\n[Kernels]\n  [./c_res]\n  # compute the residual therm of total free energy as function of c.\n    type = SplitCHParsed\n    variable = c\n    f_name = F\n    kappa_name = kappa_c\n    args = 'eta0 eta1'\n    w = w\n  [../]\n  [./w_res]\n  # compute the residual therm of functional free energy as function of w and M.\n    type = SplitCHWRes\n    variable = w\n    mob_name = M\n  [../]\n  [./time]\n  # compute the time derivative term of w and c.\n    type = CoupledTimeDerivative\n    variable = w\n    v = c\n  [../]\n  [./eta0_dot]\n    type = TimeDerivative\n    variable = eta0\n  [../]\n  [./acint_eta0]\n    type = ACInterface\n    variable = eta0\n    mob_name = L\n    args = c\n    kappa_name = kappa_eta\n  [../]\n  [./acbulk_eta0]\n    type = AllenCahn\n    variable = eta0\n    mob_name = L\n    f_name = F\n    args = 'c eta1'\n  [../]\n  [./eta1_dot]\n    type = TimeDerivative\n    variable = eta1\n  [../]\n  [./acint_eta1]\n    type = ACInterface\n    variable = eta1\n    mob_name = L\n    args = c\n    kappa_name = kappa_eta\n  [../]\n  [./acbulk_eta1]\n    type = AllenCahn\n    variable = eta1\n    mob_name = L\n    f_name = F\n    args = 'c eta0'\n  [../]\n[]\n\n[Materials]  \n  [./constants]\n    type = GenericFunctionMaterial\n    prop_names = 'kappa_c   kappa_eta     A      B     L\n                    Dvol      Dvap       Dsuf    Dgb'\n    \n    prop_values = '1.0       0.5      16.0     1.0    1.0\n                   0.01       0.001     4.0     0.4'\n  [../]\n  [./free_energy]            # Total free energy function of c and eta.\n    type = DerivativeParsedMaterial\n    f_name = F\n    args = 'c eta0 eta1'          # Must be changed as op_num changes.\n    function = 'A*c^2*(1-c)^2 + B*(c^2+6*(1-c)*(eta0^2+eta1^2)-4*(2-c)*(eta0^3+eta1^3)\n                + 3*(eta0^2+eta1^2)^2)'\n    material_property_names = 'A  B'\n    derivative_order = 2\n  [../]\n  [./CHmobility]    # Cahn and Hilliard Mobility incluing all diffusin path (m^5/J/s)\n    type = DerivativeParsedMaterial\n    f_name = M\n    args = 'c eta0 eta1'\n    function = '(Dvol*c^3*(10 - 15*c + 6*c^2) + Dvap*(1 - (c^3*(10 - 15*c + 6*c^2)))\n                + Dsuf*(1 - c) + Dgb*(eta0*eta1))'\n    material_property_names = 'Dvol Qvol Dvap Qvap Dsuf Qs Dgb Qgb KB Vm d2F:=D[F(c),c,c] T'\n    derivative_order = 1\n  [../]\n[]\n\n[BCs]\n  [./bcs]\n    #zero flux BC\n    type = NeumannBC\n    value = 0\n    variable = c\n    boundary = '0 1 2 3'\n  [../]\n[]\n\n[AuxVariables]\n  [./bnds]\n  # Auxivariables that define the location of grain boundaries in a polycrystalline sample\n  [../]\n  [./free_energy]\n    order = CONSTANT\n    family = MONOMIAL\n  [../]\n[]\n\n[AuxKernels]\n  [./bnds]\n  # Calculate location of grain boundaries in a polycrystalline sample\n    type = BndsCalcAux\n    variable = bnds\n    var_name_base = eta\n    op_num = 2\n    v = 'eta0 eta1'\n  [../]\n  [./energy_density]\n    type = TotalFreeEnergy\n    variable = free_energy\n    f_name = F\n    kappa_names = 'kappa_c kappa_eta kappa_eta'\n    interfacial_vars = 'c eta0 eta1'\n  [../]\n[]\n\n[ICs]\n  [./ic_eta0]\n  # initial condition for each order parameter \n    type = SmoothCircleIC\n    variable = eta0\n    x1 = 10.5\n    y1 = 10.0\n    radius = 7.5\n    invalue = 1.0\n    outvalue = 0.0\n    int_width = 2.0\n  [../]\n  [./IC_eta1]\n    type = SmoothCircleIC\n    variable = eta1\n    x1 = 25.5\n    y1 = 10.0\n    radius = 7.5\n    invalue = 1.0\n    outvalue = 0.0\n    int_width = 2.0\n  [../]\n  [./ic_c]\n  # initial condition for conserved parameter \n    type = SpecifiedSmoothCircleIC\n    invalue = 1.0\n    outvalue = 0.0\n    int_width = 2.0\n    x_positions = '10.5 25.5'\n    y_positions = '10.0 10.0'\n    z_positions = '0.0 0.0'\n    radii       = '7.5 7.5'\n    3D_spheres = false\n    variable = c\n    block = 0\n  [../]\n[]\n\n[Preconditioning]\n  [./coupled]\n    type = SMP\n    full = true\n  [../]\n[]\n\n[Executioner]\n  type = Transient\n  scheme = bdf2\n  solve_type = NEWTON\n  automatic_scaling = true\n  petsc_options_iname = '-pc_type -ksp_gmres_restart -sub_ksp_type\n                         -sub_pc_type -pc_asm_overlap'\n  petsc_options_value = 'asm      31                  preonly\n                         lu          1'\n  l_tol = 1e-05\n  nl_max_its = 30\n  l_max_its = 30\n  nl_rel_tol = 1e-07\n  nl_abs_tol = 1e-09\n  start_time = 0.0\n  end_time = 100\n  #dt = 0.05\n  [./TimeStepper]\n    type = IterationAdaptiveDT\n    cutback_factor = 0.5\n    dt = 0.01\n    growth_factor = 2\n    optimal_iterations = 8\n  [../]\n  [./Adaptivity]\n    initial_adaptivity = 1\n    refine_fraction = 0.6\n    coarsen_fraction = 0.01\n    max_h_level = 2\n    print_changed_info = true\n  [../]\n[]\n\n[Outputs]\n  exodus = true\n  [./debug]\n    type = VariableResidualNormsDebugOutput\n  [../]\n[]",
          "url": "https://github.com/idaholab/moose/discussions/20805",
          "updatedAt": "2024-12-14T03:23:18Z",
          "publishedAt": "2022-04-16T07:51:56Z",
          "category": {
            "name": "Q&A Modules: Phase field"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "chongxiyuan"
                  },
                  "bodyText": "Hi all,\nI am also tyring to work sintering in MOOSE, and I am using a very similar input file with AC-CH kernels and free energy(following MOOSE examples and forum). I see the same issue when when the diffusivity(CH mobility) is dependent on the conserved(rho) and non-conserved(eta) phase field variables. The simulation diverges with huge vibrations in the solution of rho. When I simplify the diffusivity to a constant (D=1), the solution is fine and no more vibration in the end.\nD dependent on etas and rho, tstep=1\n\nD dependent on etas and rho, tstep=63\n\ninput file used attached\ninput.txt.txt\nD=1 constant, tstep=2400\n\nI am suspecting maybe the element order is not high enough, or mesh is not refined enough for the phase field variables? Any help or discussion is welcomed. Thank you.",
                  "url": "https://github.com/idaholab/moose/discussions/20805#discussioncomment-2675197",
                  "updatedAt": "2022-06-01T14:02:29Z",
                  "publishedAt": "2022-05-02T17:04:58Z",
                  "isAnswer": true,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "hello\nmesh refinement could just be added with a -r n flag on the command line if you want to try this out",
                          "url": "https://github.com/idaholab/moose/discussions/20805#discussioncomment-2675219",
                          "updatedAt": "2022-06-01T14:02:44Z",
                          "publishedAt": "2022-05-02T17:09:27Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "SudiptaBiswas"
                          },
                          "bodyText": "This could also depend on what interpolation functions you are using for the diffusivities. Start with a simple function to debug the issue.",
                          "url": "https://github.com/idaholab/moose/discussions/20805#discussioncomment-2675341",
                          "updatedAt": "2022-06-01T14:02:44Z",
                          "publishedAt": "2022-05-02T17:32:01Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "chongxiyuan"
                          },
                          "bodyText": "Thank you so much! I will start with maybe a linear interpolation of c and etas with finer mesh and keep trying from there.",
                          "url": "https://github.com/idaholab/moose/discussions/20805#discussioncomment-2675382",
                          "updatedAt": "2022-06-01T14:02:44Z",
                          "publishedAt": "2022-05-02T17:38:22Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "@laimaster21 any luck with this approach?",
                          "url": "https://github.com/idaholab/moose/discussions/20805#discussioncomment-2755398",
                          "updatedAt": "2022-06-17T14:39:07Z",
                          "publishedAt": "2022-05-15T21:00:47Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "chongxiyuan"
                          },
                          "bodyText": "Hi, sorry for the late reply. I think I found the issue, you were right it is with the interpolation of surface diffusion D_surf. The 2018 paper  https://link.springer.com/article/10.1007/s10853-017-1846-3  equation 32 reports D_surf with c(1-c)D_surf in the C-H mobility. It does not converge very well in my simulations. I used (3c^2-2c^3)(1-3c^2-2c^3)D_surf in the mobility and it works fine so far. Mobility constants are picked similar scale to the paper.",
                          "url": "https://github.com/idaholab/moose/discussions/20805#discussioncomment-2880008",
                          "updatedAt": "2022-06-03T17:57:49Z",
                          "publishedAt": "2022-06-03T17:57:49Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "Coupled Phase field with Mechanic tensor",
          "author": {
            "login": "Judy-22"
          },
          "bodyText": "Hi Moose community,\nI am trying to model the coupling between phase fields and mechanics, using the material properties depending on the phase variables, but it converges. Below is the error shown.\n0 Nonlinear |R| = 1.026418e+04\n      0 Linear |R| = 1.026418e+04\n  Linear solve did not converge due to DIVERGED_PC_FAILED iterations 0\n                 PC failed due to SUBPC_ERROR \nNonlinear solve did not converge due to DIVERGED_LINE_SEARCH iterations 0\n Solve Did NOT Converge!\n  Finished Solving                                                                       [ 10.92 s] [    0 MB]\nAborting as solve did not converge\nSolve failed, cutting timestep.\n\n\nThe input file:\n[GlobalParams]        # Automatically define order parameters \n  var_name_base = eta\n  op_num = 2\n  displacements = 'disp_x disp_y'\n[]\n[Mesh]                # Generate mesh (7/3D X 4/3D) \n  type = GeneratedMesh\n  dim = 2                                \n  nx = 70             # n\u00b0s element in x. \n  ny = 40             # n\u00b0s element in y.\n  xmin = 0  \n  xmax = 70.0      # \u00b5m\n  ymin = 0\n  ymax = 40.0      # \u00b5m\n  elem_type = QUAD4\n  #uniform_refine = 2\n[]\n\n[Variables]\n  [./c]               \n    order = FIRST\n    family = LAGRANGE\n  [../]\n  [./w]               \n    order = FIRST\n    family = LAGRANGE\n  [../]\n  [./PolycrystalVariables] \n  [../]\n[]\n\n[Kernels]\n  [./c_res]\n    type = SplitCHParsed\n    variable = c\n    f_name = F\n    kappa_name = kappa_c\n    args = 'eta0 eta1'\n    w = w\n  [../]\n  [./w_res]\n    type = SplitCHWRes\n    variable = w\n    mob_name = M\n  [../]\n  [./time]\n    type = CoupledTimeDerivative\n    variable = w\n    v = c\n  [../]\n  [./RigidBodyMultiKernel]\n    c = c\n    f_name = F\n    mob_name = L\n    kappa_name = kappa_eta\n    op_num = 2\n    var_name_base = eta\n    grain_force = grain_force\n    grain_volumes = grain_volumes\n    grain_tracker_object = grain_center\n  [../]\n  [./CH_RBM]\n    type = MultiGrainRigidBodyMotion\n    variable = w\n    c = c\n    op_num = 2\n    var_name_base = eta\n    grain_force = grain_force\n    grain_volumes = grain_volumes\n    grain_tracker_object = grain_center\n  [../]\n  [./vadv_eta0]\n    type = SingleGrainRigidBodyMotion\n    variable = eta0\n    c = c\n    v = 'eta0 eta1'\n    grain_force = grain_force\n    grain_tracker_object = grain_center\n    grain_volumes = grain_volumes\n    op_index = 0\n  [../]\n  [./vadv_eta1]\n    type = SingleGrainRigidBodyMotion\n    variable = eta1\n    c = c\n    v = 'eta0 eta1'\n    op_index = 1\n    grain_force = grain_force\n    grain_tracker_object = grain_center\n    grain_volumes = grain_volumes\n  [../]\n[]\n\n[Modules/TensorMechanics/Master]\n  [./all]\n    add_variables = true\n  [../]\n[]\n\n[Materials]\n  [./Mat_prop]\n    type = GenericConstantMaterial\n    prop_names  = 'Es    Egb    Iw     F\u2070       l\u2070       t\u2070\n                   Dv0   Ds0   Dgb0    Qvol      Qsuf    Qgb\n                   KB    Vm     Mgb    Qm        wGB     T '\n    \n    prop_values = '2.41        1.06      3.0e-6     1.0e-06  1.0e-06   1.0\n                   2.0e-04     0.4       0.127e-04  2.6      2.21      0.58\n                   8.6173e-05  1.21e-29  5.53e-08   0.171    3.0e-06   600'\n  [../]\n  [./Kc]\n    type = ParsedMaterial\n    f_name  = kappa_c\n    function = '(l\u2070/F\u2070)*(3/4)*Iw*(2*Es - Egb)'\n    material_property_names = 'Iw Es Egb F\u2070 l\u2070'\n  [../]\n  [./Keta]\n    type = ParsedMaterial\n    f_name  = kappa_eta\n    function = '(l\u2070/F\u2070)*(3/4)*Iw*Egb'\n    material_property_names = 'Iw Egb F\u2070 l\u2070'\n  [../]\n  [./A]\n    type = ParsedMaterial\n    f_name  = A\n    function = '(l\u2070^3/F\u2070)*(12*Es - 7*Egb)/Iw'\n    material_property_names = 'Iw Es Egb F\u2070 l\u2070'\n  [../]\n  [./B]\n    type = ParsedMaterial\n    f_name  = B\n    function = '(l\u2070^3/F\u2070)*Egb/Iw'\n    material_property_names = 'Iw Egb F\u2070 l\u2070'\n  [../]\n  [./Dvol]\n    type = ParsedMaterial\n    f_name  = Dvol\n    function = '(t\u2070/l\u2070^2)*Dv0*exp(-Qvol/(KB*T))'\n    material_property_names = 'Dv0 Qvol KB T t\u2070 F\u2070 l\u2070'\n  [../]\n  [./Dsuf]\n    type = ParsedMaterial\n    f_name  = Dsuf\n    function = '(t\u2070/l\u2070^2)*Ds0*exp(-Qsuf/(KB*T))'\n    material_property_names = 'Ds0 Qsuf KB T t\u2070 F\u2070 l\u2070'\n  [../]\n  [./Dgb]\n    type = ParsedMaterial\n    f_name  = Dgb\n    function = '(t\u2070/l\u2070^2)*Dgb0*exp(-Qgb/(KB*T))'\n    material_property_names = 'Dgb0 Qgb KB T t\u2070 F\u2070 l\u2070'\n  [../]\n  [./chemical_energy]            \n    type = DerivativeParsedMaterial\n    f_name = Fc\n    args = 'c eta0 eta1'          # Must be changed as op_num changes.\n    function = 'A*c^2*(1-c)^2 + B*(c^2+6*(1-c)*(eta0^2+eta1^2)-4*(2-c)*(eta0^3+eta1^3)\n                + 3*(eta0^2+eta1^2)^2)'\n    material_property_names = 'A  B'\n    derivative_order = 2\n  [../]\n  [./CHmobility]   \n    type = DerivativeParsedMaterial\n    f_name = M\n    args = 'c eta0 eta1'\n    function = '(t\u2070*F\u2070/l\u2070^3)*Vm/(1.3806e-23*T)*(Dvol*c^3*(10 - 15*c + 6*c^2) + Dsuf*(1 - c) + Dgb*(eta0*eta1))'\n    material_property_names = 'Dvol Qvol Dvap  Dsuf Dgb  KB Vm T t\u2070 F\u2070 l\u2070'\n    derivative_order = 1\n  [../]\n  [./L]       \n    type = ParsedMaterial\n    f_name  = L\n    function = '(t\u2070*F\u2070/l\u2070^3)*(4/3)*(Mgb/wGB)*exp(-Qm/(KB*T))'\n    material_property_names = 'Mgb Qm KB T wGB t\u2070 F\u2070 l\u2070'\n\n  [../]\n  [./force_density]  \n    type = ForceDensityMaterial\n    c = c\n    etas ='eta0 eta1'\n  [../]\n  \n  [./YoungsModulus]\n    type = ParsedMaterial\n    f_name  = E\n    function = '(3*c^2 - 2*c^3)*210e09'\n    #material_property_names = 'l\u2070'\n    args = 'c'\n  [../]\n  [./poissons_ratio]\n    type = ParsedMaterial\n    f_name  = poissons_ratio\n    function = '(3*c^2 - 2*c^3)*0.3'\n    args = 'c'\n  [../]\n  [./ElasticityTensor]\n    type = ComputeVariableIsotropicElasticityTensor\n    youngs_modulus = E # N/m\u00b2\n    poissons_ratio = poissons_ratio\n    args = c\n  [../]\n  [./stress]\n    type = ComputeLinearElasticStress\n  [../]\n  [./elastic_free_energy]\n    type = ElasticEnergyMaterial\n    f_name = Fe\n    block = 0\n    args = 'c'\n    derivative_order = 2\n  [../]\n  [./free_energy]\n    type = DerivativeSumMaterial\n    block = 0\n    f_name = F\n    sum_materials = 'Fc Fe'\n    args = 'c eta0 eta1'\n    derivative_order = 2\n  [../]\n[]\n\n[BCs]\n  [./bcs]\n    #zero flux BC\n    type = NeumannBC\n    value = 0\n    variable = c\n    boundary = '0 1 2 3'\n  [../]\n  [./bottom_x]\n    type = DirichletBC\n    variable = disp_x\n    boundary = bottom\n    value = 0\n  [../]\n  [./bottom_y]\n    type = DirichletBC\n    variable = disp_y\n    boundary = bottom\n    value = 0\n  [../]\n  [./Pressure]\n    [./right]\n      boundary = 'right left top'\n      function = 10e+3*t\n    [../]\n  [../]\n[]\n\n[AuxVariables]\n  [./bnds]\n  [../]\n  [./free_energy]\n    order = CONSTANT\n    family = MONOMIAL\n  [../]\n  [./df00]\n    order = CONSTANT\n    family = MONOMIAL\n  [../]\n  [./df01]\n    order = CONSTANT\n    family = MONOMIAL\n  [../]\n  [./df10]\n    order = CONSTANT\n    family = MONOMIAL\n  [../]\n  [./df11]\n    order = CONSTANT\n    family = MONOMIAL\n  [../]\n  [./unique_grains]\n    order = CONSTANT\n    family = MONOMIAL\n  [../]\n  [./var_indices]\n    order = CONSTANT\n    family = MONOMIAL\n  [../]\n  [./centroids]\n    order = CONSTANT\n    family = MONOMIAL\n  [../]\n  [./vadvx]\n    order = CONSTANT\n    family = MONOMIAL\n  [../]\n  [./vadvy]\n    order = CONSTANT\n    family = MONOMIAL\n  [../]\n[]\n\n[AuxKernels]\n  [./bnds]\n    type = BndsCalcAux\n    variable = bnds\n    var_name_base = eta\n    op_num = 2\n    v = 'eta0 eta1'\n  [../]\n  [./energy_density]\n    type = TotalFreeEnergy\n    variable = free_energy\n    f_name = F\n    kappa_names = 'kappa_c kappa_eta kappa_eta'\n    interfacial_vars = 'c eta0 eta1'\n  [../]\n  [./df01]\n    type = MaterialStdVectorRealGradientAux\n    variable = df01\n    index = 0\n    component = 1\n    property = force_density\n  [../]\n  [./df11]\n    type = MaterialStdVectorRealGradientAux\n    variable = df11\n    index = 1\n    component = 1\n    property = force_density\n  [../]\n  [./df00]\n    type = MaterialStdVectorRealGradientAux\n    variable = df00\n    index = 0\n    component = 0\n    property = force_density\n  [../]\n  [./df10]\n    type = MaterialStdVectorRealGradientAux\n    variable = df10\n    index = 1\n    component = 0\n    property = force_density\n  [../]\n  [./unique_grains]\n    type = FeatureFloodCountAux\n    variable = unique_grains\n    flood_counter = grain_center\n    field_display = UNIQUE_REGION\n    execute_on = timestep_begin\n  [../]\n  [./var_indices]\n    type = FeatureFloodCountAux\n    variable = var_indices\n    flood_counter = grain_center\n    field_display = VARIABLE_COLORING\n    execute_on = timestep_begin\n  [../]\n  [./centroids]\n    type = FeatureFloodCountAux\n    variable = centroids\n    execute_on = timestep_begin\n    field_display = CENTROID\n    flood_counter = grain_center\n  [../]\n  [./vadv_x]\n    type = GrainAdvectionAux\n    component = x\n    grain_tracker_object = grain_center\n    grain_force = grain_force\n    grain_volumes = grain_volumes\n    variable = vadvx\n  [../]\n  [./vadv_y]\n    type = GrainAdvectionAux\n    component = y\n    grain_tracker_object = grain_center\n    grain_force = grain_force\n    grain_volumes = grain_volumes\n    variable = vadvy\n  [../]\n[]\n\n[ICs]\n  [./ic_eta0]\n    type = SmoothCircleIC\n    variable = eta0\n    x1 = 20.0\n    y1 = 20.0\n    radius = 15.0\n    invalue = 1.0\n    outvalue = 0.0\n    int_width = 3.0\n  [../]\n  [./IC_eta1]\n    type = SmoothCircleIC\n    variable = eta1\n    x1 = 50.0\n    y1 = 20.0\n    radius = 15.0\n    invalue = 1.0\n    outvalue = 0.0\n    int_width = 3.0\n  [../]\n  [./ic_c]\n    type = SpecifiedSmoothCircleIC\n    invalue = 1.0\n    outvalue = 0.0\n    int_width = 3.0\n    x_positions = '20.0 50.0'\n    y_positions = '20.0 20.0'\n    z_positions = '0.0 0.0'\n    radii       = '15.0 15.0'\n    3D_spheres = false\n    variable = c\n    block = 0\n  [../]\n[]\n\n[VectorPostprocessors]\n  [./forces]\n    type = GrainForcesPostprocessor\n    grain_force = grain_force\n  [../]\n  [./grain_volumes]\n    type = FeatureVolumeVectorPostprocessor\n    flood_counter = grain_center\n    execute_on = 'initial timestep_begin'\n  [../]\n[]\n\n[Postprocessors]\n  [./average_c]\n    type = ElementAverageValue\n    variable = c\n    execute_on = 'initial timestep_end'\n  [../]\n[]\n\n[UserObjects]\n  [./grain_center]\n    type = GrainTracker\n    outputs = none\n    compute_var_to_feature_map = true\n    execute_on = 'initial timestep_begin'\n  [../]\n  [./grain_force]\n    type = ComputeGrainForceAndTorque\n    execute_on = 'linear nonlinear'\n    grain_data = grain_center\n    force_density = force_density\n    c = c\n    etas = 'eta0 eta1'\n  [../]\n[]\n\n[Preconditioning]\n  [./SMP]\n    type = SMP\n    full = true\n  [../]\n[]\n\n[Executioner]\n  type = Transient\n  scheme = bdf2\n  solve_type = NEWTON\n  petsc_options_iname = '-pc_type -ksp_gmres_restart -sub_ksp_type -sub_pc_type -pc_asm_overlap'\n  petsc_options_value = 'asm         31   preonly   lu      1'\n  l_tol = 1e-05\n  nl_max_its = 30\n  l_max_its = 30\n  nl_rel_tol = 1e-07\n  nl_abs_tol = 1e-09\n  start_time = 0.0\n  end_time = 10\n  dt = 0.5\n  [./TimeStepper]\n    type = IterationAdaptiveDT\n    cutback_factor = 0.5\n    dt = 0.5\n    growth_factor = 2\n    optimal_iterations = 8\n  [../]\n[]\n\n[Outputs]\n  exodus = true\n[]",
          "url": "https://github.com/idaholab/moose/discussions/20484",
          "updatedAt": "2024-12-14T03:27:32Z",
          "publishedAt": "2022-03-07T17:42:08Z",
          "category": {
            "name": "Q&A Modules: Phase field"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "GiudGiud"
                  },
                  "bodyText": "Tagging @SudiptaBiswas  @dschwen for help",
                  "url": "https://github.com/idaholab/moose/discussions/20484#discussioncomment-2311320",
                  "updatedAt": "2022-06-13T15:29:12Z",
                  "publishedAt": "2022-03-07T19:42:08Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": []
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "SudiptaBiswas"
                  },
                  "bodyText": "Judy, You need to non-dimensionalize your mechanical properties based on the scales you are using in the phase-field part. Otherwise, the chemical free energy and elastic energy can vary by several orders of magnitude. This could cause numerical issues and also provide incorrect evolution. You can also turn on automatic_scaling = true in the Executioner block if the residuals for different nonlinear variables are of different orders of magnitude.",
                  "url": "https://github.com/idaholab/moose/discussions/20484#discussioncomment-2311398",
                  "updatedAt": "2022-06-13T15:29:06Z",
                  "publishedAt": "2022-03-07T19:58:56Z",
                  "isAnswer": true,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "Judy-22"
                          },
                          "bodyText": "@SudiptaBiswas,\nI did as you recommended, but it does't work. And when I turned on the automatic_scaling = true, I have the following error.\n*** ERROR ***\nThe following error occurred in the object \"w\", of type \"MooseVariable\".\nVariableAllDoFMap not prepared for w . Check nonlocal coupling requirement for the variable.\nJudice",
                          "url": "https://github.com/idaholab/moose/discussions/20484#discussioncomment-2314583",
                          "updatedAt": "2022-06-17T01:30:17Z",
                          "publishedAt": "2022-03-08T08:16:47Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "@roystgnr @lindsayad any good docs on non local coupling?\nI started tracking it down from FEProblemBase but nothing came to mind",
                          "url": "https://github.com/idaholab/moose/discussions/20484#discussioncomment-2317919",
                          "updatedAt": "2022-06-17T01:30:45Z",
                          "publishedAt": "2022-03-08T16:29:27Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "lindsayad"
                          },
                          "bodyText": "@SudiptaBiswas IIRC is actually the original author of our non-local work. As far as the automatic scaling error, I would be happy to look into that. @Judy-22 do you have an input file that I could run that reproduces the error?",
                          "url": "https://github.com/idaholab/moose/discussions/20484#discussioncomment-2318394",
                          "updatedAt": "2022-06-17T01:30:46Z",
                          "publishedAt": "2022-03-08T17:35:43Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "SudiptaBiswas"
                          },
                          "bodyText": "The nonlocal kernels are applicable to integrodifferential equations, in this case, the rigid-body motion kernels. I have the description in my publication, https://link.springer.com/article/10.1007/s10853-017-1846-3, but there is no documentation on this on the MOOSE website, this was done before the new documentation system.  @Judy-22 I would recommend that you try coupling phase-field and mechanics without the rigid-body motion kernels first. This will simplify the problem and let you decide on the appropriate scales you need. Also, I noticed you have used the rigid-body motion kernels multiple times in your input file (once through the action and then added as seperate kernels).  So, definitely try without these and simplify the input file.",
                          "url": "https://github.com/idaholab/moose/discussions/20484#discussioncomment-2318545",
                          "updatedAt": "2022-06-17T01:31:27Z",
                          "publishedAt": "2022-03-08T17:57:07Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "Judy-22"
                          },
                          "bodyText": "@lindsayad,\nPlease, see attached the input file.\nInput_file.zip",
                          "url": "https://github.com/idaholab/moose/discussions/20484#discussioncomment-2318578",
                          "updatedAt": "2022-06-17T01:31:27Z",
                          "publishedAt": "2022-03-08T18:01:56Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "lindsayad"
                          },
                          "bodyText": "I can verify that adding Executioner/automatic_scaling=true to the existing polycrystal_action.i test checked into the repository yields the same error, so I'll see if I can fix this up ...",
                          "url": "https://github.com/idaholab/moose/discussions/20484#discussioncomment-2318889",
                          "updatedAt": "2022-06-17T01:31:28Z",
                          "publishedAt": "2022-03-08T18:51:06Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "lindsayad"
                          },
                          "bodyText": "Fix in #20502",
                          "url": "https://github.com/idaholab/moose/discussions/20484#discussioncomment-2319171",
                          "updatedAt": "2022-06-17T01:31:27Z",
                          "publishedAt": "2022-03-08T19:34:20Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "Judy-22"
                          },
                          "bodyText": "@SudiptaBiswas\nI did as you recommended, I removed the the rigid-body motion, and now it works fine for automatic_scale. But the solve do not converge.\nTime Step 1, time = 0.01, dt = 0.01\nPerforming automatic scaling calculation\n0 Nonlinear |R| = 2.113839e+00\n|residual|_2 of individual variables:\nc:      1.60534\nw:      0\neta0:   0.97242\neta1:   0.97242\ndisp_x: 1.82826e-05\ndisp_y: 1.72026e-05\n0 Linear |R| = 2.113839e+00\nLinear solve did not converge due to DIVERGED_PC_FAILED iterations 0\nPC failed due to SUBPC_ERROR",
                          "url": "https://github.com/idaholab/moose/discussions/20484#discussioncomment-2319875",
                          "updatedAt": "2022-06-17T01:31:51Z",
                          "publishedAt": "2022-03-08T22:13:24Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "Judy-22"
                          },
                          "bodyText": "@SudiptaBiswas\nI did as you recommended, I removed the the rigid-body motion, and now it works fine for automatic_scale. But the solve do not converge.\nTime Step 1, time = 0.01, dt = 0.01\nPerforming automatic scaling calculation\n0 Nonlinear |R| = 2.113839e+00\n|residual|_2 of individual variables:\nc: 1.60534\nw: 0\neta0: 0.97242\neta1: 0.97242\ndisp_x: 1.82826e-05\ndisp_y: 1.72026e-05\n0 Linear |R| = 2.113839e+00\nLinear solve did not converge due to DIVERGED_PC_FAILED iterations 0\nPC failed due to SUBPC_ERROR",
                          "url": "https://github.com/idaholab/moose/discussions/20484#discussioncomment-2340675",
                          "updatedAt": "2022-06-17T01:32:05Z",
                          "publishedAt": "2022-03-11T17:20:30Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "SudiptaBiswas"
                          },
                          "bodyText": "@Judy-22 Did the automatic scaling fix help? Are your material properties for the mechanical and phase-field part of the model are of similar orders of magnitude? Could you please post the new input file so I can test it?\nAlso, here is some guidance about failed solves,  https://mooseframework.inl.gov/application_usage/failed_solves.html",
                          "url": "https://github.com/idaholab/moose/discussions/20484#discussioncomment-2502413",
                          "updatedAt": "2022-06-17T01:32:14Z",
                          "publishedAt": "2022-04-04T17:43:58Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "Porosity and pore pressure sign convention",
          "author": {
            "login": "jmeier"
          },
          "bodyText": "Dear Moose community,\nI'd like to double-check two things with you:\nFirst, sign convention in SoildMechanics and PorousFlow:\nIn #20999, some info on the sign convention in SoildMechanics (formerly TensorMechanics) is given:\n\nIt is the same convention as TensorMechanics, which is:\n\na positive strain is extensional, which (usually) results from a positive (tensile) stress;\na negative strain is compressional, which (usually) results from a negative (compressive) stress\n\n\nJust to be sure, I'd like to spell it out for the pore-pressures:\n\nCompressive pore-pressures (e.g. below a free water table) have a positive sign?\nSuction is represented by pore-pressures having a negative sign?\n\nIs this correct?\nSecond, the physical unit of the permeability\nPorousFlowPermeabilityConst allowes to input a \"permeability\"-tensor (internally stored in PorousFlowPermeabilityBase._permeability_qp). It is correct, that the physical unit of the items of this permeability-tensor is \"length to the power of two\" (e.g. squaremeters, m\u00b2)?\nThanks for you help in advance.",
          "url": "https://github.com/idaholab/moose/discussions/29182",
          "updatedAt": "2024-12-04T09:24:24Z",
          "publishedAt": "2024-12-03T13:32:29Z",
          "category": {
            "name": "Q&A Modules: Porous Flow"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "GiudGiud"
                  },
                  "bodyText": "@cpgr",
                  "url": "https://github.com/idaholab/moose/discussions/29182#discussioncomment-11456471",
                  "updatedAt": "2024-12-04T03:31:34Z",
                  "publishedAt": "2024-12-04T03:31:33Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "or @1runer ?",
                          "url": "https://github.com/idaholab/moose/discussions/29182#discussioncomment-11456473",
                          "updatedAt": "2024-12-04T03:31:49Z",
                          "publishedAt": "2024-12-04T03:31:49Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "cpgr"
                  },
                  "bodyText": "Yes and yes (mostly). The units will be m^2 if everything else uses 'typical' units like Pa, kg/m^3 etc",
                  "url": "https://github.com/idaholab/moose/discussions/29182#discussioncomment-11456527",
                  "updatedAt": "2024-12-04T03:40:26Z",
                  "publishedAt": "2024-12-04T03:40:25Z",
                  "isAnswer": true,
                  "replies": {
                    "edges": []
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "Some questions about in external_petsc_problem of calling FormIFunction and FormIJacobian?",
          "author": {
            "login": "Wang-Yihu"
          },
          "bodyText": "Check these boxes if you have followed the posting rules.\n\n Q&A General is the most appropriate section for my question\n I have consulted the posting Guidelines on the Discussions front page\n I have searched the Discussions forum and my question has not been asked before\n I have searched the MOOSE website and the documentation does not answer my question\n I have formatted my post following the posting guidelines (screenshots as a last resort, triple back quotes around pasted text)\n\nQuestion\nHow are the function PETSC_EXTERN PetscErrorCode FormIFunction(TS, PetscReal, Vec, Vec, Vec, void *) and  PETSC_EXTERN PetscErrorCode FormIJacobian(TS, PetscReal, Vec, Vec, PetscReal, Mat, Mat, void *) called in the example of \\modules\\external_petsc_solver\\test\\tests\\external_petsc_problem\\moose_as_parent.i?\nIt seems that only the function PETSC_EXTERN PetscErrorCode PETScExternalSolverCreate(MPI_Comm, TS *) calls these two functions, but it also seems that this function is called only once by TS & ExternalPetscSolverApp::getPetscTS(). It's impossible! Because I find these two functions are called multiple times: in the petsc iteration step, for SNES Function norm, FormIFunction is called, and for  KSP Residual norm, FormIJacobian is called.\nSo how does this paradox happen?",
          "url": "https://github.com/idaholab/moose/discussions/29178",
          "updatedAt": "2024-12-03T10:38:32Z",
          "publishedAt": "2024-12-02T08:25:38Z",
          "category": {
            "name": "Q&A General"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "GiudGiud"
                  },
                  "bodyText": "hello\nin PETScExternalSolverCreate(MPI_Comm comm, TS * ts)\nwe have this call:\n  ierr = TSSetIFunction(*ts, NULL, FormIFunction, nullptr);\n  CHKERRQ(ierr);\n\nwhich tells the petsc time stepper what function it can use to compute Udot - RHS\nthen the time stepper will call this function on every time step",
                  "url": "https://github.com/idaholab/moose/discussions/29178#discussioncomment-11436492",
                  "updatedAt": "2024-12-02T13:13:17Z",
                  "publishedAt": "2024-12-02T13:13:17Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "Wang-Yihu"
                          },
                          "bodyText": "OK, I see it. It seems that:\nIf  FormIFunction and FormIJacobian are called, PETScExternalSolverCreate must be called before. And if PETScExternalSolverCreate  is called, getPetscTS() must be called before.\nBut it seems that both PETScExternalSolverCreate  and getPetscTS() are not called by every time step?",
                          "url": "https://github.com/idaholab/moose/discussions/29178#discussioncomment-11436817",
                          "updatedAt": "2024-12-02T13:48:23Z",
                          "publishedAt": "2024-12-02T13:48:23Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "But it seems that both PETScExternalSolverCreate and getPetscTS() are not called by every time step?\n\nFor the first one that's expected, the solver does not need to be re-created every time we solve, it can be re-used\nFor the second one, same reason, and the time stepper must be kept in an attribute or something because it is called every time step (as is the solver)",
                          "url": "https://github.com/idaholab/moose/discussions/29178#discussioncomment-11437461",
                          "updatedAt": "2024-12-02T14:46:59Z",
                          "publishedAt": "2024-12-02T14:46:59Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "Wang-Yihu"
                          },
                          "bodyText": "OK. I've found the calling routine: PETScDMDAMesh::PETScDMDAMesh calls TS & ExternalPetscSolverApp::getPetscTS, and TS & ExternalPetscSolverApp::getPetscTS calls PETScExternalSolverCreate. All of them are called only once.\nBut I still do not know how is it be re-used as you said when MOOSE only calls that once? And i do not know what is the time stepper must be kept in an attribute or something...\nOr do I make the mistake? In fact getPetscTS() is called for multiple times with time steps, not for only once, but i do not find this?",
                          "url": "https://github.com/idaholab/moose/discussions/29178#discussioncomment-11437809",
                          "updatedAt": "2024-12-02T15:19:48Z",
                          "publishedAt": "2024-12-02T15:13:00Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "Wang-Yihu"
                          },
                          "bodyText": "Haha, I find the answer. They are called by functions in /home/sjtu/mambaforge3/envs/moose/lib/libpetsc.so.3.019 in conda environment maybe generated by PETScDiffusionFDM.C which do not appear in \\modules\\external_petsc_solver\\.\nWe can use gdb tool and backtrace to find this.\n\nMake the dbg file. In projects/moose/modules/external_petsc_solver directory:\n\nconda activate moose\nMETHOD=dbg make -j8\n\n\nIn projects/moose/modules/external_petsc_solver/test/tests/external_petsc_problem\n\ngdb --args ../../../external_petsc_solver_dbg -i moose_as_parent.i\nbreak FormIFunction\n\ny\n\nrun\n\nbacktrace\n\nc\n\nIt will return:\n#0  FormIFunction (ts=0x555555caba00, U=0x555555fac860, Udot=0x555555fbd520, \n    F=0x555555f724c0)\n    at /home/sjtu/projects/moose/modules/external_petsc_solver/src/petscsolver/PETScDiffusionFDM.C:202\n#1  0x00007fffed381396 in TSComputeIFunction ()\n   from /home/sjtu/mambaforge3/envs/moose/lib/libpetsc.so.3.019\n#2  0x00007fffed3beace in SNESTSFormFunction_Theta ()\n   from /home/sjtu/mambaforge3/envs/moose/lib/libpetsc.so.3.019\n#3  0x00007fffed37e37a in SNESTSFormFunction ()\n   from /home/sjtu/mambaforge3/envs/moose/lib/libpetsc.so.3.019\n#4  0x00007fffed32db39 in SNESComputeFunction ()\n   from /home/sjtu/mambaforge3/envs/moose/lib/libpetsc.so.3.019\n#5  0x00007fffed376b57 in SNESSolve_NEWTONLS ()\n   from /home/sjtu/mambaforge3/envs/moose/lib/libpetsc.so.3.019\n#6  0x00007fffed334a7d in SNESSolve ()\n   from /home/sjtu/mambaforge3/envs/moose/lib/libpetsc.so.3.019\n#7  0x00007fffed3bf0a8 in TSStep_Theta ()\n   from /home/sjtu/mambaforge3/envs/moose/lib/libpetsc.so.3.019\n#8  0x00007fffed383198 in TSStep ()\n   from /home/sjtu/mambaforge3/envs/moose/lib/libpetsc.so.3.019\n#9  0x00007fffed385060 in TSSolve ()\n   from /home/sjtu/mambaforge3/envs/moose/lib/libpetsc.so.3.019\n#10 0x00007ffff7f62d1a in externalPETScDiffusionFDMSolve (ts=0x555555caba00, \n--Type <RET> for more, q to quit, c to continue without paging--c\n    0x555555d12d20, u=0x555555d123f0, dt=0.20000000000000001, time=0.20000000000000001, converged=0x555555cc8a08) at /home/sjtu/projects/moose/modules/external_petsc_solver/src/petscsolver/PETScDiffusionFDM.C:186\n#11 0x00007ffff7f68936 in ExternalPETScProblem::externalSolve (this=0x555555cc5c80) at /home/sjtu/projects/moose/modules/external_petsc_solver/src/problems/ExternalPETScProblem.C:75\n#12 0x00007ffff6085b34 in ExternalProblem::solve (this=0x555555cc5c80) at /home/sjtu/projects/moose/framework/src/problems/ExternalProblem.C:62\n#13 0x00007ffff531b4bc in FEProblemSolve::solve (this=0x555555d2ecb0) at /home/sjtu/projects/moose/framework/src/executioners/FEProblemSolve.C:284\n#14 0x00007ffff5320384 in FixedPointSolve::solveStep (this=0x555555cb1280, begin_norm=@0x555555f82090: 0, end_norm=@0x555555f07ab0: 0, transformed_dofs=...) at /home/sjtu/projects/moose/framework/src/executioners/FixedPointSolve.C:426\n#15 0x00007ffff531f24a in FixedPointSolve::solve (this=0x555555cb1280) at /home/sjtu/projects/moose/framework/src/executioners/FixedPointSolve.C:278\n#16 0x00007ffff65f060c in TimeStepper::step (this=0x555555d626c0) at /home/sjtu/projects/moose/framework/src/timesteppers/TimeStepper.C:168\n#17 0x00007ffff532ee32 in Transient::takeStep (this=0x555555d2e970, input_dt=0.20000000000000001) at /home/sjtu/projects/moose/framework/src/executioners/Transient.C:432\n#18 0x00007ffff5bba95f in TransientMultiApp::solveStep (this=0x555555a9f570, dt=0.20000000000000001, target_time=0.20000000000000001, auto_advance=false) at /home/sjtu/projects/moose/framework/src/multiapps/TransientMultiApp.C:414\n#19 0x00007ffff60cd2e6 in FEProblemBase::execMultiApps (this=0x5555559fcc00, type=..., auto_advance=false) at /home/sjtu/projects/moose/framework/src/problems/FEProblemBase.C:4800\n#20 0x00007ffff531fe79 in FixedPointSolve::solveStep (this=0x5555557bc7e0, begin_norm=@0x555555eff870: 0, end_norm=@0x555555efe1e0: 0, transformed_dofs=...) at /home/sjtu/projects/moose/framework/src/executioners/FixedPointSolve.C:387\n#21 0x00007ffff531f24a in FixedPointSolve::solve (this=0x5555557bc7e0) at /home/sjtu/projects/moose/framework/src/executioners/FixedPointSolve.C:278\n#22 0x00007ffff65f060c in TimeStepper::step (this=0x5555559cceb0) at /home/sjtu/projects/moose/framework/src/timesteppers/TimeStepper.C:168\n#23 0x00007ffff532ee32 in Transient::takeStep (this=0x555555a591c0, input_dt=-1) at /home/sjtu/projects/moose/framework/src/executioners/Transient.C:432\n#24 0x00007ffff532d924 in Transient::execute (this=0x555555a591c0) at /home/sjtu/projects/moose/framework/src/executioners/Transient.C:307\n#25 0x00007ffff4fd2902 in MooseApp::executeExecutioner (this=0x5555557a8ad0) at /home/sjtu/projects/moose/framework/src/base/MooseApp.C:1138\n#26 0x00007ffff4fd977c in MooseApp::run (this=0x5555557a8ad0) at /home/sjtu/projects/moose/framework/src/base/MooseApp.C:1513\n#27 0x00005555555576a9 in main (argc=3, argv=0x7fffffffdab8) at /home/sjtu/projects/moose/modules/external_petsc_solver/src/main.C:35\n\nOh! The route is ExternalPETScProblem::externalSolve calls externalPETScDiffusionFDMSolve, externalPETScDiffusionFDMSolve generates lots of libpetsc.so.3.019, and functions in libpetsc.so.3.019 calls FormIFunction",
                          "url": "https://github.com/idaholab/moose/discussions/29178#discussioncomment-11446932",
                          "updatedAt": "2024-12-03T10:38:31Z",
                          "publishedAt": "2024-12-03T10:38:30Z",
                          "isAnswer": true
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "There is a problem with installing MOOSE offline and configuring petsc",
          "author": {
            "login": "shin-chan-cpu"
          },
          "bodyText": "Check these boxes if you have followed the posting rules.\n\n I have consulted the Posting Guidelines.\n I have searched the Discussions Forum and MOOSE Framework Troubleshooting and have not found what I was looking for\n Q&A Getting Started is the most appropriate category for my question (trouble installing, beginner user, ...)\n\nIssue or question about MOOSE\nWhen I refer to the offline installation tutorial on the official website:https://mooseframework.inl.gov/releases/moose/2021-05-18/getting_started/installation/offline_installation.html\nAfter the prerequisites were installed, I downloaded all the files I said, and when I ran the petsc configuration script, I got the following error\n---------------------------------------------------------------------------------------------\n  Error during download/extract/detection of HDF5:\n  file could not be opened successfully\n  Downloaded package HDF5 from: /root/offline/downloads/hdf5-1.14.3-p1.tar.bz2 is not a\n  tarball.\n  [or installed python cannot process compressed files]\n  * If you are behind a firewall - please fix your proxy and rerun ./configure\n  For example at LANL you may need to set the environmental variable http_proxy (or\n  HTTP_PROXY?) to  http://proxyout.lanl.gov\n  * You can run with --with-packages-download-dir=/adirectory and ./configure will instruct\n  you what packages to download manually\n  * or you can download the above URL manually, to\n  /yourselectedlocation/hdf5-1.14.3-p1.tar.bz2\n  and use the configure option:\n  --download-hdf5=/yourselectedlocation/hdf5-1.14.3-p1.tar.bz2\nBut when I checked again, my file was already in the downloads folder he said, and I tried to add the configuration again and still got this error after adding --download-hdf5, I want to ask why?\n(Optional) code in question / simulation log / errors\nNo response\nEncountering Errors? Please include diagnostic output\n#!/bin/bash\n#* This file is part of the MOOSE framework\n#* https://www.mooseframework.org\n#*\n#* All rights reserved, see COPYRIGHT for full restrictions\n#* https://github.com/idaholab/moose/blob/master/COPYRIGHT\n#*\n#* Licensed under LGPL 2.1, please see LICENSE for details\n#* https://www.gnu.org/licenses/lgpl-2.1.html\n\nSCRIPT_DIR=\"$( cd \"$( dirname \"${BASH_SOURCE[0]}\" )\" && pwd )\"\n\nfunction ecolor_support()\n{\n    ECOLOR_SUPPORT=\"${ECOLOR_SUPPORT:-$(tput colors)}\"\n    echo \"${ECOLOR_SUPPORT}\"\n}\n\nfunction get_value()\n{\n    grep \"^$1: \" \"${SCRIPT_DIR}\"/../framework/doc/packages_config.yml | awk '{print $2}'\n}\n\nfunction print_failure_and_exit()\n{\n    if [[ -n \"${CANCELED}\" ]]; then exit 1; fi\n    print_red \"ERROR: \"\n    printf \"Printing report.\\n\"\n    env_test\n    printf '\n\nThere was an error while %s\n\nPlease report the entirety of the output of diagnostics on\nthis terminal to either YOUR existing post OR a new post on\nhttps://github.com/idaholab/moose/discussions\\n' \"$(print_red \"$@\")\"\n    exit_on_failure 1\n}\n\nfunction print_reset()\n{\n    if [[ \"${NO_COLOR:-0}\" == 0 ]]; then\n        printf \"\\033[0m\"\n    fi\n}\n\nfunction print_sep()\n{\n    max_len=$(tput cols)\n    if [[ $max_len -gt 100 ]]; then max_len=100; fi\n    printf -v foo \"%${max_len}s\" '' && echo \"${foo//?/#}\"\n}\n\nfunction print_bold()\n{\n    if [[ \"${NO_COLOR}\" == 1 ]]; then\n        printf '%b' \"$@\"\n    elif [[ \"$(ecolor_support)\" -ge 256 ]]; then\n        printf '\\033[1;37m%b' \"$@\"\n    else\n        printf '\\033[1m%b' \"$@\"\n    fi\n    print_reset\n}\nfunction print_red()\n{\n    if [[ \"${NO_COLOR}\" == 1 ]]; then\n        printf '%b' \"$@\"\n    else\n        printf '\\033[1;91m%b' \"$@\"\n    fi\n    print_reset\n}\n\nfunction print_orange()\n{\n    if [[ \"${NO_COLOR}\" == 1 ]]; then\n        printf '%b' \"$@\"\n    elif [[ \"$(ecolor_support)\" -ge 256 ]]; then\n        printf \"\\033[38;5;202m%b\" \"$@\"\n    else\n        printf \"\\033[0;33m%b\" \"$@\"\n    fi\n    print_reset\n}\n\nfunction print_green()\n{\n    if [[ \"${NO_COLOR}\" == 1 ]]; then\n        printf '%b' \"$@\"\n    else\n        printf \"\\033[1;92m%b\" \"$@\"\n    fi\n    print_reset\n}\n\nfunction run_command()\n{\n    if [[ \"${NO_COLOR}\" == 1 ]]; then\n        true\n    elif [[ \"$(ecolor_support)\" -ge 256 ]]; then\n        printf \"\\033[38;5;236m\"\n    else\n        printf \"\\033[1;30m\"\n    fi\n    # shellcheck disable=SC2068\n    $@\n    exit_code=$?\n    print_reset\n    return $exit_code\n}\n\nfunction create_tmp()\n{\n    if [[ -n \"$CTMP_DIR\" ]]; then echo \"${CTMP_DIR}\"; return; fi\n    if [[ \"$(uname)\" == 'Darwin' ]]; then\n        local TMP_DIR=\"${TMP_DIR:-\"$(mktemp -d -t MOOSE)\"}\"\n    else\n        local TMP_DIR=\"${TMP_DIR:-\"$(mktemp -d -t MOOSE.XXXXXXXX)\"}\"\n    fi\n    echo \"${TMP_DIR}\"\n}\n\nfunction exit_on_failure()\n{\n    if [[ \"${NO_FAILURE}\" == '1' ]]; then\n        printf '\\n--continue-on-fail enabled. Not exiting.\\n\\n'\n        return\n    fi\n    exit \"${1}\"\n}\n\nfunction print_help()\n{\n    # shellcheck disable=SC2034\n    args=(\"-h|--help\"\\\n          \"-f|--full-build\"\\\n          \"-r|--run-checks\"\\\n          \"-c|--conda-channel\"\\\n          \"--continue-on-fail\"\\\n          \"-v|--verbose\"\\\n          \"--no-colors\")\n\n    # shellcheck disable=SC2034\n    args_about=(\"Print this message and exit.\"\\\n                \"Build PETSc, libMesh, WASP, MOOSE, and then run entire test suite.\"\\\n                \"Build MOOSE and then run aggregated tests.\"\\\n                \"Prioritize MOOSE packages with this channel (default is public).\"\\\n                \"Do not stop on failure. If this option works, you have intermittent network issues.\"\\\n                \"Print additional output from commands being executed.\"\\\n                \"Do not print color.\")\n\n    printf '\\nSyntax:\\n\\t./%s\\n\\nOptions:\\n\\n' \"$(basename \"$0\")\"\n    print_args args args_about\n    printf '\\nInfluencial Environment Variables:\\n\n\\tMETHODS             libMesh build type \\\"opt dbg devel oprof\\\" (default: opt)\n\\tMETHOD              MOOSE build type (default: \\\"opt\\\")\n\\tMOOSE_JOBS          Cores available during make\n\nProxies/Certificate Authority environmet variables:\n(corporate work machines may require that these be set)\n\n\\tREQUESTS_CA_BUNDLE=%s\n\\tSSL_CERT_FILE=%s\n\\tCURL_CA_BUNDLE=%s\n\\thttp_proxy=%s\n\\thttps_proxy=%s\n\nSupplying no arguments prints useful environment information.\\n\\n' \\\n \"${REQUESTS_CA_BUNDLE:-'not set'}\" \\\n \"${SSL_CERT_FILE:-'not set'}\" \\\n \"${CURL_CA_BUNDLE:-'not set'}\" \\\n \"${HTTP_PROXY:-${http_proxy:-'not set'}}\" \\\n \"${HTTPS_PROXY:-${https_proxy:-'not set'}}\"\n}\n\nfunction ctl_c()\n{\n    printf \"\\033[0m\\n\\nYou canceled diagnostics. Running clean-up routines.\nPlease do not ctl-c again, and allow the temp directory to be deleted.\\n\"\n    export CANCELED=true\n    exit 1\n}\n\n# Check Arguments. If PRISTINE is already set, break out of argument checking\nif [[ -z \"$PRISTINE_ENVIRONMENT\" ]]; then\n    # shellcheck disable=SC1091\n    source \"${SCRIPT_DIR}\"/functions/help_system\n    while [[ \"$#\" -gt 0 ]]; do\n        case \"${1}\" in\n            -h|--help)\n                print_help; exit 0;;\n            -f|--full-build)\n                export FULL_BUILD=1; shift ;;\n            -r|--run-checks)\n                export RUN_CHECKS=1; shift ;;\n            -c|--conda-channel)\n                if ! [[ \"${2}\" =~ ^http|^file ]]; then\n                    print_red '\\ninvalid -c|--conda-channel value\\n'\n                    print_help; exit 1\n                fi\n                export CONDA_CHANNEL=\"${2}\"; shift 2;;\n            --continue-on-fail)\n                export NO_FAILURE=1; shift ;;\n            -v|--verbose)\n                export VERBOSITY=1; shift ;;\n            --no-colors)\n                export NO_COLOR=1; shift ;;\n            *)\n                printf 'Unknown argument: %s\\n' \"${1}\"; exit 1;;\n        esac\n    done\n    # default to printing active environment, otherwise do not print active environment\n    # (basically I want the default behavior to behave like the previous diagnostic.sh script)\n    if [[ -n \"${FULL_BUILD}\" ]] || [[ -n \"${RUN_CHECKS}\" ]]; then\n        NO_ENVIRONMENT=1\n    fi\n    # FULL_BUILD or RUN_CHECKS is set, but not PRISTINE_ENVIRONMENT\n    if [[ \"${PRISTINE_ENVIRONMENT}\" != 0 ]] && [[ \"${NO_ENVIRONMENT}\" == 1 ]]; then\n        # Obtain a temp directory\n        export CTMP_DIR\n        CTMP_DIR=$(create_tmp)\n        # Delete temporary directory at any time this script exits\n        trap 'printf \"\\033[0m\\n\\nDeleting temporary directory\\n\\n\\t${CTMP_DIR}\\n\"; rm -rf \"$CTMP_DIR\";' EXIT\n        printf \"Beginning in a pristine environment\\n\"\n        env -i bash --rcfile <(echo \"CLEAN_ENV='True' \\\n          TERM=${TERM:-'xterm'} \\\n          PRISTINE_ENVIRONMENT=1 \\\n          METHODS=${METHODS:-opt} \\\n          METHOD=${METHOD:-opt} \\\n          MOOSE_JOBS=${MOOSE_JOBS:-6} \\\n          FULL_BUILD=${FULL_BUILD:-0} \\\n          RUN_CHECKS=${RUN_CHECKS:-0} \\\n          NO_FAILURE=${NO_FAILURE:-0} \\\n          VERBOSITY=${VERBOSITY:-0} \\\n          NO_COLOR=${NO_COLOR:-0} \\\n          CONDA_CHANNEL=${CONDA_CHANNEL:-'https://conda.software.inl.gov/public'} \\\n          REQUESTS_CA_BUNDLE=${REQUESTS_CA_BUNDLE:-''} \\\n          SSL_CERT_FILE=${SSL_CERT_FILE:-''} \\\n          CURL_CA_BUNDLE=${CURL_CA_BUNDLE:-''} \\\n          CTMP_DIR=${CTMP_DIR} \\\n          NO_ENVIRONMENT=1 \\\n          ${SCRIPT_DIR}/${BASH_SOURCE[0]}; exit\")\n        exit $?\n    else\n        # Set defaults\n        export PRISTINE_ENVIRONMENT=${PRISTINE_ENVIRONMENT:-0}\n        export FULL_BUILD=${FULL_BUILD:-0}\n        export METHOD=${METHOD:-opt}\n        export METHODS=${METHODS:-opt}\n        export MOOSE_JOBS=${MOOSE_JOBS:-6}\n        export RUN_CHECKS=${RUN_CHECKS:-0}\n        export NO_FAILURE=${NO_FAILURE:-0}\n        export VERBOSITY=${VERBOSITY:-0}\n        export NO_COLOR=${NO_COLOR:-0}\n        export CONDA_CHANNEL=${CONDA_CHANNEL:-'https://conda.software.inl.gov/public'}\n        export REQUESTS_CA_BUNDLE=${REQUESTS_CA_BUNDLE:-''}\n        export SSL_CERT_FILE=${SSL_CERT_FILE:-''}\n        export CURL_CA_BUNDLE=${CURL_CA_BUNDLE:-''}\n        export NO_ENVIRONMENT=${NO_ENVIRONMENT:-0}\n    fi\nfi\n\n# Augment additional pristine environment variables\nif [[ \"${PRISTINE_ENVIRONMENT}\" == \"1\" ]]; then\n    trap 'ctl_c' INT\n    # Further sandbox our environment\n    export HOME=${CTMP_DIR}\n    # Make our environment more sane\n    export PATH=/bin:/usr/bin:/sbin\n    if [[ \"$(ecolor_support)\" -ge 256 ]]; then\n        export TERM=xterm-256color\n    else\n        export TERM=xterm\n    fi\n    # Make our environment safe\n    umask 027\n    # It's not enough to set these with --rcfile.\n    # They must be exported to be inherited by child processes\n    export CTMP_DIR REQUESTS_CA_BUNDLE SSL_CERT_FILE CURL_CA_BUNDLE\n    print_sep\n    printf 'Temporary Directory:\\n%s\\n' \"${CTMP_DIR}\"\nfi\n\n# Make print_environment available in any step\n# shellcheck disable=SC1091\nsource \"${SCRIPT_DIR}\"/functions/diagnostic_environment.sh\n\n# Do only the one thing if default behavior\nif [[ \"${NO_ENVIRONMENT}\" == 0 ]]; then print_environment; exit; fi\n# Do all the things\nprintf '\nNote: The following steps will be performed in a temporary directory,\n      and will be deleted when finished or upon encountering an error.\n\n      The purpose of this tool is to determine if external factors\n      are preventing you from building or running MOOSE.\n\n      Errors encountered will usually mean network or hardware related\n      causes (VPN, Network Proxies, Corporate SSL Certificates, etc).\n\n      If diagnostics runs to completion without errors then likely the\n      issue will be something in your environment as to the cause. If\n      this is case, run %s again without any arguments, and\n      carefully scrutinize the output.\\n' \"$(basename \"$0\")\"\nprint_sep\n# shellcheck disable=SC1091\nsource \"${SCRIPT_DIR}\"/functions/diagnostic_conda.sh\n# shellcheck disable=SC1091\nsource \"${SCRIPT_DIR}\"/functions/diagnostic_application.sh\n# shellcheck disable=SC1091\nsource \"${SCRIPT_DIR}\"/functions/diagnostic_tests.sh\n\n# Get individual packages for now, until moose-mpi becomes available\nexport MOOSE_PACKAGES\nMOOSE_PACKAGES=\"moose-mpi moose-libmesh-vtk moose-tools $(get_value 'default_mpi') \\\n zlib python packaging pyaml jinja2\"\n\ninstall_conda\ncreate_env\nbuild_application\ntest_application",
          "url": "https://github.com/idaholab/moose/discussions/29173",
          "updatedAt": "2024-12-03T08:16:20Z",
          "publishedAt": "2024-12-01T09:17:21Z",
          "category": {
            "name": "Q&A Getting Started"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "milljm"
                  },
                  "bodyText": "My guess is you ran curl (an example):\ncd ~/offline/downloads\ncurl -L -O https://bitbucket.org/petsc/pkg-fblaslapack/get/v3.4.2-p3.tar.gz\n\nwhile on the machine with no access to the internet?\nThis will produce the files, with nothing but HTML web content in them (explaining that the file could not be downloaded).\nCan we verify that these files are indeed tarballs?\nfile /root/offline/downloads/hdf5-1.14.3-p1.tar.bz\nShould report what kind of file it is.",
                  "url": "https://github.com/idaholab/moose/discussions/29173#discussioncomment-11437992",
                  "updatedAt": "2024-12-02T15:27:38Z",
                  "publishedAt": "2024-12-02T15:27:37Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "shin-chan-cpu"
                          },
                          "bodyText": "My guess is you ran curl (an example):\n\nActually, I do use it on a computer with an internet connection\n\nShould report what kind of file it is.\n\nThe results for me are shown below\n./hdf5-1.14.3-p1.tar.bz:bzip2 compressed data, block size = 900k",
                          "url": "https://github.com/idaholab/moose/discussions/29173#discussioncomment-11445422",
                          "updatedAt": "2024-12-03T08:16:21Z",
                          "publishedAt": "2024-12-03T08:16:20Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      }
    ]
  }
}