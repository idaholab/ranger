{
  "discussions": {
    "pageInfo": {
      "hasNextPage": true,
      "endCursor": "Y3Vyc29yOnYyOpK5MjAyMi0wMi0yMlQxMDo1NjozMS0wNzowMM4AOv_g"
    },
    "edges": [
      {
        "node": {
          "title": "Solve did not converge",
          "author": {
            "login": "Salma-Mao"
          },
          "bodyText": "Dear everyone,\nI am new to MOOSE. When I am trying  to compile the project  GrandPotentialPlanarGrowth.i, I find that the example does not converge. What can I do to resolve this problem.\n\nThanks,\nMS",
          "url": "https://github.com/idaholab/moose/discussions/20394",
          "updatedAt": "2022-07-06T11:55:10Z",
          "publishedAt": "2022-02-24T14:41:40Z",
          "category": {
            "name": "Q&A General"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "ykvishal"
                  },
                  "bodyText": "I could run this simulation.",
                  "url": "https://github.com/idaholab/moose/discussions/20394#discussioncomment-2245953",
                  "updatedAt": "2022-07-06T11:55:29Z",
                  "publishedAt": "2022-02-24T18:17:52Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": []
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "GiudGiud"
                  },
                  "bodyText": "@shuine-09\nPlease see this page to diagnose convergence issues.\nhttps://mooseframework.inl.gov/application_usage/failed_solves.html\n@ykvishal and @shuine-09 anything particular in how you ran the case (#mpi, threads?, old MOOSE version or new one?) ?",
                  "url": "https://github.com/idaholab/moose/discussions/20394#discussioncomment-2246293",
                  "updatedAt": "2022-07-06T11:55:39Z",
                  "publishedAt": "2022-02-24T19:16:44Z",
                  "isAnswer": true,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "ykvishal"
                          },
                          "bodyText": "In my case, I installed MOOSE 2 weeks ago. Also I could run this input file with single core, 2 cores and 12 cores. It worked all the time. Although, the number of time-steps were different in all cases.",
                          "url": "https://github.com/idaholab/moose/discussions/20394#discussioncomment-2246409",
                          "updatedAt": "2022-07-06T11:55:34Z",
                          "publishedAt": "2022-02-24T19:39:27Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "Salma-Mao"
                          },
                          "bodyText": "I run this simulation again.\n\nHowever, When  output files are opened   by ParaView 5.10.0, I get the Error. Did the Error mean that the solve did not converge?",
                          "url": "https://github.com/idaholab/moose/discussions/20394#discussioncomment-2248217",
                          "updatedAt": "2022-07-06T11:55:35Z",
                          "publishedAt": "2022-02-25T02:55:53Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "That version of paraview isn\u2019t compatible with moose because we name side sets and nodesets the same for the most part.\nPlease either downgrade or upgrade",
                          "url": "https://github.com/idaholab/moose/discussions/20394#discussioncomment-2248266",
                          "updatedAt": "2022-07-06T11:56:05Z",
                          "publishedAt": "2022-02-25T03:03:38Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "Salma-Mao"
                          },
                          "bodyText": "The version of ParaView have been changed. And the output has been opened successfully. Thanks for your help.",
                          "url": "https://github.com/idaholab/moose/discussions/20394#discussioncomment-2248786",
                          "updatedAt": "2022-07-06T11:56:08Z",
                          "publishedAt": "2022-02-25T03:31:55Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "Error with compiling my own project",
          "author": {
            "login": "Salma-Mao"
          },
          "bodyText": "Dear everyone,\nI am new to MOOSE. I am trying create a new project. However, when I am trying to compile the project I am getting:\nroot@dfec67e2b373:/usr/local/workspase#  cd phasefield1/\nroot@dfec67e2b373:/usr/local/workspase/phasefield1# make -j4\nUsing HIT from /opt/moose/framework/contrib/hit\nChecking if header needs updating: /opt/moose/framework/include/base/MooseRevision.h...\nroot@dfec67e2b373:/usr/local/workspase/phasefield1#\n\nI do not know what is the matter. Anyone can help me with the problem.\nthanks,\nMS",
          "url": "https://github.com/idaholab/moose/discussions/20380",
          "updatedAt": "2022-08-27T08:51:57Z",
          "publishedAt": "2022-02-23T07:59:31Z",
          "category": {
            "name": "Q&A Getting Started"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "loganharbour"
                  },
                  "bodyText": "Looks like you're using docker. Did you use stork to create your application?\nSee https://mooseframework.inl.gov/getting_started/new_users.html#create-an-app. You should run /opt/moose/scripts/stork.sh <APPNAME> in whatever directory where you want your application to be made.",
                  "url": "https://github.com/idaholab/moose/discussions/20380#discussioncomment-2237113",
                  "updatedAt": "2022-08-27T08:52:32Z",
                  "publishedAt": "2022-02-23T14:57:30Z",
                  "isAnswer": true,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "Salma-Mao"
                          },
                          "bodyText": "I have created the application in the same way. However, when I compile the project I get the problem.",
                          "url": "https://github.com/idaholab/moose/discussions/20380#discussioncomment-2242212",
                          "updatedAt": "2022-08-27T08:52:32Z",
                          "publishedAt": "2022-02-24T08:19:01Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "loganharbour"
                          },
                          "bodyText": "# cd ~\n# ls\n# /opt/moose/scripts/stork.sh foo\nInitialized empty Git repository in /root/foo/.git/\n\n*** Please tell me who you are.\n\nRun\n\n  git config --global user.email \"you@example.com\"\n  git config --global user.name \"Your Name\"\n\nto set your account's default identity.\nOmit --global to set the identity only in this repository.\n\nfatal: unable to auto-detect email address (got 'root@60046d880d48.(none)')\nMOOSE app created in '/root/foo'\n\nTo store your changes on github:\n    1. log in to your account\n    2. Create a new repository named foo\n    3. in this terminal run the following commands:\n         cd /root/foo\n         git remote add origin https://github.com/YourGitHubUserName/foo\n         git commit -m \"initial commit\"\n         git push -u origin main\n\nTo automatically enforce MOOSE C++ code style in your commits, run:\n\n    cd /root/foo\n    ./scripts/install-format-hook.sh\n\n# cd foo\n# ls\nLICENSE  Makefile  README.md  doc  include  run_tests  scripts\tsrc  test  testroot  unit\n# make -j 12\nChecking if header needs updating: /opt/moose/framework/include/base/MooseRevision.h...\nRebuilding symlinks in /opt/moose/modules/module_loader/build/header_symlinks\nRebuilding symlinks in /root/foo/build/header_symlinks\nCompiling C++ with suffix (in opt mode) /opt/moose/modules/module_loader/src/ModulesApp.C...\nCompiling C++ (in opt mode) /root/foo/src/base/fooApp.C...\nCompiling C++ (in opt mode) /root/foo/src/main.C...\nCompiling C++ (in opt mode) /root/foo/test/src/base/fooTestApp.C...\nLinking Library /opt/moose/modules/module_loader/lib/libmodule_loader_with-opt.la...\nLinking Library /root/foo/lib/libfoo-opt.la...\nLinking Library /root/foo/test/lib/libfoo_test-opt.la...\nLinking Executable /root/foo/foo-opt...\n# ./run_tests\ntest:kernels/simple_diffusion.test ........................................................................ OK\n--------------------------------------------------------------------------------------------------------------\nRan 1 tests in 0.3 seconds. Average test time 0.2 seconds, maximum test time 0.2 seconds.\n1 passed, 0 skipped, 0 pending, 0 failed\n\nWorks without issue for me.",
                          "url": "https://github.com/idaholab/moose/discussions/20380#discussioncomment-2244686",
                          "updatedAt": "2022-08-27T08:52:32Z",
                          "publishedAt": "2022-02-24T15:10:16Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "Salma-Mao"
                          },
                          "bodyText": "Thanks for your help. I have solved the problem. Thanks again.",
                          "url": "https://github.com/idaholab/moose/discussions/20380#discussioncomment-2248142",
                          "updatedAt": "2022-09-15T10:26:49Z",
                          "publishedAt": "2022-02-25T02:32:14Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "How to add this equation to the kernel?",
          "author": {
            "login": "YuhangNIU"
          },
          "bodyText": "Hello all,\nI have a small question. Suppose that one-dimensional geometry is divided into n elements. The equation in element i (0<i<n) is:\n\nCould anyone kindly tell me how to add this problem to the kernel?",
          "url": "https://github.com/idaholab/moose/discussions/20353",
          "updatedAt": "2022-07-14T02:43:11Z",
          "publishedAt": "2022-02-21T13:54:13Z",
          "category": {
            "name": "Q&A General"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "GiudGiud"
                  },
                  "bodyText": "Hello\nCan you write this [a,b,c] stencil as a gradient / laplacian / other known operator or is it arbitrary?\nDo you want to use a finite volume or finite element discretization?\nFor the d term, you can use:\nhttps://mooseframework.inl.gov/source/kernels/BodyForce.html\nGuillaume",
                  "url": "https://github.com/idaholab/moose/discussions/20353#discussioncomment-2222133",
                  "updatedAt": "2022-07-14T02:43:11Z",
                  "publishedAt": "2022-02-21T15:50:37Z",
                  "isAnswer": true,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "YuhangNIU"
                          },
                          "bodyText": "Hi,\nThanks for your reply. These parameters (a, b, c, d) are constant. By the way, the variable in this equation is W.\nI think any discretization is acceptable, as long as it can be expressed in this equation.  I don't know how the kernel can be constructed.\nThank you,\nYuhang",
                          "url": "https://github.com/idaholab/moose/discussions/20353#discussioncomment-2224957",
                          "updatedAt": "2022-07-14T02:43:11Z",
                          "publishedAt": "2022-02-22T00:58:13Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "hugary1995"
                          },
                          "bodyText": "This is neither FE nor FV, but looks more like finite differencing. What's your motivation of using moose?",
                          "url": "https://github.com/idaholab/moose/discussions/20353#discussioncomment-2225179",
                          "updatedAt": "2022-07-14T02:44:21Z",
                          "publishedAt": "2022-02-22T02:04:28Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "YuhangNIU"
                          },
                          "bodyText": "I want to develop a similar equation based on moose.\nDoes it mean that moose can not solve this equation?",
                          "url": "https://github.com/idaholab/moose/discussions/20353#discussioncomment-2226844",
                          "updatedAt": "2022-07-14T02:44:21Z",
                          "publishedAt": "2022-02-22T08:26:15Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "hugary1995"
                          },
                          "bodyText": "Yuhang,\nIf you are okay with any discretization, then please show us the equation you want to solve for -- the equation before discretization, not the equation shown in your original post. Then we can tell you which kernels to use.",
                          "url": "https://github.com/idaholab/moose/discussions/20353#discussioncomment-2230845",
                          "updatedAt": "2022-07-14T02:44:35Z",
                          "publishedAt": "2022-02-22T18:25:01Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "YuhangNIU"
                          },
                          "bodyText": "I just want to solve this equation, but I do not know how to express this equation before discretization. Can it be solved with MOOSE?",
                          "url": "https://github.com/idaholab/moose/discussions/20353#discussioncomment-2233071",
                          "updatedAt": "2022-07-14T02:44:35Z",
                          "publishedAt": "2022-02-23T01:40:28Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "It can be solved by MOOSE a priori, but it would be easier with the undiscretized form of the equation.\nA few questions,\nl and i are indexes for two spatial dimensions?\nWhat are the variables you want to solve for here? Since you have two PDEs, we cant have too many variables, otherwise the problem will be underdetermined. I count rho, h, W, but seems WBE, Q, T, P and C could also be variables? Or are they constants?",
                          "url": "https://github.com/idaholab/moose/discussions/20353#discussioncomment-2233994",
                          "updatedAt": "2022-07-14T02:44:49Z",
                          "publishedAt": "2022-02-23T06:47:57Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "YuhangNIU"
                          },
                          "bodyText": "Thanks for your reply.\nThe index of l means that this equation is for liquid, so it is nothing special. And i  represents the index of 1D elements.\nThe variables of these two PDEs are W and h, so other parameters can be regarded as constant.",
                          "url": "https://github.com/idaholab/moose/discussions/20353#discussioncomment-2234060",
                          "updatedAt": "2022-07-14T02:44:57Z",
                          "publishedAt": "2022-02-23T07:03:41Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "YuhangNIU"
                          },
                          "bodyText": "Besides, if W < 0, the second term on the right of Eq.2 can be expressed as: W(i)*h(i+1). However, the h value of i + 1 element (_u[qp+1]) is unknown in this time step, resulting in divergence. How to solve this problem\uff1f",
                          "url": "https://github.com/idaholab/moose/discussions/20353#discussioncomment-2234107",
                          "updatedAt": "2022-07-14T02:44:57Z",
                          "publishedAt": "2022-02-23T07:16:17Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "Thanks for your reply. The index of l means that this equation is for liquid, so it is nothing special. And i represents the index of 1D elements. The variables of these two PDEs are W and h, so other parameters can be regarded as constant.\n\nso the d(rho V/m) / dt term is 0? if all of these are constant\nIf the XX_i-1 - XX_i terms can be written as gradients, then this is solvable. If not, it's a little problematic that it's only on one side of the 1D element.",
                          "url": "https://github.com/idaholab/moose/discussions/20353#discussioncomment-2237516",
                          "updatedAt": "2022-07-14T02:44:58Z",
                          "publishedAt": "2022-02-23T15:56:48Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "YuhangNIU"
                          },
                          "bodyText": "Yes, the d(rho V/m) / dt term is 0.\nI was confused that the gradient is defined as d(u) / dx in 1D element, but the Eq.(1) and Eq.(2) only can be written as d(u).\nI think it might be written as grad(u) * dx, but how to define dx in moose?",
                          "url": "https://github.com/idaholab/moose/discussions/20353#discussioncomment-2240580",
                          "updatedAt": "2022-07-14T02:45:04Z",
                          "publishedAt": "2022-02-24T01:37:01Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "PorousFlow: masking areas for conductive flow/transport",
          "author": {
            "login": "garciapintado"
          },
          "bodyText": "Dear all,\nI am using the PorousFlow module, and wondering if you could advise on a way to simulate that some blocks are completely impervious. That is, I would like thermal diffusion to act in all the domain, but to be able to constrain the blocks for Darcy flow, so that conductive heat and advective transport in only simulated in the permeable domain. To use a negligible porosity [let's say 1.0E-2] in the assumed impervious areas prevents convergence in my attempts.\nMany thanks,\nJavier GP",
          "url": "https://github.com/idaholab/moose/discussions/20139",
          "updatedAt": "2022-06-23T13:27:36Z",
          "publishedAt": "2022-01-26T14:38:27Z",
          "category": {
            "name": "Q&A Modules: Navier-Stokes"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "GiudGiud"
                  },
                  "bodyText": "Hello\nYou should be able to block-restrict some physics. I'm not sure how it's done for porous flow. What does your input file look like? Do you have a large [Kernels] section with each term in the equations or is there a [PorousFlow] block (action) that handles the equations ?\nGuillaume",
                  "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2051384",
                  "updatedAt": "2022-06-23T13:27:36Z",
                  "publishedAt": "2022-01-26T14:42:20Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Hello Guillaume,\nMany thanks for the reply [sorry, I was aiming to ask for a general Q&A Modules, not specifically for Navier-Stokes].\nI am new to MOOSE, and trying to find my way through it.\nThe PorousFlow modules has several actions,  which handle the equations.\nI\u2019m using the PorousFlowFullySaturated action. Here, the heat equation in this includes (apart from the mechanical advection) both heat conduction  and heat advection by Darcy flow (each with its specific kernel).\nFollowing your suggestion, if you could point to some example in MOOSE (not necessarily related to the PorousFlow module) where some of the physics are restricted to specific blocks this would be great help. Basically, I'd need some blocks to be only subject to head conduction.\nJavier",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2052954",
                          "updatedAt": "2022-06-24T09:26:45Z",
                          "publishedAt": "2022-01-26T18:05:21Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "No worries.\nAbout block restriction of physics, here's an example:\nhttps://github.com/idaholab/moose/blob/06bc1f73f0d4dfb3d01ce9ba77d6bb97346e07eb/test/tests/kernels/block_kernel/block_kernel_test.i\nthe body force is restricted to only a single subdomain.\nBut it's not always that simple, sometimes you'll need to add boundary conditions to restrict physics to some subdomains. It's the case for finite volume navier stokes (not the same as porous flow as you know)\nBut please see @WilkAndy 's answer",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2061210",
                          "updatedAt": "2022-06-24T09:26:44Z",
                          "publishedAt": "2022-01-27T18:32:33Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "WilkAndy"
                  },
                  "bodyText": "The easiest thing is to set permeability zero or very low in those impermeable blocks.\nAlmost definitely this will work well, but before doing this, just make sure your physics is going to work properly.  For instance, it sounds like you're doing a thermal-hydraulic simulation.  If you set permeability = 0 in some blocks, and then reduce/increase the temperature when using a high-precision equation of state for your fluid, then you might start to probe the limits of the EOS's validity.",
                  "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2053946",
                  "updatedAt": "2022-06-24T09:26:37Z",
                  "publishedAt": "2022-01-26T20:48:12Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Hello Andy,\nMany thanks! Yes, the goal is to get hydrothermal (TH) simulations. I have also tried to put vanishingly small values for permeability in these \"impervious\" blocks, and this is preventing convergence in my tests.\nRegarding the EOS, I am using by now SimpleFluidProperties because the P&T go outside range in the very first step when using the Water97FluidProperties EOS [I\u2019ve even tried widely extrapolated tabulated EOS].\nI'll try to play with the temperature, review the BCs for inconsistencies, and come back with more tests in the background...",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2057260",
                          "updatedAt": "2022-06-24T09:26:37Z",
                          "publishedAt": "2022-01-27T09:43:09Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "OK, i hope you work it out soon.  Putting perm = 0 should work well in most (all?) situations, so you've probably got something \"suboptimal\" in your model.",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2057308",
                          "updatedAt": "2022-06-24T09:26:37Z",
                          "publishedAt": "2022-01-27T09:52:51Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "Perhaps you need to consider whether those blocks are really \"impervious\".  If so, how did the water get in there?  When you heat/cool the water, it will try to expand/contract, but by setting perm=0, you're keeping its volume constant (assuming you're using fixed porosity).  That will create very large pressure changes and possibly phase changes, both of which are difficult to solve numerically.\nIf water truly exists inside the impermeable block, but its porepressure is not of great concern to you, perhaps you could: (i) use 0 = porosity = permeability = tortuosity = dispersivity (perhaps you don't have the latter two), which means numerically there is no water in the block, so MOOSE's water differential equation will always be zero, but you'll have to modify your matrix thermal conductivity to account for the thermal conductivity of the water that you've artificially removed; (ii) use a different PorousFlowPorosity class, where porosity can increase with temperature and porepressure changes, but that will probably lead to poor convergence; (iii) set the thermal expansion of water to zero (try this with fixed porosity initially).",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2062096",
                          "updatedAt": "2022-06-24T09:26:37Z",
                          "publishedAt": "2022-01-27T21:04:02Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Hello Andy & Guillaume,\nMany thanks! I'll explain myself:\nMy idea here is to to see if MOOSE-PorousFlow can be used (I\u2019d guess it can) to replace (and expand with Geochemical reactive transport) and existing geothermal module that I have coded and coupled to a visco-elasto-plastic model of  continental spreading, all in Matlab. The model is 2D and the spatial domain is  (initially; then it grows with the computation) generally up to 150 km depth and ~400 km wide. In Matlab, this is now done with operator splitting where the mechanical part runs at ~10000 year time step and,  separately, the hydrothermal part (which runs at a much smaller, adaptive, timestep) is a computational bottleneck. I\u2019m sending a snapshot of a situation (the plot is up to 35 km depth but the total domain is up to 150km) , where hydrothermal flow has been active for a couple of million years. This model should continue to run up to ~80Myr. So, I though  to keep the mechanical part (at least by now) in Matlab and use MOOSE for the hydrothermal flow and geochemistry. A big part of this domain is upwelling mantle.  Everywhere higher than ~800\u00baC should have a closure of its porosity. However, as thermal diffusion affects all the domain, all of it has to be passed to MOOSE. So, I thought it would be way more computationally efficient (and probably stable) if all the subdomain warmer than given isotherm (let\u2019s say 800\u00baC) could be masked out of the computations for porepressure and heat advection (as well as, eventually, the geochemical transport). Not only the DOFs would me highly reduced, but I\u2019d presume that convergence could also be better. In addition the P,T values below that isotherm go way beyond the validity of the IAPWS-97, implying the need for way-off tabulated extrapolation of the EOS. Computationally-wise, I feel it would  be better to just mask out these deep areas and only consider them for the thermal conduction [if possible in MOOSE+PorousFlow] rather than setting a negligible porosity and permeability and keeping all Kernels, FluidProperties... acting on them. But maybe I\u2019m wrong.\n\n\u2026",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2064733",
                          "updatedAt": "2023-03-20T12:27:34Z",
                          "publishedAt": "2022-01-28T08:03:16Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "That is a fascinating application, thank you for explaining.  I want to help you, but it's the end of our week here in Australia.  I'll write more on Monday, but for now, i suggest the \"mask\" has porosity = 0 = permeability.  Sure, you'll get better performance by just having no fluid-flow there, and we can look at that next week, but can you run your sim with SimpleFluidProperties, and that porosity=0=perm idea, and see what happens?",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2065018",
                          "updatedAt": "2023-03-20T12:40:07Z",
                          "publishedAt": "2022-01-28T08:55:59Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Thanks!! I'll try as you indicate...",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2065259",
                          "updatedAt": "2023-03-20T12:43:26Z",
                          "publishedAt": "2022-01-28T09:41:46Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "So, how did this go, @garciapintado ?\nI'm interested in the mechanical coupling.  If the mechanics increases permeability or porosity without directly impacting fluid pressure, then that will prob be fine.  But if the mechanics changes porosity, which consequently changes porepressure (fluid mass conservation) then i feel MOOSE will struggle compared with usual flow simulations.  Eg, suddenly halving porosity, while not allowing fluid to move (because of the operator split) will increase porepressure by about 1GPa.\nAlso, i wonder about the T>800degC + porosity idea.  How are you implementing this in MOOSE?\nI'm keen to help - tell me your current progress.",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2077768",
                          "updatedAt": "2023-03-20T12:43:32Z",
                          "publishedAt": "2022-01-30T20:54:29Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Hello Andy and Guillaume,\nAs suggested by @WilkAndy, trying understand the issues for lack of convergence in my original problem above, I\u2019ve done a number of synthetic tests in  a rectangular box with four horizontal layers, with a] using simple and Tabulated IAPWS97 fluid properties, b] different temperature gradients, and c] different domain depths.\nAll of these use the PorousFlowFullySaturated in PorousFlow module. Top pressure is atmospheric and then subject to gravity. Initial conditions match boundary conditions, so they should be taken as best-case scenario. All simulations are \u2018ThermoHydro\u2019 and Boundary conditions in these synthetic tests are all DirichletBC. Simulation time is 10 kyr [as would be in my original application, with IterationAdaptiveDT.\nPorosity, permeability, rock internal energy and rock-grain thermal conductivity are all as in my original problem [although I have one layer less here, as I\u2019ve removed the sediment]. The approach for material properties is to set vey low permeabilities for\nthe areas where I\u2019d like to prevent flow (but all relevant Kernels for fluid advection still apply everywhere).\nThe average vertical thermal gradient in my original setup is about 1300/150000 [K.m-1], but his is very irregular as shown in my previous message. All runs are executed as \u201cmpi exec -np -4 \u2026\u201d, which for nonlinear variables leads to Num Local DOFs between 13266 & 15398 for the shallow, and standard domain sizes, respectively.\nTest-specifics are:\nFluidProperties:          simple fluid, and Tabulated  IAPWS97\nDepths:                       150 km [as my standard domain], and 16 km [as the subdomain for advective fluid flow would commonly have].\nthermal gradients y:  as seen in the summary table below.\nSummary of runs [in some cases, that are perhaps more relevant, I\u2019ve included the computation time]. YES/NO indicates convergence.\n16  km depth domain [the shallow one]:\nSimpleFluidProperties TabulatedIAPWS97\ngrad_T_y   300/150000 [K.m-1]               YES                            YES                      # way lower than my original thermal gradient\ngrad_T_y   1300/150000 [K.m-1]              YES                           YES  [229 s ]      # ~average of my original thermal gradient  [417.15 K at the bottom]\ngrad_T_y   8000/150000 [K.m-1]              untested                   YES  [288 s ]      # ~average of my original thermal gradient  [1131.15 K at the bottom] This COVERS our range of fluid temperatures\ngrad_T_y   12500/150000 [K.m-1]            YES                           NO                       #  exaggerated thermal gradient such that the maximum temperatures at the bottom math those in my original setup.\n150 km depth domain [approximating the original one]:\nSimpleFluidProperties TabulatedIAPWS97\ngrad_T_y   42/150000 [K.m-1]              YES                              YES [331 s]           #  way-lower than my original thermal gradient [320 K at the bottom]\ngrad_T_y   300/150000 [K.m-1]            YES                              YES [357 s]          # lower than my original thermal gradient          [578 K at the bottom]\ngrad_T_y   600/150000 [K.m-1]            untested                      YES [788 s]*        # lower than my original thermal gradient          [878 K at the bottom]\ngrad_T_y   1300/150000 [K.m-1]          YES [366 s]                 NO                        #  ~average of my original thermal gradient\n*in this test, the initial steps converge, up to Time Step 7, time = 1.27e+07, dt = 6.4e+06, when some messages start to indicate:\n\u201cTemperature -1500.82 is outside the range of tabulated temperature (273.15, 5273.15).\nTemperature -530.591 is outside the range of tabulated temperature (273.15, 5273.15).\n\u2026\u201d\nthen the solver does not converge and eventually, after cutting the time step, the iterations go on and the simulation finally converges. Note that the maximum temperatures should be well within the limits of of the original EOS.\nSo, [provided my input files are fine] it seems that the thermal gradient is not an issue in these simulations, but the problem is either the wide range of P,T values, or the extrema of P,T.\nIn the real problem, I\u2019d need to use tabulated IAPWS97 EOS.\nOne note is that the extrapolation of the Water97 properties is simplistic. I\u2019ve just extrapolated toward higher temperatures and lower and higher pressures without any slope in the extrapolation [i.e. just keeping the last available values in each side in the original Water97 produced EOS tables. Would it be possible that these  0.0 derivatives for the thermodynamic properties as a function for high T values [the extrapolated ones] is related to the lack of convergence? I\u2019d be surprised as the high pressure is equally present in the lower grad_T_y tests for the {150km,TabulatedIAPWS97} tests, and it hits extrapolated values at the bottom of the domain.  As an example, I\u2019m pasting the PT plot for density [the T range goes until 5000\u00baC and the pressure up to 1800 MPa to guarantee it covers any possible value in our original domain.\n\nIn any case, the test {16km, grad_T_y=8000/150000 K.m-1, TabulatedIAPWS97} does converge and covers well the range of temperatures we would have in our hydrothermal problem. So, it seems that it is a combination of high temperatures and high pressures what leads to the lack of convergence.\nDoes this overall support the idea that masking deep areas in my original domain, so they are taken out of the advective flow and transport calculation [applying on heat conduction in them] is the approach to go for? If so, is this feasible in PorousFlow as it stands now?\nIn this as the case, computing-wise according to the closest scenario here would likely be the {16km, grad_T_y=8000/150000 K.m-1, TabulatedIAPWS97} , the computing time would be fine for us [this would need to be executed for any single timestep of our mechanical model].\nI have more notes, but not sure if they are relevant now [our real case scenario is more entangled and would need addition of specific parametrisation\u2026 but that\u2019s another topic]\nI can send the input files for these synthetic runs [and for my original run as well].\nMaybe this conversation is a bit off-topic here and it should be taken out of \u201cQ&A Modules: Navier-Stokes\u201d?\nJavier",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2080364",
                          "updatedAt": "2023-03-20T12:43:32Z",
                          "publishedAt": "2022-01-31T10:12:05Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Hello Andy,\nJust missed your last message. Well, you see I\u2019ve been doing simple TH synthetic tests.\nI have not modified any C++ code in MOOSe by now [actually I only know the basic of C++]. I had planned that if these tests work fine (so we go ahead with MOOSE), I\u2019d add a new material with the parametrization I\u2019ve put in Matlab, where for a start I used your own PorousFlowPorosity formulation [the fluid, thermal and mechanical parts], and modified some minor things that did not seem to fit our problem. Basically, I just used the volumetric\ndeformation [the dynamical pressure term] for the porosity mechanical factor, and then I added a factor dependent of the strain rate [i.e. its 2nd invariant] for the permeability, after apply a Kozeny-Carman formulation [also borrowed from your own code]. This seems to do what we expected in general terms in our Matlab code. I could add the details, but it s a quite simple thing.\nSo, in our case, the mechanics would change porosity [and permeability], and this is key for our simulations to work and properly develop the fluid convection cells.\nAbout the \u00a0\u201cT>800degC + porosity idea\u201d, you\u2019ve got me. I need to look at that\u2026\nI am enthusiastic about the prospect of MOOSE, if each 10 kyr of hydrothermal simulations [i.e. a single timestep of the mechanical model] could go down to about 3 minutes computing time within a single computing node this would allow us to do the runs [including ensembles] we need! [each of these 10 kyr now takes us 30\u2019 in Matlab with similar number of processors, which make the computing impractical].\nI\u2019m going to check what I have for the high-temperature porosity\u2026\nJavier\n[needless to say that if you find the application interesting and we manage to put this into work in MOOSE, we would be more than happy if you did not mind to coauthor derived results]. I also find myself the application fascinating...",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2080632",
                          "updatedAt": "2022-09-07T01:23:50Z",
                          "publishedAt": "2022-01-31T10:53:24Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "I have checked. In the simulation for the plot I sent for our real case [the matlab simulation]. I just had the trace of the volumetric strain contributing to the mechanical effect on the porosity:\nvolumetric_strain = -1 / (bulk_modulus * (Pd - Pd_ref)),\nwhere Pd is the mechanical model pressure. The fluid and thermal effect as in PorousflowPorosity,  and then the simplistic approach of setting a fixed positive lower threshold of the resulting porosity for vey low values [I\u2019m aware this is not good convergence-wise in MOOSE], which I guess is what you were asking for. So, no great idea here. But as I've seen I believe we rarely hit these low values in our zone of interest.\nThen, for the permeability, the Kozeny-Carman permeability, [after your kozeny_carman_phi0] and after this permeability (K) has been calculated, it is multiplied by a factor which result from a function [a Gaussian-like increase, as the classical Gaussian variograms] dependent on the ratio of the [IInd invariant] of the plastic strain rate to a nominal value [which is around the maximum value we normally have around big faults with highly localised deformation for this class of model].\nAll in all, the permeability becomes clearly higher on active faults in the brittle domain, and then decrease when the faults become inactive. Part of this idea is to emulate the fault remineralisation effect that we are lacking in our model. That is, we cannot use total accumulated strain to control permeability as we would be neglecting the remineralisation in abandoned faults which would seal them for our geological timescales.",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2082102",
                          "updatedAt": "2022-09-07T01:24:00Z",
                          "publishedAt": "2022-01-31T14:54:55Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "garciapintado"
                  },
                  "bodyText": "OK, I'll try first if with an updated, hopefully better, extrapolation of the EOS and fixed porosity the synthetic test for its most realistic scenario  converges.\nOn alternative (3), I'm already passing stuff from matlab to MOOSE through EXODUS files [not in these synthetic but in the real case on which I initially failed to make it converge], prepared through an intermediate python script [called by matlab], using the package \"exomerge\" from Sandia NL, where I am passing full ICs files for temperature and porepressure, as well as nodesets for BCs ---I still haven't figured out how to prepare sidesets, but with nodeset BCs it is working for me by now---]. So, I believe all what could be needed as input could be automated as well.\nOn BCs my question is more about how MOOSE works when only some blocks are selected for a specific Kernel computation. That is, should the BCs be on nodes pertaining to these selected sub-blocks (either in their boundary or within their boundaries), or the BCs should be defined everywhere in the complete mesh [if so, in my mind I can just think off DirichletBC]. But don't bother in answering this [don't want to take an excess of your time], I'll do my homework with MOOSE. I would for sure need help on unravelling  PorousFlowFullySaturated into the list of Kernels and Materials. But also, I'll start by studying it a bit more.",
                  "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2086853",
                  "updatedAt": "2022-06-26T08:48:12Z",
                  "publishedAt": "2022-02-01T07:28:31Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "If a Variable exists on some blocks only, then the remainder of the mesh is invisible to it.  Eg, if P lives on some blocks then fluid will flow in those blocks only: as far as the fluid is concerned, it will see a domain with \"holes\" (the masked areas), so it will flow around those holes.  The BCs should only be defined where the Variable exists: so if parts of your original boundary get masked, you'll have to create a new exodus boundary that consists of only the non-masked parts, and apply the DirichletBC there only.\nI was pretty careful in describing all the Kernels and Materials added by the Action in the documentation https://mooseframework.inl.gov/source/actions/PorousFlowFullySaturated.html .    Hopefully i didn't omit anything!",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2087683",
                          "updatedAt": "2022-06-26T08:48:12Z",
                          "publishedAt": "2022-02-01T10:00:05Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "garciapintado"
                  },
                  "bodyText": "Hello Andy,\nA \"better\" extrapolation of the thermodynamic tables has not reached a good end [I've tried several regression types, and some \"parsimonious\" extrapolation following the minimal slope in the borders of the original thermodynamic tables, and nothing seems to be able to solve the convergence problem when both high P and  high T live together in the domain. Extrapolating with small slopes initially does not hit crazy values of temperature, but ultimately makes the run so slow that I had to stopped it. So, from everything I've tried still the 0-derivative extrapolation is the one which takes the simulations further.\nSo, I've gone for  option [3] [mask the deepest block ---'mantle'---so no porepressure lives there.\nI've now run the synthetic [4 layer on top of each other] indicating manually the Kernels and Material brought by the action PorousFlowFullySaturated [BTW, the documentation is also great!]. So, I've reproduced my former synthetic tests. Up to here, everything seems great.\nYet, now I'm stuck in how to specify that one variable [porepressure in this case]\u00a0only lives in some blocks. I do not seem to find this in the documentation. So, I am getting a lot of errors, that I believe come because the porepressure Variable is seen everywhere:\nMaterial property 'PorousFlow_saturation_qp', requested by 'lambda_mantle' is not defined on block mantle\nMaterial property 'PorousFlow_saturation_qp', requested by 'lambda_mantle_neighbor' is not defined on block mantle\n...\nMaterial property 'dPorousFlow_porepressure_nodal_dvar', requested by 'PorousFlow_density_nodal_all' is not defined on block mantle\n...\nand so on.  Is there any example where a variable only exists in some subDomain blocks? I really can't find it. Maybe I'm looking at the wrong places...",
                  "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2103337",
                  "updatedAt": "2022-06-26T08:48:12Z",
                  "publishedAt": "2022-02-03T12:14:23Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Ah!, I can send the synthetic input file",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2103348",
                          "updatedAt": "2022-06-26T08:48:12Z",
                          "publishedAt": "2022-02-03T12:16:46Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "To clarify, I'm specifying the blocks where porepressure should live [as found in some previous conversation]:\n...\n[Variables]\n[porepressure]\nblock = 'lcrust ucrust unsat'     # 'mantle' not included\nfamily = LAGRANGE\norder = SECOND\n[]\n[temperature]\nfamily = LAGRANGE\norder = SECOND\nscaling = 1E-08\n[]\n[]\n...\nbut still it seems that porepressure, saturation, fluid_phase_density, fluid_phase_enthalpy... are requested to be defined in the 'mantle' block, where not flow is supposed to happen. That is, I've specified block = 'lcrust ucrust unsat' in all kernels related to fluid transport and related materials.\nThe only two Kernels I've left applied to all the domain are related to transient heat conduction:\n[heat_time_derivative]\ntype = PorousFlowEnergyTimeDerivative\nvariable = temperature\n[]\n[heat_conduction]\ntype = PorousFlowHeatConduction\nvariable = temperature\n[]",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2103712",
                          "updatedAt": "2022-06-26T08:48:12Z",
                          "publishedAt": "2022-02-03T13:25:03Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "Hi @garciapintado , there is no example of the porepressure Variable living only on a subdomain, sorry.  I see your problem, and hopefully it's easy to fix.\nThe problem is that those PorousFlowEnergyTimeDerivative and PorousFlowHeatConduction assume there is fluid in their domain: the heat content and heat conduction depend on fluid properties such as the internal energy of the fluid and its thermal conductivity.  Even if the porosity is zero, so there is zero contribution from the fluid, there is no way of telling MOOSE to ignore the fluid: it wants to calculate the fluid contribution (which is zero) and add that zero to the physics.\nThe way forward is to use different Kernels in the mantle, for instance HeatCapacityConductionTimeDerivative and HeatConduction.  (Since the heat-conduction equation equals the diffusion equation (mathematically, i mean) there are actually lots of equivalent options here, such as CoefTimeDerivative and Diffusion.)  Hopefully the documentation (especially the tutorial) should help: https://mooseframework.inl.gov/modules/heat_conduction/index.html\nYou must also block-restrict your Materials.  All PorousFlow... Materials must have: block = 'lcrust ucrust unsat'.  You've probably got that already.\nFinally, you may want to have porepressure exist in the mantle too, just so you keep a record of its value prior to masking.  You can do that by not block-restricting it, but giving it different physics in the mantle, viz a CoefTimeDerivative Kernel with a very small Coefficient.  The reason for the small coefficient is so the nodes on the boundary of the mantle and lcrust are virtually unimpacted by this Kernel (otherwise the physics won't be porous flow).  Calculate \"very small\" by making a rough calculation of the PorousFlowTimeDerivative Kernel's coefficient (porosity * fluid_density) and multiply by, say, 1E-9.   This CoefTimeDerivative Kernel will ensure porepressure remains fixed in the mantle.  Perhaps you won't need to do this, dependening on how your matlab-moose coupling works.",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2106764",
                          "updatedAt": "2022-06-26T08:48:12Z",
                          "publishedAt": "2022-02-03T21:05:53Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Many thanks! I had not picked up that different Kernels for a similar purpose, and all acting on the same variable, could be selected on different blocks. I'll try this...",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2108916",
                          "updatedAt": "2023-01-02T01:25:38Z",
                          "publishedAt": "2022-02-04T07:07:18Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "By the way, who are you?  You're obviously quite experienced with numerical modelling - it'd be nice to know where you're from, what you're researching, etc.",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2108932",
                          "updatedAt": "2022-09-07T01:26:43Z",
                          "publishedAt": "2022-02-04T07:10:25Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Thanks! Not terribly expert but trying to surf the waves :-)... I am Javier Garc\u00eda-Pintado [Spanish], and work in MARUM (an excellence center in environmental marine sciences in Bremen, Germany, with a high percentage of resources going to experimental research [from biogeochemists to robotics people], and some resources for numerical analysis ---as my part---. I went into academia after some years in private industry in Spain (as mining engineer), and after a [more experimental than numerical] PhD in ephemeral rivers water quality, I moved to Reading (UK) to the Data Assimilation Research Center [DARC; most people there are mathematicians], and stayed there for 7 years working on assimilation of Synthetic Aperture Radar with the SWE [2D water shallow water equations] for flood forecast. However, for personal reasons [Brexit came to Europe, and then first my wife and then myself were offered to come to MARUM] we decided to move to Germany, and I had to change topics again. Now I work on the modelling of ocean basins within the MARUM cluster in collaboration with climate people, marine biogeochemists...  The overarching goal in my part is to evaluate feedbacks between the formation of ocean basins at geological timescales [that's why we have our 2D viscoelastoplastic deformation model] and submarine hydrothermal systems [with implications for global reconstructions of heat release in relation natural climate variability, the initiation of life in cold-water submarine hydrothermal vents, black-smokers...]. So, after all these moves we're working in this great hybrid environment... AFAIK, what we are trying to do [now with your help] would become the first THM modelling at this broad scale for ocean basins.\nMy idea of trying MOOSE came because it clear that we need to go HPC [and MOOSE is so neatly done!]. Then, as geochemistry is added, the DOFs will highly increase so a proper scaling of the computing will be a must. I'm crossing fingers that this will work...\nI've seen that in CSIRO, Mining Geomechanics, you are mostly mathematicians and mining engineers [which for me is a coincidence as I do not work formally as mining engineer, despite being one].\nCheers.",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2109489",
                          "updatedAt": "2022-09-07T01:26:43Z",
                          "publishedAt": "2022-02-04T09:08:36Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Hello Andy,\nAfter looking a bit at the code and the options you mentioned I chose to attempt a simple modification to your own Kernel PorousFlowEnergyTimeDerivative as I saw that HeatCapacityConductionTimeDerivative does not include the density, and also under the hope that this would be more seamless integrated within PorousFlow (as temperature seems to be recognised a a PorousFlow variable?). Basically I added a boolean parameter neglect_porosity to the Kernel, which if false sets the number of phases to 0 and I saw that then you consider that there is not fluid present in the object.\nSo, I\u2019m calling the version allowing this HeatCapacityConductionTimeDerivativeNopore for the mantle block with neglect_porosity=true.\nAs for PorousFlowHeatHeatConduction, I believe that now it does not generate any issue [I\u2019ve just added a negligible  PorousFlowPorosityConst porosity], and then a PorousFlowThermalConductivityFromPorosity for the mantle.\nWith this, plus making the Variable pore pressure available in all domain as well as initialising it in all the domain and adding the \u2018mantle\u2019 block to Material PorousFlow1PhaseFullySaturated, I\u2019ve got to get rid of the initialisation errors.\nBut still, something I\u2019ve done must be non-sensical, as I am getting the error:\n\u201cLinear solve did not converge due to DIVERGED_PC_FAILED iterations 0\nPC failed due to FACTOR_OUTMEMORY\u201d\nMaybe the added neglect_porosity is not working as I expected?\nNote that if I activate all blocks for all the kernels, the same simulation runs fine with the same preconditioning and Executioner.\nI\u2019m struggling to understand why this error, with all the environment [C++ & MOOSE] new to me\u2026\nFollowing the posting guidelines by @GiudGiud and guessing this is at this stage a convergence error, I am sending a link to GitHub repository, where I've put the files in case you could help: https://github.com/garciapintado/MOOSE_porous_flow_stuff\nsyn00.i : generates the mesh\nsyn08.i : all blocks active; converges very well\nsyn09.i : inactive Kernels for advective flow in the mantle: gives the error indicated above\nPorousFlowEnergyTimeDerivativeNopore.h : exactly as yours but with extra parameter to neglect porosity\nPorousFlowEnergyTimeDerivativeNopore.C:  \u201c                \u201c                  \"\nHave a nice weekend,\nJavier",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2113165",
                          "updatedAt": "2022-09-07T01:26:48Z",
                          "publishedAt": "2022-02-04T17:56:55Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Hello Andy,\nAs in this setup the thermal advection kernel is only applied to some subdomain blocks (everywhere expect in the mantle), but the thermal conduction is applied everywhere, I am wondering if the issue may come from the thermal boundary conditions, which are specified for the top and bottom boundaries of the overall domain. Could it be that this is clashing with the subdomain application of the thermal advection?\nMany thanks!\nJavier",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2123495",
                          "updatedAt": "2022-09-07T01:29:14Z",
                          "publishedAt": "2022-02-07T08:26:27Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "The problem appears to be that mumps cannot invert Ax=b, which suggests your Jacobian is bad, or your mesh is bad.  I'm not sure what's wrong.  Can you try with the HeatCapacityConductionTimeDerivative Kernel instead?  (I don't actually see the problem with your new Kernel, however.)  Can you try to make the Variables order = first instead?   It could be related to the TVD advection: can you try to turn that off (use full upwinding intead)?",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2124067",
                          "updatedAt": "2022-09-07T01:29:14Z",
                          "publishedAt": "2022-02-07T10:04:33Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "garciapintado"
                  },
                  "bodyText": "Hello,\nI\u2019ve tried all the last indications [it would be very unlikely that the mesh has any issue as when all blocks are considered it works fine].\nNote: I am not sure about how to add the input of HeatCapacityConductionTimeDerivative [as there is no example, and HeatCapacity is an extensive property] , but I\u2019ve seen a SpecificHeatConductionTimeDerivate  which I understand [and I think the intent of using this is what you mean?].\nSo, I\u2019ve tried the SpecificHeatConductionTimeDerivative\u00a0Kernel in the mantle, and making the variables LAGRANGE; 1st order as well. I\u2019ve also tried the full-unwinding.\nNone of the modifications, one-by-one, seems to work. I am pasting here the input file, in case it is useful. As it is, including that the last modifications, the initialisation goes through, but the convergence error persists.\nI\u2019ve also done an alternative attempt, which I\u2019ll comment in a separate post to avoid mixing details\n[Mesh]\n[gen]\ntype = GeneratedMeshGenerator\ndim = 2\nxmin = -200000\nxmax =  200000\nymin = -150000\nymax =   0\nelem_type = TRI3\nnx = 100\nny = 75\n[]\n[lcrust]\ntype = SubdomainBoundingBoxGenerator\ninput = 'gen'\nblock_id = 1\n#block_name = lcrust\nbottom_left = '-200000 -40000 0'\ntop_right = '200000 -20000 0'\n[]\n[ucrust]\ntype = SubdomainBoundingBoxGenerator\ninput = 'lcrust'\nblock_id = 2\n#block_name = ucrust\nbottom_left = '-200000 -20000 0'\ntop_right = '200000 -10000 0'\n[]\n[unsat]\ntype = SubdomainBoundingBoxGenerator\ninput = 'ucrust'\nblock_id = 3\n#block_name = unsat\nbottom_left = '-200000 -10000 0'\ntop_right = '200000 0 0'\n[]\n[rename]\ntype = RenameBlockGenerator\ninput = 'unsat'\nold_block = '0 1 2 3'\nnew_block = 'mantle lcrust ucrust unsat'\n[]\n[topnopore]\ntype = SideSetsBetweenSubdomainsGenerator\ninput = 'rename'\nnew_boundary = 'top_nopore'\nprimary_block = 'mantle'\npaired_block = 'lcrust'\n[]\n[]\n[GlobalParams]\nPorousFlowDictator = dictator\ngravity = '0 -9.81 0'              # make global, so no need to add it to the userobject requiring it\n[]\n[UserObjects]\n[dictator]\ntype = PorousFlowDictator\nporous_flow_vars = 'porepressure temperature'\nnumber_fluid_phases = 1\nnumber_fluid_components = 1\n[]\n[]\n[Variables]\n[porepressure]\nblock = 'mantle lcrust ucrust unsat'   # blocks where this variable exists\nfamily = LAGRANGE\norder = FIRST\n[]\n[temperature]\nfamily = LAGRANGE\norder = FIRST\nscaling = 1E-08\n[]\n[]\n[Kernels] # as added by the action [PorousFlowFullySaturated]\n[pp_time_derivative]\ntype = PorousFlowMassTimeDerivative\nblock = 'lcrust ucrust unsat'\nvariable = porepressure\n[]\n[pp_upwind_advectiveflux_kernel]\ntype = PorousFlowFullySaturatedAdvectiveFlux\nblock = 'lcrust ucrust unsat'\nvariable = porepressure\n[]\n[heat_time_derivative]\ntype = PorousFlowEnergyTimeDerivative\nblock = 'lcrust ucrust unsat'\nvariable = temperature\n[]\n[heat_time_derivative_nopore]\ntype = SpecificHeatConductionTimeDerivative\nblock = 'mantle'\nvariable = temperature\nlumping = true\ndensity = density_mantle\nspecific_heat = specific_heat_mantle\n[]\n[heat_conduction]\ntype = PorousFlowHeatConduction\nvariable = temperature\n[]\n[heat_upwind_advectiveflux_kernel]\ntype = PorousFlowFullySaturatedUpwindHeatAdvection\nblock = \"lcrust ucrust unsat\"\nvariable = temperature\n[]\n[]\n[ICs]\n[porepressure_IC]\ntype = FunctionIC\n#block = \"lcrust ucrust unsat\"\nvariable = porepressure               # [Pa]\nfunction = '9.81*(-y)*1000'\n[]\n[temperature_IC]\ntype = FunctionIC\nvariable = temperature\nfunction = '273.15+5+(-y)*600/150000'     # => 878.15 = 273.15+5+600 at the bottom\n[]\n[]\n[BCs]\n[Ptop]\ntype = DirichletBC\nvariable = porepressure\nvalue = 101325.0                       # [Pa] 1 atm\nboundary = top\n[]\n[Ttop]\ntype = DirichletBC\nvariable = temperature\nvalue = 278.15                         #\nboundary = top\n[]\n[Tbot]\ntype = DirichletBC\nvariable = temperature\nvalue = 878.15\nboundary = top_nopore\n[]\n[]\n[Modules]\n[FluidProperties]\n[the_simple_fluid]\ntype = SimpleFluidProperties\nbulk_modulus = 2E9\nviscosity = 1.0E-3\ndensity0 = 1000.0\n[]\n[]\n[]\n[Materials]\n[materials_mantle]\ntype = GenericConstantMaterial\nblock = mantle\nprop_names = 'thermal_conductivity_mantle specific_heat_mantle density_mantle'\nprop_values = '3.3 1200.0 3360.0'\n[]\n[porosity_mantle]\ntype = PorousFlowPorosityConst                  # 'at_nodes=False' by default\nblock = mantle\nporosity = 0.03\n[]\n[porosity_lcrust]\ntype = PorousFlowPorosity\nblock = lcrust\nporosity_zero = 0.05\nthermal = true\nthermal_expansion_coeff = 3.66E-05\nreference_temperature = 273.15\nfluid = true\nsolid_bulk = 10.E09\nbiot_coefficient = 0.8\nbiot_coefficient_prime = 0.8\nmechanical = false\n[]\n[porosity_ucrust]\ntype = PorousFlowPorosity\nblock = ucrust\nporosity_zero = 0.05\nthermal = true\nthermal_expansion_coeff = 3.38E-05\nreference_temperature = 273.15\nfluid = true\nsolid_bulk = 10.E09\nbiot_coefficient = 0.8\nbiot_coefficient_prime = 0.8\nmechanical = false\n[]\n[porosity_unsat]\ntype = PorousFlowPorosity\nblock = unsat\nporosity_zero = 0.05\nthermal = true\nthermal_expansion_coeff = 3.38E-05\nreference_temperature = 273.15\nfluid = true\nsolid_bulk = 10.E09\nbiot_coefficient = 0.8\nbiot_coefficient_prime = 0.8\nmechanical = false\n[]\n[permeability_mantle]\nblock = mantle\ntype = PorousFlowPermeabilityConst    # 'at_nodes=False' by default\npermeability = '1.0E-18 0 0 0 1.0E-18 0 0 0 1.0E-18'\n[]\n[permeability_lcrust]\ntype = PorousFlowPermeabilityKozenyCarman\nblock = lcrust\nn = 3\nm = 2\nphi0 = 0.05\nk0 = 9.0E-16\nporoperm_function = 'kozeny_carman_phi0'\n[]\n[permeability_ucrust]\ntype = PorousFlowPermeabilityKozenyCarman\nblock = ucrust\nn = 3\nm = 2\nphi0 = 0.05\nk0 = 1.0E-15\nporoperm_function = 'kozeny_carman_phi0'\n[]\n[permeability_unsat]\ntype = PorousFlowPermeabilityKozenyCarman\nblock = unsat\nn = 3\nm = 2\nphi0 = 0.05\nk0 = 1.0E-22\nporoperm_function = 'kozeny_carman_phi0'\n[]\n[internal_energy_mantle]                # 'at_nodes=True' by default\ntype = PorousFlowMatrixInternalEnergy #\u00a0this Material calculated the internal energy of solid rock grains\nblock = mantle                        # internal_energy [J.K-1.m-3] = density*specific_heat_capacity\ndensity = 3360.0                      # [kg.m-3] density of rock grains\nspecific_heat_capacity = 1200.0       # [J.kg-1.K-1] specific heat capacity of rock grains\n[]\n[internal_energy_lcrust]\ntype = PorousFlowMatrixInternalEnergy #\u00a0this Material calculated the internal energy of solid rock grains\nblock = lcrust\ndensity = 2850.0                      # [kg.m-3] density of rock grains\nspecific_heat_capacity = 1200.0       # [J.kg-1.K-1] specific heat capacity of rock grains\n[]\n[internal_energy_ucrust]\ntype = PorousFlowMatrixInternalEnergy #\u00a0this Material calculated the internal energy of solid rock grains\nblock = ucrust\ndensity = 2700.0                      # [kg.m-3] density of rock grains\nspecific_heat_capacity = 1200.0       # [J.kg-1.K-1] specific heat capacity of rock grains\n[]\n[internal_energy_unsat]\ntype = PorousFlowMatrixInternalEnergy #\u00a0this Material calculated the internal energy of solid rock grains\nblock = unsat\ndensity = 2700.0                      # [kg.m-3] density of rock grains\nspecific_heat_capacity = 1200.0       # [J.kg-1.K-1] specific heat capacity of rock grains\n[]\n[lambda_mantle]\ntype = PorousFlowThermalConductivityFromPorosity # rock-fluid combined thermal conductivity by weighted sum of rock and fluid conductivities\nblock = mantle\nlambda_f = '3.3 0 0 0 3.3 0 0 0 3.3'\nlambda_s = '3.3 0 0 0 3.3 0 0 0 3.3'\n[]\n[lambda_lcrust]\ntype = PorousFlowThermalConductivityFromPorosity\nblock = lcrust\nlambda_f = '0.56 0 0 0 0.56 0 0 0 0.56'\nlambda_s = '2.5 0 0 0 2.5 0 0 0 2.5'\n[]\n[lambda_ucrust]\ntype = PorousFlowThermalConductivityFromPorosity\nblock = ucrust\nlambda_f = '0.56 0 0 0 0.56 0 0 0 0.56'\nlambda_s = '2.3 0 0 0 2.3 0 0 0 2.3'\n[]\n[lambda_unsat]\ntype = PorousFlowThermalConductivityFromPorosity\nblock = unsat\nlambda_f = '0.56 0 0 0 0.56 0 0 0 0.56'\nlambda_s = '2.3 0 0 0 2.3 0 0 0 2.3'\n[]\n[porepressure_material]\ntype = PorousFlow1PhaseFullySaturated # at_nodes=false by default\nblock = 'mantle lcrust ucrust unsat'\nporepressure = porepressure\n[]\n[temperature_material]\ntype = PorousFlowTemperature          # at_nodes=false by default\ntemperature = temperature\n[]\n[massfrac]\ntype = PorousFlowMassFraction         # at_nodes=false by default\nblock = 'lcrust ucrust unsat'         # list of blocks where this object applies to\n# mass_fraction_vars # nod needed when num_phases=num_component\n[]\n[simple_fluid]\ntype = PorousFlowSingleComponentFluid      # see documentation for this material regarding the choice of units\nblock = 'lcrust ucrust unsat'\nfp = the_simple_fluid                      # this Material is at_nodes=false by default\nphase = 0\n[]\n[simple_fluid_noflow]\ntype = PorousFlowSingleComponentFluid      # see documentation for this material regarding the choice of units\nblock = 'mantle'\nfp = the_simple_fluid                      # this Material is at_nodes=false by default\nphase = 0\n[]\n[effective_fluid_pressure] # create effective fluid pressure [requested by PorousFlowPorosity even it has not mechanical coupling]\nblock = 'lcrust ucrust unsat'\ntype = PorousFlowEffectiveFluidPressure\n[]\n[nearest_qp]\ntype = PorousFlowNearestQp                 #\u00a0atNodes=false by default\nblock = 'mantle lcrust ucrust unsat'       # should mantle be neglected here?\n[]\n[relperm] # required by PorousFlowDarcyVelocityComponent AuxKernels\ntype = PorousFlowRelativePermeabilityConst # atNodes=false by default\nblock = 'mantle lcrust ucrust unsat'       # ERROR when mantle not specified\nphase = 0\nkr = 1\n[]\n[]\n[Preconditioning]\nactive = smp_lu_mumps\n[smp_lu_mumps]\ntype = SMP\nfull = true\npetsc_options_iname = '-pc_type -pc_factor_mat_solver_package'\npetsc_options_value = 'lu       mumps'\n[]\n[]\n[Executioner]\ntype = Transient\nsolve_type = Newton\nend_time = 315576000000      # [s] 10000 year\n#end_time = 1E6              # [s] ~[12 days]\ndtmax = 3.2E10               # [s] ~1000 year. advanced parameter. Maximum timestep size in an adaptive run. Default to 1E30\nnl_max_its = 25              # solver parameter. Max Nonlinear Iterations. Default to 50\nl_max_its = 100              # solver parameter. Max Linear Iterations. Default to 10000\nnl_abs_tol = 1E-06           # solver parameter. Nonlinear absolute tolerance. Default to 1E-50\nnl_rel_tol = 1E-08           # solver parameter. Nonlinear Relative Tolerance. Default to 1E-08\nscheme = 'implicit-euler'    # the default TimeIntegrator\n[TimeStepper]                #\u00a0TimeStepper subsystem [block always nested within the Executioner block]\ntype = IterationAdaptiveDT # adjust the timestep based on the number of iterations\noptimal_iterations = 10    # target number of nonlinear iterations\ndt = 1E5                   # ~[27 h]\ngrowth_factor = 2\ncutback_factor = 0.5\n[]\n[]\n[Outputs]\n[ou]\ntype = Exodus\n#output_material_properties = true\n[]\n[]",
                  "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2126980",
                  "updatedAt": "2022-06-26T08:48:12Z",
                  "publishedAt": "2022-02-07T16:50:39Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": []
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "garciapintado"
                  },
                  "bodyText": "Hello,\nAnd this is an alternative attempt. Here I thought about constraining the variables controlled by the PorousFlow dictator {porepressure, temperature} to the PorousFlow subdomains (everywhere but the mantle). That is, neither in their definition nor everywhere else they are supposed to exist in the mantle. None of the related Kernels or Materials makes any reference to the mantle [at least not on purpose].\nThen I\u2019ve created and alternative variable, non-controlled by the PorousFlow dictator, named {temperature_mantle} which only exists in the mantle, and is subject only to conductive evolution, through the use of non PorousFlow Kernels: SpecificHeatConductionTimeDerivative and HeatConduction [after your previous indications], with their specific non-PorousFlow parameters.\nAlso, there is now an additional internal side between the mantle and the above domain (the one that house be visible by the PorousFlow dictator). And there are boundary conditions specific to temperature and to temperature_mantle. Step-by-step, to remove any possibility of creating an error because of any interaction between temperature and temperature_mantle, they are not coupled. I would not know, anyway, how to coupled them yet, but I guess this should be possible somehow through their common boundary. So, I\u2019d just expect them to evolve as independent variables.\nThat is: the aim of the test is [a] to see if PorousFlow can work only on a subdomain(s), and [b] if this worked, then I'd expect the overall \u201cmultiphysics\u201d problem could be approached with the current PorousFlow+MOOSE [i.e. only heat conduction in the mantle, and the THC \u2014thermo-hydro-chemical problem everywhere else\u2014], provided that later on temperatureand temperature_mantle can be coupled, so their coupling would substitute the values at their common boundary.\nWell, unfortunately, PorousFlow gives an error again at initialisation of Materials:\n\u2026\nMaterial property 'dPorousFlow_porepressure_nodal_dvar', requested by 'PorousFlow_density_nodal_all' is not defined on block mantle\nMaterial property 'dPorousFlow_saturation_nodal_dvar', requested by 'PorousFlow_density_nodal_all' is not defined on block mantle\nMaterial property 'dPorousFlow_temperature_nodal_dvar', requested by 'PorousFlow_density_nodal_all' is not defined on block mantle\n\u2026\nIt appears that at initialisation, PorousFlowDictator is forcing some Action to occur everywhere in the domain [perhaps PorousFlowAddMaterialAction or  PorousFlowAddMaterialJoiner?]. If this is so, it seems that as it stands, it can\u2019t be constrained to work in specific subdomains, preventing it from multiphysics coupling with adjacent domains. Could this be so?\nIf so, and there is anything I could do to help adding this possibility [facing my severe lack of C++ knowledge], please let me know.\nI am pasting the self-contained input file for this test.\n[Mesh]\n[gen]\ntype = GeneratedMeshGenerator\ndim = 2\nxmin = -200000\nxmax =   200000\nymin = -150000\nymax =   0\nelem_type = TRI6\nnx = 100\nny = 75\n[]\n[lcrust]\ntype = SubdomainBoundingBoxGenerator\ninput = 'gen'\nblock_id = 1\nbottom_left = '-200000 -40000 0'\ntop_right = '200000 -20000 0'\n[]\n[ucrust]\ntype = SubdomainBoundingBoxGenerator\ninput = 'lcrust'\nblock_id = 2\nbottom_left = '-200000 -20000 0'\ntop_right = '200000 -10000 0'\n[]\n[unsat]\ntype = SubdomainBoundingBoxGenerator\ninput = 'ucrust'\nblock_id = 3\nbottom_left = '-200000 -10000 0'\ntop_right = '200000 0 0'\n[]\n[rename]\ntype = RenameBlockGenerator\ninput = 'unsat'\nold_block = '0 1 2 3'\nnew_block = 'mantle lcrust ucrust unsat'\n[]\n[topnopore]\ntype = SideSetsBetweenSubdomainsGenerator\ninput = 'rename'\nnew_boundary = 'top_nopore'\nprimary_block = 'mantle'\npaired_block = 'lcrust'\n[]\n[]\n[GlobalParams]\nPorousFlowDictator = dictator\ngravity = '0 -9.81 0'              # make global, so no need to add it to the userobject requiring it\n[]\n[UserObjects]\n[dictator]\ntype = PorousFlowDictator\nporous_flow_vars = 'porepressure temperature'\nnumber_fluid_phases = 1\nnumber_fluid_components = 1\n[]\n[pp_KT_advectiveflux_onecomp_userobj]\ntype = PorousFlowAdvectiveFluxCalculatorSaturated       # [1-phase, 1-comp, fully saturated] one kernel for each fluid component\nblock = 'lcrust ucrust unsat'                           # OPTIONAL, list of blocks that this object will be applied to\nflux_limiter_type = superbee\nmultiply_by_density = true # default. Implies the advective flux is multiplied by density, so it is a mass flux\n[]\n[heat_KT_advectiveflux_userobj]\ntype = PorousFlowAdvectiveFluxCalculatorSaturatedHeat\nblock = 'lcrust ucrust unsat'\nflux_limiter_type = superbee\nmultiply_by_density = true # default. Implies the advective flux is multiplied by density, so it is a mass flux\n[]\n[]\n[Variables]\n[porepressure]\nblock = 'lcrust ucrust unsat'   # blocks where this variable exists\nfamily = LAGRANGE\norder = SECOND\n[]\n[temperature]                     # [K] parsed initial condition in the ICs block below\nblock = 'lcrust ucrust unsat'    # blocks where this variable exists\nfamily = LAGRANGE\norder = SECOND\nscaling = 1E-08                  # this variable scaling brings the residual R_T to the same order of magnitude that the Pressure residual R_P\n[]\n[temperature_mantle]               # [K] parsed initial condition in the ICs block below\nblock = 'mantle'                 # blocks where this variable exists\nfamily = LAGRANGE\norder = SECOND\nscaling = 1E-08                  # this variable scaling brings the residual R_T to the same order of magnitude that the Pressure residual R_P\n[]\n[]\n[Kernels] # as added by the action [PorousFlowFullySaturated]\n[pp_time_derivative]                         # one kernel for each fluid component\ntype = PorousFlowMassTimeDerivative        # these kernels lump the fluid-component mass to the nodes to ensure superior numerical stabilization\nblock = 'lcrust ucrust unsat'\nvariable = porepressure\n[]\n[pp_KT_advectiveflux_kernel]\ntype = PorousFlowFluxLimitedTVDAdvection                              # one kernel for each fluid component\nblock = 'lcrust ucrust unsat'\nadvective_flux_calculator = pp_KT_advectiveflux_onecomp_userobj  # PorousFlowAdvectiveFluxCalculator UserObjectName\nvariable = porepressure\n[]\n[heat_time_derivative]\ntype = PorousFlowEnergyTimeDerivative      # this kernel lumps the heat energy-density to the nodes to ensure superior numerical stabilization\nblock = 'lcrust ucrust unsat'\nvariable = temperature\n# save_in = # name of auxiliary variable to save this Kernel residual contributions to.\n[]\n[heat_conduction]\ntype = PorousFlowHeatConduction\nblock = 'lcrust ucrust unsat'\nvariable = temperature\n[]\n[heat_KT_advectiveflux_kernel]\ntype = PorousFlowFluxLimitedTVDAdvection                          # one kernel for each fluid component\nblock = \"lcrust ucrust unsat\"\nadvective_flux_calculator = heat_KT_advectiveflux_userobj         # PorousFlowAdvectiveFluxCalculator UserObjectName\nvariable = temperature\n[]\n[heat_time_derivative_mantle]\ntype = SpecificHeatConductionTimeDerivative\nblock = 'mantle'\nvariable = temperature_mantle\nlumping = true\ndensity = density_mantle\nspecific_heat = specific_heat_mantle\n[]\n[heat_conduction_mantle]\ntype = HeatConduction\nblock = 'mantle'\nvariable = temperature_mantle\ndiffusion_coefficient = thermal_conductivity_mantle\n[]\n[]\n[ICs]\n[porepressure_IC]\ntype = FunctionIC\nblock = \"lcrust ucrust unsat\"\nvariable = porepressure               # [Pa]\nfunction = '9.81*(-y)*1000'\n[]\n[temperature_IC]\ntype = FunctionIC\nblock = \"lcrust ucrust unsat\"\nvariable = temperature\nfunction = '273.15+5+(-y)600/150000'     # => 878.15 = 273.15+5+600 at the bottom [273.15+5+600/15000040000]\n[]\n[temperature_mantle_IC]\ntype = FunctionIC\nblock = \"mantle\"\nvariable = temperature_mantle\nfunction = '273.15+5+(-y)600/150000'     # => 878.15 = 273.15+5+600 at the bottom [273.15+5+600/15000040000]\n[]\n[]\n[BCs]\n[Ptop]\ntype = DirichletBC                     # this is a NodalBC\nvariable = porepressure\nvalue = 101325.0                       # [Pa] 1 atm\nboundary = top\n[]\n[Ttop]\ntype = DirichletBC\nvariable = temperature\nvalue = 278.15                         #\nboundary = top\n[]\n[Tbot]\ntype = DirichletBC\nvariable = temperature\nvalue = 438.15  # matching grad_T_y = 600/150000\nboundary = top_nopore\n[]\n[Ttop_mantle]\ntype = DirichletBC\nvariable = temperature_mantle\nvalue = 438.15  # matching grad_T_y = 600/150000\nboundary = top_nopore\n[]\n[Tbot_mantle]\ntype = DirichletBC\nvariable = temperature_mantle\nvalue = 878.15  # matching grad_T_y = 600/150000\nboundary = bottom\n[]\n[]\n[Modules]\n[FluidProperties]\n[the_simple_fluid]\ntype = SimpleFluidProperties\nbulk_modulus = 2E9\nviscosity = 1.0E-3\ndensity0 = 1000.0\n[]\n[]\n[]\n[Materials]\n[materials_mantle]\ntype = GenericConstantMaterial\nblock = mantle\nprop_names = 'thermal_conductivity_mantle specific_heat_mantle density_mantle'\nprop_values = '3.3 1200.0 3360.0'\n[]\n[porosity_lcrust]\ntype = PorousFlowPorosity\nblock = lcrust\nporosity_zero = 0.05\nthermal = true\nthermal_expansion_coeff = 3.66E-05\nreference_temperature = 273.15\nfluid = true\nsolid_bulk = 10.E09\nbiot_coefficient = 0.8\nbiot_coefficient_prime = 0.8\nmechanical = false\n[]\n[porosity_ucrust]\ntype = PorousFlowPorosity\nblock = ucrust\nporosity_zero = 0.05\nthermal = true\nthermal_expansion_coeff = 3.38E-05\nreference_temperature = 273.15\nfluid = true\nsolid_bulk = 10.E09\nbiot_coefficient = 0.8\nbiot_coefficient_prime = 0.8\nmechanical = false\n[]\n[porosity_unsat]\ntype = PorousFlowPorosity\nblock = unsat\nporosity_zero = 0.05\nthermal = true\nthermal_expansion_coeff = 3.38E-05\nreference_temperature = 273.15\nfluid = true\nsolid_bulk = 10.E09\nbiot_coefficient = 0.8\nbiot_coefficient_prime = 0.8\nmechanical = false\n[]\n[permeability_lcrust]\ntype = PorousFlowPermeabilityKozenyCarman\nblock = lcrust\nn = 3\nm = 2\nphi0 = 0.05\nk0 = 9.0E-16\nporoperm_function = 'kozeny_carman_phi0'\n[]\n[permeability_ucrust]\ntype = PorousFlowPermeabilityKozenyCarman\nblock = ucrust\nn = 3\nm = 2\nphi0 = 0.05\nk0 = 1.0E-15\nporoperm_function = 'kozeny_carman_phi0'\n[]\n[permeability_unsat]\ntype = PorousFlowPermeabilityKozenyCarman\nblock = unsat\nn = 3\nm = 2\nphi0 = 0.05\nk0 = 1.0E-22\nporoperm_function = 'kozeny_carman_phi0'\n[]\n[internal_energy_lcrust]\ntype = PorousFlowMatrixInternalEnergy\nblock = lcrust\ndensity = 2850.0                      # [kg.m-3] density of rock grains\nspecific_heat_capacity = 1200.0       # [J.kg-1.K-1] specific heat capacity of rock grains\n[]\n[internal_energy_ucrust]\ntype = PorousFlowMatrixInternalEnergy\ndensity = 2700.0\nspecific_heat_capacity = 1200.0\n[]\n[internal_energy_unsat]\ntype = PorousFlowMatrixInternalEnergy\nblock = unsat\ndensity = 2700.0\nspecific_heat_capacity = 1200.0\n[]\n[lambda_lcrust]\ntype = PorousFlowThermalConductivityFromPorosity\nblock = lcrust\nlambda_f = '0.56 0 0 0 0.56 0 0 0 0.56'\nlambda_s = '2.5 0 0 0 2.5 0 0 0 2.5'\n[]\n[lambda_ucrust]\ntype = PorousFlowThermalConductivityFromPorosity\nblock = ucrust\nlambda_f = '0.56 0 0 0 0.56 0 0 0 0.56'\nlambda_s = '2.3 0 0 0 2.3 0 0 0 2.3'\n[]\n[lambda_unsat]\ntype = PorousFlowThermalConductivityFromPorosity # rock-fluid combined thermal conductivity by weighted sum of rock and fluid conductivities\nblock = unsat\nlambda_f = '0.56 0 0 0 0.56 0 0 0 0.56'\nlambda_s = '2.3 0 0 0 2.3 0 0 0 2.3'\n[]\n[porepressure_material]\ntype = PorousFlow1PhaseFullySaturated # at_nodes=false by default\nblock = 'lcrust ucrust unsat'\nporepressure = porepressure\n[]\n[temperature_material]\ntype = PorousFlowTemperature          # at_nodes=false by default\nblock = 'lcrust ucrust unsat'                            # I think I would not need this here, as temperature exists in all blocks\ntemperature = temperature\n[]\n[massfrac]\ntype = PorousFlowMassFraction         # at_nodes=false by default\nblock = 'lcrust ucrust unsat'         # list of blocks where this object applies to\n[]\n[simple_fluid]\ntype = PorousFlowSingleComponentFluid      # see documentation for this material regarding the choice of units\nblock = 'lcrust ucrust unsat'\nfp = the_simple_fluid                      # this Material is at_nodes=false by default\nphase = 0\n[]\n[effective_fluid_pressure] # create effective fluid pressure [is requested by PorousFlowPorosity even it has not mechanical coupling]\nblock = 'lcrust ucrust unsat'\ntype = PorousFlowEffectiveFluidPressure\n[]\n[nearest_qp]\ntype = PorousFlowNearestQp                 #\u00a0atNodes=false by default\nblock = 'lcrust ucrust unsat'       # should mantle be neglected here?\n[]\n[relperm] # required by PorousFlowDarcyVelocityComponent AuxKernels\ntype = PorousFlowRelativePermeabilityConst # atNodes=false by default\nblock = 'lcrust ucrust unsat'       # ERROR when mantle not specified\nphase = 0\nkr = 1                                     # default, anyway\n[]\n[]\n[Preconditioning]\nactive = smp_lu_mumps\n[smp_lu_mumps]\ntype = SMP\nfull = true\npetsc_options_iname = '-pc_type -pc_factor_mat_solver_package'\npetsc_options_value = 'lu       mumps'\n[]\n[]\n[Executioner]\ntype = Transient\nsolve_type = Newton\nend_time = 315576000000      # [s] 10000 year\n#end_time = 1E6              # [s] ~[12 days]\ndtmax = 3.2E10               # [s] ~1000 year. advanced parameter. Maximum timestep size in an adaptive run. Default to 1E30\nnl_max_its = 25              # solver parameter. Max Nonlinear Iterations. Default to 50\nl_max_its = 100              # solver parameter. Max Linear Iterations. Default to 10000\nnl_abs_tol = 1E-06           # solver parameter. Nonlinear absolute tolerance. Default to 1E-50\nnl_rel_tol = 1E-08           # solver parameter. Nonlinear Relative Tolerance. Default to 1E-08\nscheme = 'implicit-euler'    # the default TimeIntegrator\n[TimeStepper]                #\u00a0TimeStepper subsystem [block always nested within the Executioner block]\ntype = IterationAdaptiveDT # adjust the timestep based on the number of iterations\noptimal_iterations = 10    # target number of nonlinear iterations\ndt = 1E5                   # ~[27 h]\ngrowth_factor = 2\ncutback_factor = 0.5\n[]\n[]\n[Outputs]\n[ou]\ntype = Exodus\n#output_material_properties = true\n[]\n[]",
                  "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2127470",
                  "updatedAt": "2022-06-26T08:48:12Z",
                  "publishedAt": "2022-02-07T17:59:20Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "Hi @garciapintado .  This looks like a bug to me.  We need to look into it.",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2128553",
                          "updatedAt": "2022-06-26T08:48:12Z",
                          "publishedAt": "2022-02-07T20:51:15Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "WilkAndy"
                  },
                  "bodyText": "Hi @cpgr , i think we need to fix a bug in PorousFlow .   The problem is when the PorousFlow Variables are block restricted.  MOOSE then complains it needs certain Materials on blocks where the PorousFlow Variables do not exist.  For instance, if the PorousFlow Variables (and Materials, etc) do not appear on block = mantle, then MOOSE spits back things like:\nMaterial property 'dPorousFlow_porepressure_nodal_dvar', requested by 'PorousFlow_density_nodal_all' is not defined on block mantle\nMaterial property 'dPorousFlow_porepressure_nodal_dvar', requested by 'PorousFlow_density_nodal_all_face' is not defined on block mantle\nMaterial property 'dPorousFlow_porepressure_nodal_dvar', requested by 'PorousFlow_density_nodal_all_neighbor' is not defined on block mantle\n\nNote the _face and _neighbor in the last two messages.  What is this?!\n(It appears that the \"core\" variables, such as PorousFlow_porepressure_nodal are not needed, but the derivatives dPorousFlow_porepressure_nodal_dvar are, but there are quite a few error messages, so i could just be missing something.)\nHopefully today i'll have time to create a simple example.",
                  "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2128558",
                  "updatedAt": "2022-06-26T08:48:12Z",
                  "publishedAt": "2022-02-07T20:52:04Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "cpgr"
                          },
                          "bodyText": "It must have something to do with the nodal materials that we use. Hopefully it isn't too tricky to get to the bottom of.",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2129069",
                          "updatedAt": "2022-06-26T08:48:13Z",
                          "publishedAt": "2022-02-07T22:26:51Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Hi @WilkAndy & @cpgr,  Many thanks for looking into this!",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2130972",
                          "updatedAt": "2022-06-26T08:48:12Z",
                          "publishedAt": "2022-02-08T06:55:33Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "Hi @cpgr .  I believe the problem is in the Joiners.  As far as i can see PorousFlowAddMaterialJoiner.C does not take into account block-restricted materials.  I think every time we addJoiner we'll have to pass block-restrictions along.  Do you agree with this?  I'm going to start coding it now, but would be good to have your confirmation.",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2138298",
                          "updatedAt": "2022-06-26T08:48:12Z",
                          "publishedAt": "2022-02-09T04:04:00Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "@garciapintado , i've got a fix for this.  It will take some time for it to appear in MOOSE: perhaps 1 week?  If you are in a hurry i can tell you how to get my code.",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2138627",
                          "updatedAt": "2022-09-07T01:30:21Z",
                          "publishedAt": "2022-02-09T05:26:42Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "How fast! Many thanks! I think I can wait for a week to just do the git pull and in the meantime try to learn how to add an extra material myself through an Exodus input file [a REAL volumetric strain field which would replace the one currently taken from the mechanical coupling for PorousFlowPorosity, plus another REAL field to be used as factor for the permeability]. Basic stuff, but my first attempt to do some actual C++ MOOSE coding, and I have to do it anyway.\nShall we close this discussion as the masking topic is answered, or keep it open to follow up further steps in this MOOSE+PorousFlow application?",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2139477",
                          "updatedAt": "2022-09-07T01:30:21Z",
                          "publishedAt": "2022-02-09T07:59:53Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "Thanks for finding the bug, @garciapintado  !",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2140060",
                          "updatedAt": "2022-09-07T01:30:21Z",
                          "publishedAt": "2022-02-09T09:41:37Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "cpgr"
                  },
                  "bodyText": "Oh, I wasn't expecting this!\nSo if I understand this, the joiner makes a material everywhere, even where a variable and subsequent nodal material aren't even present? It all works when there is the same material defined on different blocks, as long as it is on all blocks, but fails when one block doesn't have that material (like in the example above).\nHopefully you can propagate the block info easily enough.",
                  "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2138319",
                  "updatedAt": "2022-06-26T08:48:12Z",
                  "publishedAt": "2022-02-09T04:12:13Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "OK, good to have your confirmation, thanks.",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2138326",
                          "updatedAt": "2022-06-26T08:48:13Z",
                          "publishedAt": "2022-02-09T04:13:23Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "cpgr"
                          },
                          "bodyText": "Good sleuthing Andy!",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2138348",
                          "updatedAt": "2022-06-26T08:48:13Z",
                          "publishedAt": "2022-02-09T04:19:16Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "Yea, i think i'm going to have to create that info in the PorousFlowDictator.  Otherwise i have to query all Materials, looking for, eg, all the PorousFlowPorosity, and take a union of all their blocks.  That would be quite ugly code just to get around this case we've never seen in the history of PorousFlow.",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2138352",
                          "updatedAt": "2022-06-26T08:48:12Z",
                          "publishedAt": "2022-02-09T04:21:27Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "cpgr"
                          },
                          "bodyText": "So something like a pf_blocks = 'block0 block1' in the dictator and then use that in the joiner materials?",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2138434",
                          "updatedAt": "2022-09-23T07:38:12Z",
                          "publishedAt": "2022-02-09T04:45:17Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "Yea.  Maybe i'm being lazy and not querying all the Materials multiple times.  What do you think?",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2138600",
                          "updatedAt": "2022-09-07T01:30:21Z",
                          "publishedAt": "2022-02-09T05:22:28Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "Anyway, i implemented the Dictator idea and it works, so i know the Joiners were the problem",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2138614",
                          "updatedAt": "2022-09-07T01:30:21Z",
                          "publishedAt": "2022-02-09T05:24:04Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "cpgr"
                          },
                          "bodyText": "This is probably the easiest fix.",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2138647",
                          "updatedAt": "2022-09-07T01:30:21Z",
                          "publishedAt": "2022-02-09T05:30:11Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "Heheheh, now i'm thinking i'm being lazy!!",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2138651",
                          "updatedAt": "2022-09-07T01:30:21Z",
                          "publishedAt": "2022-02-09T05:31:07Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "cpgr"
                          },
                          "bodyText": "Efficient sounds better",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2138677",
                          "updatedAt": "2022-09-07T01:30:21Z",
                          "publishedAt": "2022-02-09T05:38:00Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "WilkAndy"
                  },
                  "bodyText": "Fixing this problem in #20260",
                  "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2138633",
                  "updatedAt": "2022-06-26T08:48:12Z",
                  "publishedAt": "2022-02-09T05:27:29Z",
                  "isAnswer": true,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "Yea, good, let's close",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2140018",
                          "updatedAt": "2022-06-26T08:48:13Z",
                          "publishedAt": "2022-02-09T09:33:00Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "WilkAndy"
                  },
                  "bodyText": "Hi @garciapintado - how is your modelling going?",
                  "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2225641",
                  "updatedAt": "2022-06-26T08:48:12Z",
                  "publishedAt": "2022-02-22T04:03:00Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Hi @WilkAndy! I was preparing the matlab side of it, and when I went to update MOOSE by the end of last week, it turned out the the idaholab server was down. It seems that the issue has been solved tonight [German time] (#20351). So I'm trying back right now...",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2226368",
                          "updatedAt": "2022-06-26T08:48:12Z",
                          "publishedAt": "2022-02-22T07:04:41Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Hi @WilkAndy, I believe it should work for me now!\nA simple 2D test works as expected [temperature only controlled by diffusion in the mantle, and Porous flow for the top layers, and porepressure only existing in the top layers]. A bit more complicated tests are crashing but this must be my mistake. So I'll try to figure out the errors and hopefully come back with something more realistic running...",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2227473",
                          "updatedAt": "2022-07-29T02:16:45Z",
                          "publishedAt": "2022-02-22T10:09:41Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Hi @WilkAndy. Just to say that I've got a \"realistic\" synthetic domain running with tabulated fluid properties [water97]. Now, as the [synthetic] 'mantle' is not considered, the high pressure and temperature values that led to the previous crashes are not there anymore. This is great news to me!\nI'll go on now with the real case simulations. One note is that I am using constant porosity and permeability [haven't managed to make it run with PorousFlowPorosity]. But in the application I'll pass constant fields of porosity & permeability pre-calculated in Matlab as 1st step to circumvent this...",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2229872",
                          "updatedAt": "2022-07-29T02:16:58Z",
                          "publishedAt": "2022-02-22T16:12:31Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Hi @WilkAndy. Only to report that I later noticed that geothermal gradients were not realistic in my synthetic tests. For geothermal gradients going to about 800 \u00baC at 120km depth the runs worked well, but when I changed that to a more standard [~1300\u00baC at 120 km depth]. The solver did not converge at all, often with warnings about water temperature being below the minimum for the EOS [eventually I got rid of these warning by extrapolating ---with 0-slope the tabulated EOS also towards lower temperature values, but still this did not solve the convergence problems]. The limiting gradient for converging runs was that to reach ~900\u00baC at 120 km depth].\nSo, I've been struggling with that [plus another matlab settings for the coupling]. In the end I've just now tried to switch from the Kuzmin-Turek stabilization to a full upwinding for both fluid pressure and temperature, and it turns out that now the runs converge very well for the more realistic geothermal gradient.\nSo, this is just to let you know that the full upwinding schemes  converge better than KZ in these synthetic tests. I'll go now, finally, for the real case scenario with input from matlab... I'd presume that the more complicated new part for me will be to set the BCs, as some areas are under the ocean [for which Dirichlet are not OK for outflow pressures and temperatures --- the venting areas---], and  some other are actually subaerial in the sides of the domain [actually I am still unsure if it is possible to go ahead with fully saturated flow, which I'd like if possible]. Anyway, I'll report results...",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2244428",
                          "updatedAt": "2022-07-29T02:17:41Z",
                          "publishedAt": "2022-02-24T14:33:46Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "garciapintado"
                          },
                          "bodyText": "Sorry, just to note thatt KZ stabilisation with flux limiter VanLeer also converges very well (3 times slower than full upwinding but very fast still). So, the issue seemed to be the \"superbee\" flux limiter I was using before.",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2244589",
                          "updatedAt": "2022-07-29T02:17:42Z",
                          "publishedAt": "2022-02-24T14:57:05Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "WilkAndy"
                          },
                          "bodyText": "OK, that's good news about the flux limiter, but .... i don't understand it!   I'll have to have a think :-)",
                          "url": "https://github.com/idaholab/moose/discussions/20139#discussioncomment-2246753",
                          "updatedAt": "2022-07-29T02:17:47Z",
                          "publishedAt": "2022-02-24T20:30:23Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "Segmentation fault occurs in program running",
          "author": {
            "login": "xchengood"
          },
          "bodyText": "Hi, Moose experts or users,\nRecently, I take one creep model for reference ('A physics-based crystallographic modeling framework for describing the thermal creep behavior of Fe-Cr alloys') and try to write an individual class including .h and .c files. After debugging, there are no errors in compiling. When attempting to run the program with .i extension, I got the 'Segmentation fault' message below.\nerror.txt\nSo two questions here:\n\nWhat possible reasons cause this? And have any suggestions to deal with it?\nAre there good ways to check, debug or verify the codes?\n\nAppreciate your help.",
          "url": "https://github.com/idaholab/moose/discussions/20318",
          "updatedAt": "2022-07-04T08:28:32Z",
          "publishedAt": "2022-02-16T17:24:18Z",
          "category": {
            "name": "Q&A Modules: Solid mechanics"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "GiudGiud"
                  },
                  "bodyText": "Hello\nSince you are using a custom class, there are a plethora of reasons you could hit a seg fault. Some simple (reading out of bounds for example), some more complex (using data that has not been initialized for example)\nThe good way to work on this is to follow our debugging instructions, located here:\nhttps://mooseframework.inl.gov/application_development/debugging.html\nGuillaume",
                  "url": "https://github.com/idaholab/moose/discussions/20318#discussioncomment-2191613",
                  "updatedAt": "2022-07-04T08:28:30Z",
                  "publishedAt": "2022-02-16T20:46:14Z",
                  "isAnswer": true,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "xchengood"
                          },
                          "bodyText": "Hi @GiudGiud. Thank you for your useful information. I followed debugging instructions to debug my codes and got the following errors. Could you have a look and what errors do those messages indicate? Thank you.",
                          "url": "https://github.com/idaholab/moose/discussions/20318#discussioncomment-2224611",
                          "updatedAt": "2022-07-04T08:28:30Z",
                          "publishedAt": "2022-02-21T23:11:02Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "I dont see anything obvious sadly.\nIt is seg-faulting while trying to access an array, but I dont know why.\nIn the debugger, can you print local variables see if anything is odd?",
                          "url": "https://github.com/idaholab/moose/discussions/20318#discussioncomment-2224872",
                          "updatedAt": "2022-07-04T08:28:29Z",
                          "publishedAt": "2022-02-22T00:33:20Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "loganharbour"
                          },
                          "bodyText": "Looks like you're indexing into an array out of bounds in CrystalPlasticityOrowanDislocationSlip.C on line 519. We need to see this class to help more.",
                          "url": "https://github.com/idaholab/moose/discussions/20318#discussioncomment-2225023",
                          "updatedAt": "2022-07-04T08:28:30Z",
                          "publishedAt": "2022-02-22T01:19:36Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "xchengood"
                          },
                          "bodyText": "Hi @GiudGiud and @loganharbour,\nThank you for your help. Now I fixed all issues and the .i file can be successfully run. I still have two questions.\n\nThe base class I used in the program is 'CrystalPlasticityStressUpdateBase'. I can get data on strain and stress. I am not sure if the obtained strain is the creep strain. Studying the curve of creep strain vs. time is my purpose.\nUsually, in order to study the curve of creep strain vs. time well, should I keep running the program for at least several hours?\nAppreciate your help again.",
                          "url": "https://github.com/idaholab/moose/discussions/20318#discussioncomment-2231829",
                          "updatedAt": "2022-07-04T08:28:48Z",
                          "publishedAt": "2022-02-22T20:48:37Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "@jiangwen84 will know about these tensor mechanics things",
                          "url": "https://github.com/idaholab/moose/discussions/20318#discussioncomment-2231859",
                          "updatedAt": "2022-07-04T08:28:49Z",
                          "publishedAt": "2022-02-22T20:55:29Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "sapitts"
                          },
                          "bodyText": "The crystal plasticity 'stress calculator' and base class are described in detail on the documentation page: https://mooseframework.inl.gov/source/materials/crystal_plasticity/ComputeMultipleCrystalPlasticityStress.html .\n\nThe total Lagrangian strain is calculated in the stress calculator class (ComputeMultipleCrystalPlasticityStress), and you can use the plastic deformation gradient to determine when plastic deformation begins.\nGenerally crystal plasticity simulations require a small timestep size and have many stateful properties. Both of these factor will contribute to a longer simulation run time.",
                          "url": "https://github.com/idaholab/moose/discussions/20318#discussioncomment-2231882",
                          "updatedAt": "2022-07-04T08:28:49Z",
                          "publishedAt": "2022-02-22T20:59:02Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "xchengood"
                          },
                          "bodyText": "Hi @sapitts.\nThank you for your helpful information.\n\nAre there developed examples about the determination of plastic deformation beginning for reference?\nI saw there is a class called 'RadialReturnCreepStressUpdateBase' inherited from 'RadialReturnStressUpdate' in which creep strain is determined. Class named 'PowerLawCreepStressUpdate' inherits this class well. Do you have any thoughts or suggestions about how to apply these classes to my case (the base class is CrystalPlasticityStressUpdateBase) making me easier and simpler to determine creep strain?\n\nThank you.",
                          "url": "https://github.com/idaholab/moose/discussions/20318#discussioncomment-2237474",
                          "updatedAt": "2022-07-04T08:28:51Z",
                          "publishedAt": "2022-02-23T15:51:52Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "sapitts"
                          },
                          "bodyText": "I usually watch the plastic deformation gradient tensor diagonal components to determine the onset of plasticity: when any of the diagonal components change from unity (e.g. 0.9999999 or 1.000011), then I consider the strain from then on to be the inelastic strain.\nI'd strongly recommend staying with the CrystalPlasticityStressUpdateBase as your base class. The other classes you've listed assume a J2 yield surface which is not appropriate for a crystal plasticity model.  In the crystal plasticity classes we don't really distinguish between plastic strain and creep strain but rather consider all of them inelastic strain and inelastic deformation",
                          "url": "https://github.com/idaholab/moose/discussions/20318#discussioncomment-2238319",
                          "updatedAt": "2022-07-04T08:28:53Z",
                          "publishedAt": "2022-02-23T17:49:06Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "xchengood"
                          },
                          "bodyText": "Hi @sapitts. Thank you for your suggestions very much.",
                          "url": "https://github.com/idaholab/moose/discussions/20318#discussioncomment-2246665",
                          "updatedAt": "2022-07-04T08:28:55Z",
                          "publishedAt": "2022-02-24T20:17:36Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "Compile and Test Moose Issue",
          "author": {
            "login": "npaloskey"
          },
          "bodyText": "I keep getting: \"TestHarness\" requires python version 3.6 or greater, version 2.7 is being used.\" When attempting to do:\n./ run_tests -j4\nWhen checking my version of of python in the shell using: python --version, it outputs Python 3.6.8.\nNot sure what the issue here is. Any suggestions?\nNote: I'm attempting to install moose on a job-scheduling environment and have been following the HPC Cluster installation guide as instructed by my research supervisor. I've had no issues up until this point.\nThanks!",
          "url": "https://github.com/idaholab/moose/discussions/20391",
          "updatedAt": "2022-08-25T00:01:21Z",
          "publishedAt": "2022-02-24T04:37:42Z",
          "category": {
            "name": "Q&A Getting Started"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "GiudGiud"
                  },
                  "bodyText": "Hello\nDid you alias python?\nIs the python2 folder earlier than the python3 one in your PATH environment variable?\nGuillaume",
                  "url": "https://github.com/idaholab/moose/discussions/20391#discussioncomment-2241338",
                  "updatedAt": "2022-08-25T00:01:25Z",
                  "publishedAt": "2022-02-24T05:11:43Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "npaloskey"
                          },
                          "bodyText": "Hi, I didn't use an alias. Instead, my supervisor had told me to use \"module load\" in my .bash_profile. Below is what is currently in the\n.bash_profile:\nUser specific environment and startup programs\nPATH=$PATH:$HOME/bin\nexport PATH\nmodule load gcc/8.3.1 mpich/3.2 cmake/3.18.4 python/3.6.8\nsource $HOME/.moose_profile\nWhen returning to my home directory, I can run: \"module list\" and it outputs the following:\nCurrently Loaded Modules:\n\ngcc/8.3.1   2) mpich/3.2   3) cmake/3.18.4   4) python/3.6.8\n\nI believe that the default python version for my system is 2.7 but I believe activating the above python module does change the version of python being used every time I open the shell.\nThanks for the quick reply!",
                          "url": "https://github.com/idaholab/moose/discussions/20391#discussioncomment-2241373",
                          "updatedAt": "2022-08-25T00:01:31Z",
                          "publishedAt": "2022-02-24T05:20:08Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "npaloskey"
                          },
                          "bodyText": "Hey Giud,\nI saw an earlier discussion in this thread addressing what sounds like the same problem I'm having currently. I changed the shebang in moose/test/run_tests to #!/usr/bin/env python3 and the it seems like most of the tests passed. Thanks!",
                          "url": "https://github.com/idaholab/moose/discussions/20391#discussioncomment-2241691",
                          "updatedAt": "2022-08-25T00:01:41Z",
                          "publishedAt": "2022-02-24T06:38:18Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "nice glad you got it going",
                          "url": "https://github.com/idaholab/moose/discussions/20391#discussioncomment-2241858",
                          "updatedAt": "2022-08-25T00:01:41Z",
                          "publishedAt": "2022-02-24T07:13:31Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "npaloskey"
                  },
                  "bodyText": "Change the shebang in moose/test/run_tests to #!/usr/bin/env python3 and the tests should pass",
                  "url": "https://github.com/idaholab/moose/discussions/20391#discussioncomment-2244816",
                  "updatedAt": "2022-08-25T00:01:53Z",
                  "publishedAt": "2022-02-24T15:26:46Z",
                  "isAnswer": true,
                  "replies": {
                    "edges": []
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "Missing rendering in ParaView? Exodus output corrupted?",
          "author": {
            "login": "mangerij"
          },
          "bodyText": "Hi,\nI am looking at the exodus outputs of a time-dependent simulation in ParaView v5.9.0. At some point yesterday, I got a strange error that printed to the terminal during a MOOSE simulation, killed the simulation, and now every simulation does not visualize properly. I did not save the exact error but I noticed something similar about a month ago. That error is attached in this screenshot:\n\nI am unsure that this is related to the visualization issues, but after this error I was unable to recompile without first using git clean -xfd\nAs for the visualization, I see the variables at time step 0, but they get cut off somehow after. See the two images below.\n\n\nI verified this on two different machines that both have ParaView v5.9.0. Another wrinkle to this puzzle is that the exodus outputs from the cluster from the same version of MOOSE/Ferret can be visualized correctly in both installed ParaView applications.\nI am worried something got corrupted somehow but I have done a complete recompile and still have the same problem.\nthanks",
          "url": "https://github.com/idaholab/moose/discussions/20381",
          "updatedAt": "2022-07-12T04:34:41Z",
          "publishedAt": "2022-02-23T14:37:38Z",
          "category": {
            "name": "Q&A Tools"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "loganharbour"
                  },
                  "bodyText": "Can you run this in dbg and get us a backtrace on that MPI assertion?",
                  "url": "https://github.com/idaholab/moose/discussions/20381#discussioncomment-2237094",
                  "updatedAt": "2022-07-12T04:35:29Z",
                  "publishedAt": "2022-02-23T14:55:43Z",
                  "isAnswer": true,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "mangerij"
                          },
                          "bodyText": "Well the error doesn't show up anymore! I do not know how to trigger it.\nI have only seen it twice, once yesterday and once a month ago (where the screenshot is).",
                          "url": "https://github.com/idaholab/moose/discussions/20381#discussioncomment-2237127",
                          "updatedAt": "2022-07-12T04:35:29Z",
                          "publishedAt": "2022-02-23T14:59:25Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "loganharbour"
                          },
                          "bodyText": "Can you paste the contents of conda list?",
                          "url": "https://github.com/idaholab/moose/discussions/20381#discussioncomment-2237154",
                          "updatedAt": "2022-07-12T04:35:29Z",
                          "publishedAt": "2022-02-23T15:04:28Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "mangerij"
                          },
                          "bodyText": "_libgcc_mutex             0.1                 conda_forge    conda-forge\n_openmp_mutex             4.5                       1_gnu    conda-forge\n_sysroot_linux-64_curr_repodata_hack 3                   h5bd9786_13    conda-forge\nalsa-lib                  1.2.3                h516909a_0    conda-forge\nappdirs                   1.4.4              pyh9f0ad1d_0    conda-forge\nbeautifulsoup4            4.9.3              pyhb0f4dca_0    conda-forge\nbinutils_impl_linux-64    2.35.1               h193b22a_2    conda-forge\nbinutils_linux-64         2.35                hc3fd857_29    conda-forge\nblosc                     1.21.0               h9c3ff4c_0    conda-forge\nbrotli                    1.0.9                h7f98852_5    conda-forge\nbrotli-bin                1.0.9                h7f98852_5    conda-forge\nbrotlipy                  0.7.0           py39h3811e60_1001    conda-forge\nbrunsli                   0.1                  h9c3ff4c_0    conda-forge\nbzip2                     1.0.8                h7f98852_4    conda-forge\nc-ares                    1.18.1               h7f8727e_0\nca-certificates           2021.10.8            ha878542_0    conda-forge\ncertifi                   2021.10.8        py39hf3d152e_1    conda-forge\ncffi                      1.14.6           py39he32792d_0    conda-forge\ncfitsio                   3.470                hb418390_7    conda-forge\ncharls                    2.2.0                h9c3ff4c_0    conda-forge\ncharset-normalizer        2.0.12             pyhd8ed1ab_0    conda-forge\nclang                     12.0.1               ha770c72_0    conda-forge\nclang-12                  12.0.1          default_ha53f305_0    conda-forge\nclang-tools               12.0.1          default_ha53f305_0    conda-forge\nclangxx                   12.0.1          default_ha53f305_0    conda-forge\ncloudpickle               2.0.0              pyhd8ed1ab_0    conda-forge\ncmake                     3.22.1               h1fce559_0\ncryptography              35.0.0           py39hbca0aa6_0    conda-forge\ncurl                      7.80.0               h7f8727e_0\ncycler                    0.11.0             pyhd8ed1ab_0    conda-forge\ncytoolz                   0.11.0           py39h3811e60_3    conda-forge\ndask-core                 2022.2.0           pyhd8ed1ab_0    conda-forge\ndbus                      1.13.6               h48d8840_2    conda-forge\ndeepdiff                  5.5.0              pyhd8ed1ab_0    conda-forge\ndouble-conversion         3.1.5                he1b5a44_2    conda-forge\neigen                     3.3.9                h4bd325d_1    conda-forge\nexpat                     2.4.1                h9c3ff4c_0    conda-forge\nffmpeg                    4.3.2                hca11adc_0    conda-forge\nfontconfig                2.13.1            hba837de_1005    conda-forge\nfreetype                  2.10.4               h0708190_1    conda-forge\nfsspec                    2022.1.0           pyhd8ed1ab_0    conda-forge\ngcc_impl_linux-64         9.3.0               h70c0ae5_19    conda-forge\ngcc_linux-64              9.3.0               h7247604_29    conda-forge\ngettext                   0.19.8.1          h0b5b191_1005    conda-forge\ngfortran_impl_linux-64    9.3.0               hc4a2995_19    conda-forge\ngfortran_linux-64         9.3.0               ha1c937c_29    conda-forge\ngiflib                    5.2.1                h36c2ea0_2    conda-forge\ngl2ps                     1.4.2                h0708190_0    conda-forge\nglew                      2.1.0                h9c3ff4c_2    conda-forge\nglib                      2.68.3               h9c3ff4c_0    conda-forge\nglib-tools                2.68.3               h9c3ff4c_0    conda-forge\ngmp                       6.2.1                h58526e2_0    conda-forge\ngmpy2                     2.1.0b5          py39h78fa15d_0    conda-forge\ngnutls                    3.6.13               h85f3911_1    conda-forge\ngst-plugins-base          1.18.4               hf529b03_2    conda-forge\ngstreamer                 1.18.4               h76c114f_2    conda-forge\ngxx_impl_linux-64         9.3.0               hd87eabc_19    conda-forge\ngxx_linux-64              9.3.0               h0d07fa4_29    conda-forge\nhdf4                      4.2.15               h10796ff_3    conda-forge\nhdf5                      1.10.6          nompi_h6a2412b_1114    conda-forge\nicu                       68.1                 h58526e2_0    conda-forge\nidna                      3.3                pyhd8ed1ab_0    conda-forge\nimagecodecs               2021.6.8         py39h44211f0_0    conda-forge\nimageio                   2.3.0                      py_1    conda-forge\nimportlib-metadata        4.11.1           py39hf3d152e_0    conda-forge\nimportlib_metadata        4.11.1               hd8ed1ab_0    conda-forge\njbig                      2.1               h7f98852_2003    conda-forge\njinja2                    3.0.1              pyhd8ed1ab_0    conda-forge\njpeg                      9d                   h516909a_0    conda-forge\njsoncpp                   1.9.4                h4bd325d_3    conda-forge\njsonpickle                2.1.0              pyhd8ed1ab_0    conda-forge\njxrlib                    1.1                  h7f98852_2    conda-forge\nkernel-headers_linux-64   3.10.0              h4a8ded7_13    conda-forge\nkiwisolver                1.3.1            py39h1a9c180_1    conda-forge\nkrb5                      1.19.2               hcc1bbae_0    conda-forge\nlame                      3.100             h7f98852_1001    conda-forge\nlatexcodec                2.0.1              pyh9f0ad1d_0    conda-forge\nlcms2                     2.12                 hddcbb42_0    conda-forge\nld_impl_linux-64          2.35.1               hea4e1c9_2    conda-forge\nlerc                      2.2.1                h9c3ff4c_0    conda-forge\nlibaec                    1.0.5                h9c3ff4c_0    conda-forge\nlibblas                   3.9.0           11_linux64_openblas    conda-forge\nlibbrotlicommon           1.0.9                h7f98852_5    conda-forge\nlibbrotlidec              1.0.9                h7f98852_5    conda-forge\nlibbrotlienc              1.0.9                h7f98852_5    conda-forge\nlibcblas                  3.9.0           11_linux64_openblas    conda-forge\nlibclang                  11.1.0          default_ha53f305_1    conda-forge\nlibclang-cpp12            12.0.1          default_ha53f305_0    conda-forge\nlibcurl                   7.80.0               h0b77cf5_0\nlibdeflate                1.7                  h7f98852_5    conda-forge\nlibdrm-cos7-x86_64        2.4.97            h9b0a68f_1105    conda-forge\nlibedit                   3.1.20191231         he28a2e2_2    conda-forge\nlibev                     4.33                 h516909a_1    conda-forge\nlibevent                  2.1.10               hcdb4288_3    conda-forge\nlibffi                    3.3                  h58526e2_2    conda-forge\nlibgcc-devel_linux-64     9.3.0               h7864c58_19    conda-forge\nlibgcc-ng                 9.3.0               h2828fa1_19    conda-forge\nlibgfortran-ng            9.4.0               h69a702a_11    conda-forge\nlibgfortran5              9.4.0               h62347ff_11    conda-forge\nlibglib                   2.68.3               h3e27bee_0    conda-forge\nlibglu                    9.0.0             hf484d3e_1000    conda-forge\nlibglvnd-cos7-x86_64      1.0.1             h9b0a68f_1105    conda-forge\nlibglvnd-glx-cos7-x86_64  1.0.1             h9b0a68f_1105    conda-forge\nlibgomp                   9.3.0               h2828fa1_19    conda-forge\nlibice-cos7-x86_64        1.0.9             h9b0a68f_1105    conda-forge\nlibice-devel-cos7-x86_64  1.0.9             h9b0a68f_1105    conda-forge\nlibiconv                  1.16                 h516909a_0    conda-forge\nliblapack                 3.9.0           11_linux64_openblas    conda-forge\nlibllvm11                 11.1.0               hf817b99_2    conda-forge\nlibllvm12                 12.0.1               hf817b99_0    conda-forge\nlibnetcdf                 4.8.0           nompi_hcd642e3_103    conda-forge\nlibnghttp2                1.46.0               hce63b2e_0\nlibogg                    1.3.4                h7f98852_1    conda-forge\nlibopenblas               0.3.17          pthreads_h8fe5266_1    conda-forge\nlibopus                   1.3.1                h7f98852_1    conda-forge\nlibpng                    1.6.37               hed695b0_2    conda-forge\nlibpq                     13.3                 hd57d9b9_0    conda-forge\nlibsm-cos7-x86_64         1.2.2             h9b0a68f_1105    conda-forge\nlibsm-devel-cos7-x86_64   1.2.2             h9b0a68f_1105    conda-forge\nlibssh2                   1.9.0                ha56f1ee_6    conda-forge\nlibstdcxx-devel_linux-64  9.3.0               hb016644_19    conda-forge\nlibstdcxx-ng              11.2.0              he4da1e4_12    conda-forge\nlibtheora                 1.1.1             h7f98852_1005    conda-forge\nlibtiff                   4.3.0                hf544144_1    conda-forge\nlibuuid                   2.32.1            h7f98852_1000    conda-forge\nlibuv                     1.42.0               h7f98852_0    conda-forge\nlibvorbis                 1.3.7                h9c3ff4c_0    conda-forge\nlibwebp-base              1.2.0                h7f98852_2    conda-forge\nlibx11-common-cos7-x86_64 1.6.7             h9b0a68f_1105    conda-forge\nlibx11-cos7-x86_64        1.6.7             h9b0a68f_1105    conda-forge\nlibx11-devel-cos7-x86_64  1.6.7             h9b0a68f_1105    conda-forge\nlibxcb                    1.13              h7f98852_1003    conda-forge\nlibxext-cos7-x86_64       1.3.3             h9b0a68f_1105    conda-forge\nlibxext-devel-cos7-x86_64 1.3.3             h9b0a68f_1105    conda-forge\nlibxkbcommon              1.0.3                he3ba5ed_0    conda-forge\nlibxml2                   2.9.12               h72842e0_0    conda-forge\nlibxslt                   1.1.33               h15afd5d_2    conda-forge\nlibxt-cos7-x86_64         1.1.5             h9b0a68f_1105    conda-forge\nlibxt-devel-cos7-x86_64   1.1.5             h9b0a68f_1105    conda-forge\nlibzip                    1.8.0                h4de3113_0    conda-forge\nlibzlib                   1.2.11            h36c2ea0_1013    conda-forge\nlibzopfli                 1.0.3                h9c3ff4c_0    conda-forge\nlivereload                2.6.3              pyh9f0ad1d_0    conda-forge\nlocket                    0.2.0                      py_2    conda-forge\nloguru                    0.5.3            py39hf3d152e_3    conda-forge\nlxml                      4.6.3            py39h107f48f_0    conda-forge\nlz4-c                     1.9.3                h9c3ff4c_1    conda-forge\nmako                      1.1.4              pyh44b312d_0    conda-forge\nmarkupsafe                2.0.1            py39h3811e60_0    conda-forge\nmatplotlib                3.4.2            py39hf3d152e_0    conda-forge\nmatplotlib-base           3.4.2            py39h2fa2bec_0    conda-forge\nmesa-khr-devel-cos7-x86_64 18.3.4            h9b0a68f_1105    conda-forge\nmesa-libgl-cos7-x86_64    18.3.4            h9b0a68f_1105    conda-forge\nmesa-libgl-devel-cos7-x86_64 18.3.4            h9b0a68f_1105    conda-forge\nmesa-libglapi-cos7-x86_64 18.3.4            h9b0a68f_1105    conda-forge\nmesalib                   18.3.1               h590aaf7_0    conda-forge\nmock                      4.0.3            py39hf3d152e_1    conda-forge\nmoose-libmesh             2022.01.19              build_2    idaholab\nmoose-libmesh-vtk         9.1.0                   build_3    idaholab\nmoose-mpich               3.4.2                   build_2    idaholab\nmoose-petsc               3.15.1                  build_6    idaholab\nmoose-tools               2022.01.25       py39hc64a412_0    idaholab\nmpc                       1.2.1                h9f54685_0    conda-forge\nmpfr                      4.1.0                h9202a9a_1    conda-forge\nmpi                       1.0                       mpich    conda-forge\nmpmath                    1.2.1              pyhd8ed1ab_0    conda-forge\nmysql-common              8.0.25               ha770c72_2    conda-forge\nmysql-libs                8.0.25               hfa10184_2    conda-forge\nncurses                   6.3                  h7f8727e_2\nnettle                    3.6                  he412f7d_0    conda-forge\nnetworkx                  2.6.3              pyhd8ed1ab_1    conda-forge\nnspr                      4.30                 h9c3ff4c_0    conda-forge\nnss                       3.67                 hb5efdd6_0    conda-forge\nnumpy                     1.21.1           py39hdbf815f_0    conda-forge\nolefile                   0.46               pyh9f0ad1d_1    conda-forge\nopenh264                  2.1.1                h780b84a_0    conda-forge\nopenjpeg                  2.4.0                hb52868f_1    conda-forge\nopenssl                   1.1.1m               h7f8727e_0\nordered-set               4.1.0              pyhd8ed1ab_0    conda-forge\npackaging                 21.3               pyhd8ed1ab_0    conda-forge\npandas                    1.3.1            py39hde0f152_0    conda-forge\npartd                     1.2.0              pyhd8ed1ab_0    conda-forge\npcre                      8.45                 h9c3ff4c_0    conda-forge\npillow                    7.2.0            py39h6f3857e_2    conda-forge\npip                       22.0.3             pyhd8ed1ab_0    conda-forge\npkg-config                0.29.2            h36c2ea0_1008    conda-forge\npooch                     1.6.0              pyhd8ed1ab_0    conda-forge\nproj                      7.2.0                h277dcde_2    conda-forge\npthread-stubs             0.4               h36c2ea0_1001    conda-forge\npugixml                   1.11.4               h9c3ff4c_0    conda-forge\npybtex                    0.24.0           py39hf3d152e_0    conda-forge\npycparser                 2.21               pyhd8ed1ab_0    conda-forge\npylatexenc                2.10               pyhd8ed1ab_0    conda-forge\npyopenssl                 22.0.0             pyhd8ed1ab_0    conda-forge\npyparsing                 3.0.7              pyhd8ed1ab_0    conda-forge\npyqt                      5.12.3           py39hf3d152e_7    conda-forge\npyqt-impl                 5.12.3           py39h0fcd23e_7    conda-forge\npyqt5-sip                 4.19.18          py39he80948d_7    conda-forge\npyqtchart                 5.12             py39h0fcd23e_7    conda-forge\npyqtwebengine             5.12.1           py39h0fcd23e_7    conda-forge\npysocks                   1.7.1            py39hf3d152e_4    conda-forge\npython                    3.9.7                h12debd9_1\npython-dateutil           2.8.2              pyhd8ed1ab_0    conda-forge\npython_abi                3.9                      2_cp39    conda-forge\npytz                      2021.3             pyhd8ed1ab_0    conda-forge\npywavelets                1.1.1            py39hce5d2b2_3    conda-forge\npyyaml                    5.4.1            py39h3811e60_0    conda-forge\nqt                        5.12.9               hda022c4_4    conda-forge\nreadline                  8.1                  h46c0cb4_0    conda-forge\nrequests                  2.27.1             pyhd8ed1ab_0    conda-forge\nrhash                     1.4.1                h7f98852_0    conda-forge\nscikit-image              0.18.2           py39hde0f152_0    conda-forge\nscipy                     1.7.0            py39hee8e79c_1    conda-forge\nsetuptools                59.8.0           py39hf3d152e_0    conda-forge\nsix                       1.16.0             pyh6c4a22f_0    conda-forge\nsnappy                    1.1.8                he1b5a44_3    conda-forge\nsoupsieve                 2.3.1              pyhd8ed1ab_0    conda-forge\nsqlite                    3.37.2               hc218d9a_0\nsympy                     1.9              py39hf3d152e_0    conda-forge\nsysroot_linux-64          2.17                h4a8ded7_13    conda-forge\ntbb                       2020.3               hfd86e86_0\ntbb-devel                 2020.3               hfd86e86_0\ntifffile                  2021.7.2           pyhd8ed1ab_0    conda-forge\ntk                        8.6.11               h21135ba_0    conda-forge\ntoolz                     0.11.2             pyhd8ed1ab_0    conda-forge\ntornado                   6.1              py39h3811e60_1    conda-forge\ntzdata                    2021e                he74cb21_0    conda-forge\nurllib3                   1.26.8             pyhd8ed1ab_1    conda-forge\nutfcpp                    3.2.1                ha770c72_0    conda-forge\nvtk                       9.0.3           no_osmesa_py39h801044d_100    conda-forge\nwheel                     0.37.1             pyhd8ed1ab_0    conda-forge\nx264                      1!161.3030           h7f98852_1    conda-forge\nxorg-kbproto              1.0.7             h7f98852_1002    conda-forge\nxorg-libice               1.0.10               h7f98852_0    conda-forge\nxorg-libsm                1.2.3             hd9c2040_1000    conda-forge\nxorg-libx11               1.7.2                h7f98852_0    conda-forge\nxorg-libxau               1.0.9                h7f98852_0    conda-forge\nxorg-libxdmcp             1.1.3                h7f98852_0    conda-forge\nxorg-libxext              1.3.4                h7f98852_1    conda-forge\nxorg-libxt                1.2.1                h7f98852_2    conda-forge\nxorg-x11-proto-devel-cos7-x86_64 2018.4            h9b0a68f_1105    conda-forge\nxorg-xextproto            7.3.0             h7f98852_1002    conda-forge\nxorg-xproto               7.0.31            h7f98852_1007    conda-forge\nxz                        5.2.5                h516909a_1    conda-forge\nyaml                      0.2.5                h516909a_0    conda-forge\nzfp                       0.5.5                h9c3ff4c_5    conda-forge\nzipp                      3.7.0              pyhd8ed1ab_1    conda-forge\nzlib                      1.2.11            h36c2ea0_1013    conda-forge\nzstd                      1.5.0                ha95c52a_0    conda-forge",
                          "url": "https://github.com/idaholab/moose/discussions/20381#discussioncomment-2237214",
                          "updatedAt": "2022-07-12T04:35:29Z",
                          "publishedAt": "2022-02-23T15:14:09Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "loganharbour"
                          },
                          "bodyText": "Yep... as I expected: mpich 3.4.2 (upgraded recently from 3.3.2). I've seen similar errors on rare occasion on our build boxes. We'll see what we can do, but this is a hard one to nail down. If it happens to you again please keep the error trace and post here!\nPing @idaholab/moose-dev-ops and @roystgnr  for notifications",
                          "url": "https://github.com/idaholab/moose/discussions/20381#discussioncomment-2237239",
                          "updatedAt": "2022-07-12T04:35:46Z",
                          "publishedAt": "2022-02-23T15:18:58Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "is this exodus or nemesis output?",
                          "url": "https://github.com/idaholab/moose/discussions/20381#discussioncomment-2237269",
                          "updatedAt": "2022-07-12T04:35:46Z",
                          "publishedAt": "2022-02-23T15:24:23Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "loganharbour"
                          },
                          "bodyText": "I am looking at the exodus outputs",
                          "url": "https://github.com/idaholab/moose/discussions/20381#discussioncomment-2237385",
                          "updatedAt": "2022-07-12T04:35:46Z",
                          "publishedAt": "2022-02-23T15:39:30Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "mangerij"
                          },
                          "bodyText": "Do you think the mpi issue and the Exodus output one is related? Would a complete rewipe of the MOOSE folder and recompile fix it?",
                          "url": "https://github.com/idaholab/moose/discussions/20381#discussioncomment-2237422",
                          "updatedAt": "2022-07-12T04:35:46Z",
                          "publishedAt": "2022-02-23T15:45:15Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "loganharbour"
                          },
                          "bodyText": "I'm not sure, that was the more interesting issue here. Looks like the MPI assertion was hit during Jacobian evaluation, yet you have cruddy output (executed at a very different stage)... nonetheless I don't think a build cleaning is going to do you any good here. I think this is either an mpich issue or an issue with TIMPI (our MPI wrapper), with my suspicion leading me to the former.",
                          "url": "https://github.com/idaholab/moose/discussions/20381#discussioncomment-2237442",
                          "updatedAt": "2022-07-12T04:35:47Z",
                          "publishedAt": "2022-02-23T15:48:19Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "mangerij"
                          },
                          "bodyText": "well what bothers me is that this (the visualization issue) seem to just come from nowhere. This has been running more or less OK for the past two months and I reguarly have to look at the exodus outputs.\nI have Ferret/MOOSE one two different clusters and they give the ok outputs that can be visualized but my local workstation is a no. I am wondering if our IT admin maybe updated something that could cause this too. These things sometimes run silently in the background even when I am running simulations",
                          "url": "https://github.com/idaholab/moose/discussions/20381#discussioncomment-2237519",
                          "updatedAt": "2022-07-12T04:36:00Z",
                          "publishedAt": "2022-02-23T15:56:57Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "is it a temporary solution to downgrade mpich?",
                          "url": "https://github.com/idaholab/moose/discussions/20381#discussioncomment-2237525",
                          "updatedAt": "2022-07-12T04:36:03Z",
                          "publishedAt": "2022-02-23T15:58:20Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "How to get the direction-dependent material properties?",
          "author": {
            "login": "rh201"
          },
          "bodyText": "Hi MOOSEers,\nWhen I try to use direction-dependent material properties like the form below, how can I calculate the angle of the normal vector w.r.t the x/y-axis and get direction (\\phi) here ? Is there anything related on it? I appreciate any suggestions and help.Thank you.",
          "url": "https://github.com/idaholab/moose/discussions/20312",
          "updatedAt": "2022-06-11T13:16:26Z",
          "publishedAt": "2022-02-15T22:02:29Z",
          "category": {
            "name": "Q&A General"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "GiudGiud"
                  },
                  "bodyText": "Hello\nWhen you solve the equation do you always evaluate the property on the X/Y/Z axis or can it be any direction?\nWe usually represent anisotropy with a tensor material property\nGuillaume",
                  "url": "https://github.com/idaholab/moose/discussions/20312#discussioncomment-2234008",
                  "updatedAt": "2022-06-11T13:16:28Z",
                  "publishedAt": "2022-02-23T06:51:08Z",
                  "isAnswer": true,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "rh201"
                          },
                          "bodyText": "Hi~\nIf I want to get \\phi here, I need to compute the projection on X/Y/Z, am I right?\nCould you refer me to the tensor material property you mentioned? I'm interested in it and want to see how it works. Thank you.",
                          "url": "https://github.com/idaholab/moose/discussions/20312#discussioncomment-2235352",
                          "updatedAt": "2022-06-11T13:16:27Z",
                          "publishedAt": "2022-02-23T11:03:57Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "Here's an example of a rank two (matrix) tensor property\nhttps://mooseframework.inl.gov/source/materials/ADGenericFunctionRankTwoTensor.html\nIf there is no cross terms you can also just use a vector.\nSo to compute phi in your case, it seems D (is it a variable?) 's gradient should be passed to the material property (using coupledGradient).\nThen e2 and e1 are fixed I imagine, so computing phi should be ok.\nG is going to be a material property? Or is the equation you pasted the equation for the non linear system you're trying to solve?",
                          "url": "https://github.com/idaholab/moose/discussions/20312#discussioncomment-2237349",
                          "updatedAt": "2022-06-11T13:16:28Z",
                          "publishedAt": "2022-02-23T15:34:39Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "rh201"
                          },
                          "bodyText": "Thank you. I'll look into that page. @GiudGiud\nYes, e1 and e2 is the unit vector of X/Y axis, D is the variable and Gc is the material property which I want it to be \\phi-dependent.\nI tried to calculate the D's gradient and use Gc directly in the kernel (with AD) as follows:\n\nADRealVectorValue x_unit = RealVectorValue(1,0,0);\nADRealVectorValue y_unit = RealVectorValue(0,1,0);\nADReal x_Projection =   _grad_u[_qp] * x_unit;\nADReal y_Projection =   _grad_u[_qp] * y_unit;\nADReal theta = std::atan2(y_Projection, x_Projection) - pi/2 ;\nreturn _Gc[_qp] * std::sin(theta) * ...\n\n\nIt compiles but I'm not sure of it. Could you help me check that? Thank you.",
                          "url": "https://github.com/idaholab/moose/discussions/20312#discussioncomment-2237575",
                          "updatedAt": "2022-06-11T13:16:30Z",
                          "publishedAt": "2022-02-23T16:04:38Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "Looks fine to me.\nYou can initialize x_unit and y_unit like this:\nRealVectorValue x_unit(1.0, 0.0, 0.0);",
                          "url": "https://github.com/idaholab/moose/discussions/20312#discussioncomment-2237631",
                          "updatedAt": "2022-06-11T18:00:34Z",
                          "publishedAt": "2022-02-23T16:09:33Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "rh201"
                          },
                          "bodyText": "Thank you. I'll give it a try.\nBests.",
                          "url": "https://github.com/idaholab/moose/discussions/20312#discussioncomment-2237667",
                          "updatedAt": "2022-06-11T18:00:34Z",
                          "publishedAt": "2022-02-23T16:13:17Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "Compile issue",
          "author": {
            "login": "mangerij"
          },
          "bodyText": "I routinely updated conda and pulled new MOOSE and now I am getting the following error:\n/home/LIST/mangeri/anaconda3/envs/moose/bin/../lib/gcc/x86_64-conda-linux-gnu/9.3.0/../../../../x86_64-conda-linux-gnu/bin/ld: warning: libtimpi_opt.so.6, needed by /home/LIST/mangeri/projects/moose/framework/contrib/pcre/libpcre-opt.so, not found (try using -rpath or -rpath-link)\nWhat could this be from?\nthanks",
          "url": "https://github.com/idaholab/moose/discussions/20366",
          "updatedAt": "2022-08-23T22:04:53Z",
          "publishedAt": "2022-02-22T18:29:18Z",
          "category": {
            "name": "Q&A General"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "GiudGiud"
                  },
                  "bodyText": "Hello\nJust a leftover compiled object.\ntry make clobberall and if it doesnt work, commit all your work then run git clean -xfd in the root directory of MOOSE\nGuillaume",
                  "url": "https://github.com/idaholab/moose/discussions/20366#discussioncomment-2231073",
                  "updatedAt": "2022-08-23T22:05:07Z",
                  "publishedAt": "2022-02-22T18:56:55Z",
                  "isAnswer": true,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "mangerij"
                          },
                          "bodyText": "Thanks, the second command worked to solve this issue.",
                          "url": "https://github.com/idaholab/moose/discussions/20366#discussioncomment-2236820",
                          "updatedAt": "2022-08-23T22:05:07Z",
                          "publishedAt": "2022-02-23T14:38:42Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      },
      {
        "node": {
          "title": "Modeling the viscoelastic-wave equation in frequency domain",
          "author": {
            "login": "aaelmeli"
          },
          "bodyText": "Hi\nLet's assume we have a complex vector field (displacements) u = u_r+i*u_i where u_r is a vector containing the real parts of u and u_i is a vector containing imaginary parts of u, and i=sqrt(-1) .\nThe elastic wave equation in the frequency domain can be described as:\n\u03c1\u03c9^2 u_r=\u2207.\u03c3_r (1)\n\u03c1\u03c9^2 u_i=\u2207.\u03c3_i  (2)\n\nIn that case, the real and imaginary parts of u were uncoupled everywhere except on the boundaries (only if we have absorbing boundary conditions). I could model those equations within moose, where the kernel is as follows:\n[Kernels]\n    [urealx]\n        type = StressDivergenceTensors\n        variable = uxr\n        displacements='uxr uyr'\n        component = 0\n        base_name = real\n        volumetric_locking_correction=True\n    []\n    [urealy]\n        type = StressDivergenceTensors\n        variable = uyr\n        displacements='uxr uyr'\n        component = 1\n        base_name = real\n        volumetric_locking_correction=True\n    []\n    [uimagx]\n        type = StressDivergenceTensors\n        variable = uxi\n        displacements='uxi uyi'\n        component = 0\n        base_name = imaginary\n        volumetric_locking_correction=True\n    []\n    [uimagy]\n        type = StressDivergenceTensors\n        variable = uyi\n        displacements='uxi uyi'\n        component = 1\n        base_name = imaginary\n        volumetric_locking_correction=True\n    []\n    [reaction_realx]\n        type = Reaction\n        variable = uxr\n        rate = ${fparse -omega*omega} \n    []\n    [reaction_realy]\n        type = Reaction\n        variable = uyr\n        rate = ${fparse -omega*omega} \n    []\n    [reaction_imagx]\n        type = Reaction\n        variable = uxi\n        rate = ${fparse -omega*omega} \n    []\n    [reaction_imagy]\n        type = Reaction\n        variable = uyi\n        rate = ${fparse -omega*omega} \n    []\n[]\n\nNow, I need to add the viscoelasticity to the model, where the elasticity tensor is no longer real-valued, eg. E = E_r + i\u03c9E_i. Thus, equations (1) and (2) turn to be:\n\u03c1\u03c9^2 u_r=\u2207.\u03c3_rr - \u2207.\u03c3_ii   (3)\n\u03c1\u03c9^2 u_i=\u2207.\u03c3_ir + \u2207.\u03c3_ri  (4)\n\nwith \u03c3_rr is the stress associated with the real part of the elasticity tensor E_r and the real part of the displacement u_r, and \u03c3_ir is the stresses associated with the imaginary part of the elasticity tensor E_i and the real part of the displacement u_r, and vice-versa.\nSo, the question now is, Can I model equations (3) and (4) in moose?\nAny thoughts will be appreciated.",
          "url": "https://github.com/idaholab/moose/discussions/20266",
          "updatedAt": "2022-06-18T06:10:08Z",
          "publishedAt": "2022-02-09T21:27:05Z",
          "category": {
            "name": "Q&A Modules: Solid mechanics"
          },
          "comments": {
            "edges": [
              {
                "node": {
                  "author": {
                    "login": "GiudGiud"
                  },
                  "bodyText": "Hello\nYou need to have a kernel that does the same work as a stressDivergenceTensor (except for the sign), but with a variable that is not the same as the equation name.\nWhat prevents you from using that one directly is the variable argument is both:\n\nwhat gets put through the divergence to compute the contribution to the residual/jacobian\nthe name of the equation that this term gets added to\n\nSo unless this already exists (@jiangwen84 do you know?), you ll just need to add an argument to this kernel to allow an arbitrary variable v to be used in the computation (and if v is not provided, then default to using variable).\nEDIT: I m actually not sure this isnt already supported. Would just specifying:\n        variable = uxr\n        displacements='uxi uyi'\n\nnot work?\nGuillaume",
                  "url": "https://github.com/idaholab/moose/discussions/20266#discussioncomment-2151696",
                  "updatedAt": "2022-06-18T06:10:21Z",
                  "publishedAt": "2022-02-10T17:42:41Z",
                  "isAnswer": false,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "also are there two displaced meshes? Or are all the equations written for the undisplaced mesh?",
                          "url": "https://github.com/idaholab/moose/discussions/20266#discussioncomment-2151746",
                          "updatedAt": "2022-06-18T06:10:22Z",
                          "publishedAt": "2022-02-10T17:50:34Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "aaelmeli"
                          },
                          "bodyText": "also are there two displaced meshes? Or are all the equations written for the undisplaced mesh?\n\nThe equations are for undisplaced mesh.\n\nEDIT: I m actually not sure this isnt already supported. Would just specifying:\n\nThanks for the suggestion, I will try this and get back to you.",
                          "url": "https://github.com/idaholab/moose/discussions/20266#discussioncomment-2152216",
                          "updatedAt": "2022-06-18T06:10:22Z",
                          "publishedAt": "2022-02-10T19:06:15Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "aaelmeli"
                          },
                          "bodyText": "EDIT: I m actually not sure this isnt already supported. Would just specifying:\n        variable = uxr\n        displacements='uxi uyi'\n\nnot work?\n\nHi,\nI have tried that option, please see the definition of the kernel and the materials. So, it is a 2D mesh that represents a cantilever, fixed on the left and imposed unit Dirichlet B.C on the right.\n[Kernels]\n    [urealx_r] # the (real_r) means that stress inteded to be computed is sigma_rr\n    type = StressDivergenceTensors\n    variable = uxr\n    displacements='uxr uyr'\n    component = 0\n    base_name = real\n    []\n    [urealx_i] #the (real_i) means that stress inteded to be computed is sigma_ri\n    type = StressDivergenceTensors\n    variable = uxr\n    displacements='uxi uyi'\n    component = 0\n    base_name = real #do I need to change the material??\n    []    \n    [urealy_r]\n    type = StressDivergenceTensors\n    variable = uyr\n    displacements='uxr uyr'\n    component = 1\n    base_name = real\n    []\n    [urealy_i]\n    type = StressDivergenceTensors\n    variable = uyr\n    displacements='uxi uyi'\n    component = 1\n    base_name = real\n    []    \n    [uimagx_i]\n    type = StressDivergenceTensors\n    variable = uxi\n    displacements='uxi uyi'\n    component = 0\n    base_name = imaginary\n    []\n    [uimagx_r]\n    type = StressDivergenceTensors\n    variable = uxi\n    displacements='uxr uyr'\n    component = 0\n    base_name = imaginary\n    []    \n    [uimagy_i]\n    type = StressDivergenceTensors\n    variable = uyi\n    displacements='uxi uyi'\n    component = 1\n    base_name = imaginary\n    []\n    [uimagy_r]\n    type = StressDivergenceTensors\n    variable = uyi\n    displacements='uxr uyr'\n    component = 1\n    base_name = imaginary\n    []    \n    [reaction_realx]\n        type = Reaction\n        variable = uxr\n        rate = -10000\n    []\n    [reaction_realy]\n        type = Reaction\n        variable = uyr\n        rate = -10000\n    []\n    [reaction_imagx]\n        type = Reaction\n        variable = uxi\n        rate = -10000\n    []\n    [reaction_imagy]\n        type = Reaction\n        variable = uyi\n        rate = -10000\n    []\n\n[]\n\nMaterials]\n\n  [elasticity_tensor_A]\n    type = ComputeIsotropicElasticityTensor\n    base_name = real\n    youngs_modulus = 1\n    poissons_ratio = 0.0\n  []\n  [strain_A]\n    type = ComputePlaneSmallStrain\n    base_name = real\n    displacements='uxr uyr'\n  []\n  [stress_A]\n    type = ComputeLinearElasticStress\n    base_name = real\n  []\n\n   [elasticity_tensor_B]\n    type = ComputeIsotropicElasticityTensor\n    base_name = imaginary\n    youngs_modulus = 0.1\n    poissons_ratio = 0.0\n  []\n  [strain_B]\n    type = ComputePlaneSmallStrain\n    base_name = imaginary\n    displacements='uxi uyi'\n  []\n  [stress_B]\n    type = ComputeLinearElasticStress\n    base_name = imaginary\n  []\n\n[]\n\nGiven this input, I am not getting the expected solution, which I am not sure about the reason for getting this, is it because of the -ve sign in equation (3), or incorrect modeling, or both.\nOne thing that I am wondering, Do I have modify the base name in the kernel definition in one way or another? And, is there a way that I can try to include the -ve sign in the kernel definition?, just to try your idea.",
                          "url": "https://github.com/idaholab/moose/discussions/20266#discussioncomment-2161085",
                          "updatedAt": "2022-06-18T06:10:22Z",
                          "publishedAt": "2022-02-11T23:55:41Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "You could add a boolean parameter to this kernel just to allow the switching of signs.\nI dont think you need to modify the base name.\nI have not checked the kernel definition in detail btw, this is really just a try.",
                          "url": "https://github.com/idaholab/moose/discussions/20266#discussioncomment-2169644",
                          "updatedAt": "2022-09-01T17:14:52Z",
                          "publishedAt": "2022-02-13T23:46:28Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "aaelmeli"
                          },
                          "bodyText": "You could add a boolean parameter to this kernel just to allow the switching of signs.\nI dont think you need to modify the base name.\nI have not checked the kernel definition in detail btw, this is really just a try.\n\nThanks for the suggestion, I will do that.\nOne question, is it possible to define the youngs_modulus with the -ve sign? I wanted to push the sign in the elasticity tensor. I have tried  it but it returned an error (which makes sense).  I know it is not the optimum way of doing it, but I was just thinking of the easiest way to do it.",
                          "url": "https://github.com/idaholab/moose/discussions/20266#discussioncomment-2170268",
                          "updatedAt": "2022-09-01T17:14:53Z",
                          "publishedAt": "2022-02-14T03:15:19Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "aaelmeli"
                          },
                          "bodyText": "Hi, @GiudGiud\nI have done several trials to use the StressDivergenceTensors kernels to model the former equations, (3) and (4) with no success. As you have suggested, I have added a boolean parameter to switch the sign of the stress divergence kernel. Also, based on what I have understood from the code, \"displacements\" is an array of coupled variables. Thus, I have considered this when writing my inputs. The input Kernel, Material  and Executioner definitions that I believe \"may\" make sense are as follow:\n[Kernels]\n    [urealx_r] #sigma_rr\n    type = StressDivergenceTensors\n    variable = uxr\n    displacements='uxr uyr'\n    component = 0\n    base_name = real\n    []\n    [urealy_r]\n    type = StressDivergenceTensors\n    variable = uyr\n    displacements='uxr uyr'\n    component = 1\n    base_name = real\n    []  \n#2\n    [uimagx_i] # (-ve)sigma_ii\n    type = StressDivergenceTensors\n    variable = uxr\n    displacements='uxi uyi'\n    component = 0\n    base_name = imaginary\n    negative_stress_divergence='true' #a parameter to negate the stressdivergence term\n    []\n    [uimagy_i]\n    type = StressDivergenceTensors\n    variable = uyr\n    displacements='uxi uyi'\n    component = 1\n    base_name = imaginary\n    negative_stress_divergence='true'\n    [] \n#3\n    [urealx_i] #sigma_ri\n    type = StressDivergenceTensors\n    variable = uxi\n    displacements='uxr uyr'\n    component = 0\n    base_name = real_i \n    []   \n    [urealy_i]\n    type = StressDivergenceTensors\n    variable = uyi\n    displacements='uxr uyr'\n    component = 1\n    base_name = real_i\n    []  \n#4\n    [uimagx_r]#sigma_ir\n    type = StressDivergenceTensors\n    variable = uxi\n    displacements='uxi uyi'\n    component = 0\n    base_name = imaginary_r\n    []        \n    [uimagy_r]\n    type = StressDivergenceTensors\n    variable = uyi\n    displacements='uxi uyi'\n    component = 1\n    base_name = imaginary_r\n    []\n #reaction terms              \n    [reaction_realx]\n        type = Reaction\n        variable = uxr\n        rate = -10000\n    []\n    [reaction_realy]\n        type = Reaction\n        variable = uyr\n        rate = -10000\n    []\n    [reaction_imagx]\n        type = Reaction\n        variable = uxi\n        rate = -10000\n    []\n    [reaction_imagy]\n        type = Reaction\n        variable = uyi\n        rate = -10000\n    []\n[]\n\n[Materials]\n\n  [elasticity_tensor_real]\n    type = ComputeIsotropicElasticityTensor\n    base_name = real\n    youngs_modulus = 1\n    poissons_ratio = 0.0\n  []\n  [strain_real]\n    type = ComputePlaneSmallStrain\n    base_name = real\n    displacements='uxr uyr'\n  []\n  [stress_real]\n    type = ComputeLinearElasticStress\n    base_name = real\n  []\n  [elasticity_tensor_real_i]\n    type = ComputeIsotropicElasticityTensor\n    base_name = real_i\n    youngs_modulus = 0.1\n    poissons_ratio = 0.0\n  []\n  [strain_real_i]\n    type = ComputePlaneSmallStrain\n    base_name = real_i\n    displacements='uxr uyr'\n  []\n  [stress_real_i]\n    type = ComputeLinearElasticStress\n    base_name = real_i\n  []\n    [elasticity_tensor_imaginary]\n    type = ComputeIsotropicElasticityTensor\n    base_name = imaginary\n    youngs_modulus = 0.1\n    poissons_ratio = 0.0\n  []\n  [strain_imaginary]\n    type = ComputePlaneSmallStrain\n    base_name = imaginary\n    displacements='uxi uyi'\n  []\n  [stress_imaginary]\n    type = ComputeLinearElasticStress\n    base_name = imaginary\n  []\n   [elasticity_tensor_imaginary_r]\n    type = ComputeIsotropicElasticityTensor\n    base_name = imaginary_r\n    youngs_modulus = 1\n    poissons_ratio = 0.0\n  []\n  [strain_imaginary_r]\n    type = ComputePlaneSmallStrain\n    base_name = imaginary_r\n    displacements='uxi uyi'\n  []\n  [stress_imaginary_r]\n    type = ComputeLinearElasticStress\n    base_name = imaginary_r\n  []\n\n[]\n\n[Executioner]\n  type = Steady\n  solve_type=LINEAR   \n petsc_options_iname = ' -pc_type'\n petsc_options_value = 'lu'\n[]\n\nThe real and imaginary parts of x-displacements using that input are as follow:\n\nWhere the expected solution should be something like this:\n\nSo, I have a couple of questions regarding this,\n1- Am I understanding the code correctly with respect to the \"displacements\" array? are these the test functions? if yes, is the input above correct?\n2- Do you think this way of coupling may not be achieved correctly through the StressDiverenceTensors and some other kernels e.g. Diffusion, may be better?",
                          "url": "https://github.com/idaholab/moose/discussions/20266#discussioncomment-2208377",
                          "updatedAt": "2022-09-01T17:14:53Z",
                          "publishedAt": "2022-02-19T01:26:49Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "GiudGiud"
                          },
                          "bodyText": "The displacements parameter is usually just that, a measure of how the mesh deformed.\nSo changing the base_name already made sure you used the right stress tensor.\nI'm actually wondering if changing the displacements was necessary/a good idea. I dont quite understand what this kernel is doing with regards to displacements, so if you do you should look at StressDivergenceTensors::computeQpOffDiagJacobian(unsigned int jvar)  to see how the displacements should be set.",
                          "url": "https://github.com/idaholab/moose/discussions/20266#discussioncomment-2222600",
                          "updatedAt": "2022-09-01T17:14:53Z",
                          "publishedAt": "2022-02-21T16:48:33Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              },
              {
                "node": {
                  "author": {
                    "login": "hugary1995"
                  },
                  "bodyText": "I tried to write an input file, and the solution looks correct:\n\nI am pasting my input file below, please compare it with yours to see what you were missing. I think you were very close. I modified the StressDivergenceTensors to take a coefficient so that I could control its sign, which is similar to your boolean parameter.\n[Mesh]\n  type = GeneratedMesh\n  dim = 1\n  xmin = 0\n  xmax = 1\n  nx = 1000\n[]\n\n[Variables]\n  [ui]\n  []\n  [ur]\n  []\n[]\n\n[BCs]\n  [left_real]\n    type = DirichletBC\n    variable = ur\n    value = 0\n    boundary = left\n  []\n  [left_imaginery]\n    type = DirichletBC\n    variable = ui\n    value = 0\n    boundary = left\n  []\n  [right_real]\n    type = DirichletBC\n    variable = ur\n    value = 1\n    boundary = right\n  []\n  [right_imaginery]\n    type = DirichletBC\n    variable = ui\n    value = 0\n    boundary = right\n  []\n[]\n\n[Kernels]\n  [real_rr]\n    type = StressDivergenceTensors\n    variable = ur\n    displacements = 'ur'\n    component = 0\n    base_name = rr\n    coefficient = 1\n  []\n  [real_ii]\n    type = StressDivergenceTensors\n    variable = ur\n    displacements = 'ui'\n    component = 0\n    base_name = ii\n    coefficient = -1\n  []\n  [real_reaction]\n    type = MatReaction\n    variable = ur\n    mob_name = w\n  []\n  [imaginery_ir]\n    type = StressDivergenceTensors\n    variable = ui\n    displacements = 'ur'\n    component = 0\n    base_name = ir\n    coefficient = 1\n  []\n  [imaginery_ri]\n    type = StressDivergenceTensors\n    variable = ui\n    displacements = 'ui'\n    component = 0\n    base_name = ri\n    coefficient = 1\n  []\n  [imaginery_reaction]\n    type = MatReaction\n    variable = ui\n    mob_name = w\n  []\n[]\n\n[Materials]\n  [bulk]\n    type = GenericFunctionMaterial\n    prop_names = 'w'\n    prop_values = '10000'\n  []\n  [E_rr]\n    type = ComputeIsotropicElasticityTensor\n    youngs_modulus = 1\n    poissons_ratio = 0.0\n    base_name = rr\n  []\n  [E_ri]\n    type = ComputeIsotropicElasticityTensor\n    youngs_modulus = 1\n    poissons_ratio = 0.0\n    base_name = ri\n  []\n  [E_ir]\n    type = ComputeIsotropicElasticityTensor\n    youngs_modulus = 0.1\n    poissons_ratio = 0.0\n    base_name = ir\n  []\n  [E_ii]\n    type = ComputeIsotropicElasticityTensor\n    youngs_modulus = 0.1\n    poissons_ratio = 0.0\n    base_name = ii\n  []\n  [strain_rr]\n    type = ComputeSmallStrain\n    displacements = 'ur'\n    base_name = rr\n  []\n  [strain_ri]\n    type = ComputeSmallStrain\n    displacements = 'ui'\n    base_name = ri\n  []\n  [strain_ir]\n    type = ComputeSmallStrain\n    displacements = 'ur'\n    base_name = ir\n  []\n  [strain_ii]\n    type = ComputeSmallStrain\n    displacements = 'ui'\n    base_name = ii\n  []\n  [stress_rr]\n    type = ComputeLinearElasticStress\n    base_name = rr\n  []\n  [stress_ri]\n    type = ComputeLinearElasticStress\n    base_name = ri\n  []\n  [stress_ir]\n    type = ComputeLinearElasticStress\n    base_name = ir\n  []\n  [stress_ii]\n    type = ComputeLinearElasticStress\n    base_name = ii\n  []\n[]\n\n[Executioner]\n  type = Steady\n  solve_type = FD\n  petsc_options_iname = '-pc_type'\n  petsc_options_value = 'lu'\n[]\n\n[Outputs]\n  exodus = true\n[]",
                  "url": "https://github.com/idaholab/moose/discussions/20266#discussioncomment-2225423",
                  "updatedAt": "2022-07-07T08:56:14Z",
                  "publishedAt": "2022-02-22T03:08:54Z",
                  "isAnswer": true,
                  "replies": {
                    "edges": [
                      {
                        "node": {
                          "author": {
                            "login": "hugary1995"
                          },
                          "bodyText": "This is apparently not optimal: I had to use four base names to define four different sets of parameters and constitutive models. This is sort of hacking the tensor mechanics to solve your specific problem, and the jacobian of the StressDivergenceTensors is also \"wrong\" with this hack. As a result, it'll have a hard time converging once the viscoelasticity becomes nonlinear. Using automatic differentiation might help you, e.g. ADStressDivergenceTensors ad AD materials. Going forward, I suggest you to create your own app.",
                          "url": "https://github.com/idaholab/moose/discussions/20266#discussioncomment-2225449",
                          "updatedAt": "2022-07-07T08:56:21Z",
                          "publishedAt": "2022-02-22T03:15:18Z",
                          "isAnswer": false
                        }
                      },
                      {
                        "node": {
                          "author": {
                            "login": "aaelmeli"
                          },
                          "bodyText": "Thank you, @hugary1995, the issue was in the \"jacobian\", thus, specifying solver type as LINEAR resulted in wrong results. AD helps a lot. Thanks again.",
                          "url": "https://github.com/idaholab/moose/discussions/20266#discussioncomment-2230646",
                          "updatedAt": "2022-07-07T08:56:21Z",
                          "publishedAt": "2022-02-22T17:56:31Z",
                          "isAnswer": false
                        }
                      }
                    ]
                  }
                }
              }
            ]
          }
        }
      }
    ]
  }
}