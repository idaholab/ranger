{"docstore/ref_doc_info": {"3c50ebd1-3e49-47f1-9407-0631faa4ffa7": {"node_ids": ["2ef2c3f6-5ea4-4136-9d17-a498bd430278", "67b40c80-510d-4eb2-88b8-8270e090b106", "b00e0f04-37df-481a-bcd5-0744578a070c", "30daf5ff-8a46-4f59-aa3f-d6b0a510c1f0"], "metadata": {"title": "Shallow Water Equations and Moose Vector Variables", "url": "https://github.com/idaholab/moose/discussions/19356"}}}, "docstore/data": {"2ef2c3f6-5ea4-4136-9d17-a498bd430278": {"__data__": {"id_": "2ef2c3f6-5ea4-4136-9d17-a498bd430278", "embedding": null, "metadata": {"title": "Shallow Water Equations and Moose Vector Variables", "url": "https://github.com/idaholab/moose/discussions/19356"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "3c50ebd1-3e49-47f1-9407-0631faa4ffa7", "node_type": "4", "metadata": {"title": "Shallow Water Equations and Moose Vector Variables", "url": "https://github.com/idaholab/moose/discussions/19356"}, "hash": "fe7bdbfb0c1226a62473d918ebb8c591a653eca28a26a4534e5a4a21e5cc2ac1", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "67b40c80-510d-4eb2-88b8-8270e090b106", "node_type": "1", "metadata": {}, "hash": "59cd8ff55678e3e39eb39111d098643b6e86fe5e28689b29b27f34920d4735be", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "Shallow Water Equations and Moose Vector Variables\nI am attempting to model the shallow water equations (SWE) with Moose (I'm a PhD student at Boise State University). I've used Moose for a variety of other geophysics, but the SWE are slightly more complicated. I mention that to say that I'm familiar with Moose, having gone through most of the tutorials.\nHere's my problem setup. I have the strong form that I use to generate the weak form of the equations. The weak form takes the following form (using inner product notation):\n(dqdt, \\psi) + <F(q) * n, \\psi> - (F(q), \\nabla \\psi) - (b + s, \\psi) = 0\n\\psi is the test function.\nq is the variable vector: [h, hu, hv].\nF(q) is the flux tensor: [ [hu, hv], [hu^2 + (1/2)gh^2, huv], [huv, hv^2 + (1/2)gh^2] ].\nh is water height.\nu and v are velocities.\nb and s are bathymetry and (friction) source terms.\nThese would be my questions:\nHow do I work with vector valued variables in Moose? What classes can I work with/ derive from?\nWhat about for vectors like q where the entries aren't necessarily physically related (like components of a velocity field)?\nWould I be able to use some of the tensor functionality to do this? I have briefly looked over it.\nI will continue to pour over tutorials and documentation, but any guidance would be appreciated.\nAnd finally, I read somewhere that a SWE module is in the works. Any word on progress there?\nMany thanks!\nHello\nFirst, since you only have 3 components and the equation seems to be writable in a vector-formulation, vector is the right choice and should give you better performance over implementing 3 scalar equations.\nI m a little concerned that having h and hu hv, which could be of different orders of magnitude since they have a different unit / physical meaning, will lead to convergence/scaling issues. You won't be able to scale the equations separately if you lump them in a vector\nI m not sure if we have documentation specially for implementing vector equations. If you find it please let me know. The process is mostly the same, you create a vector variable, then vector kernels to implement your equation etc. There is a VectorKernel base class you can inherit from for your kernels.\nIf you have a tensor anisotropic diffusivity for example, you will be able to use the tensor utilities (in utils/) for that.\nWe support the lagrange variables as vector variables. There are vector versions of kernels, bcs, auxkernels etc.\nAn example of a vector BC:\nhttps://mooseframework.inl.gov/source/bcs/VectorDirichletBC.html\nvector kernel:\nhttps://mooseframework.inl.gov/moose/source/kernels/VectorDiffusion.html\nAuxKernel has an example of a vector aux in the text:\nhttps://mooseframework.inl.gov/syntax/AuxKernels/\nWhere did you read about the SWE? It d be easier to tag the person who was talking about it here\nGuillaume\nYes I would only ever use a vector variable if the governing equation can logically be written in vector form like the momentum equation in Navier-Stokes. Speaking of which, the AD version of finite element incompressible Navier-Stokes in the navier_stokes module is probably one of the better places to look if you're curious about using vector variables.\nOur shallow water equation modeling with finite elements never really got off the ground. For modeling of hyperbolic-character equations we're going more and more towards our finite volume implementation.\nThanks for the resources on the vector variables and kernels. I'll dive into those objects to see what I can get done. All of the tutorials work with scalar variables and kernels, so thanks for pointing me towards the vector stuff. I hadn't considered the different orders of magnitude in h and u/v; I will keep that in mind moving forward.\nI saw in one of the tutorial presentations that SWE was a work in progress. I don't know who was working on it (or if that is still the case).\nI did see that Moose supports FV modeling, but I haven't looked into it much. I'll have to do that. That's how we normally solve the SWE anyways.\nRegardless, thanks for the direction! If I get any good results/progress, or if I have any further questions, I'll post them here.\nYeah, I implemented a shallow water model years ago, but I didn't know what I was doing and It had horrible artifacts with kilometer waves after some time :-D. I suppose the formulation was not stable with regular Galerkin FEM. \ud83e\udd37\u200d\u2642\ufe0f\nHere is the tidal model (it was done just for fun!)\n\n  \n    \n    \n\n    globe.mp4\n@aeslaughter had also worked on SWE\nResurrecting an old thread here, but I'm very close to have a DG based shallow water module ready for a pull request...\nI'm stoked to here about this. What project is this for?\nRelated to shallow water equations, we have HDG Navier-Stokes now. You can see a newsletter entry about it at https://mooseframework.inl.gov/newsletter/2025/2025_06.html. ", "mimetype": "text/plain", "start_char_idx": 0, "end_char_idx": 4848, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "67b40c80-510d-4eb2-88b8-8270e090b106": {"__data__": {"id_": "67b40c80-510d-4eb2-88b8-8270e090b106", "embedding": null, "metadata": {"title": "Shallow Water Equations and Moose Vector Variables", "url": "https://github.com/idaholab/moose/discussions/19356"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "3c50ebd1-3e49-47f1-9407-0631faa4ffa7", "node_type": "4", "metadata": {"title": "Shallow Water Equations and Moose Vector Variables", "url": "https://github.com/idaholab/moose/discussions/19356"}, "hash": "fe7bdbfb0c1226a62473d918ebb8c591a653eca28a26a4534e5a4a21e5cc2ac1", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "2ef2c3f6-5ea4-4136-9d17-a498bd430278", "node_type": "1", "metadata": {"title": "Shallow Water Equations and Moose Vector Variables", "url": "https://github.com/idaholab/moose/discussions/19356"}, "hash": "df34c718b4845e09b7aca3d9af1bda8e5f3e1009558c2c31e3d2b9d80f3ebc28", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "b00e0f04-37df-481a-bcd5-0744578a070c", "node_type": "1", "metadata": {}, "hash": "ad745290f8f6fe5451fce132952d8bf6f6f84f187af691b44d74a61cd1ee3976", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "I would really like a non-hybridized DG implementation of Navier-Stokes as well\nI'm stoked to here about this. What project is this for?\n\n", "mimetype": "text/plain", "start_char_idx": 4848, "end_char_idx": 4986, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "b00e0f04-37df-481a-bcd5-0744578a070c": {"__data__": {"id_": "b00e0f04-37df-481a-bcd5-0744578a070c", "embedding": null, "metadata": {"title": "Shallow Water Equations and Moose Vector Variables", "url": "https://github.com/idaholab/moose/discussions/19356"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "3c50ebd1-3e49-47f1-9407-0631faa4ffa7", "node_type": "4", "metadata": {"title": "Shallow Water Equations and Moose Vector Variables", "url": "https://github.com/idaholab/moose/discussions/19356"}, "hash": "fe7bdbfb0c1226a62473d918ebb8c591a653eca28a26a4534e5a4a21e5cc2ac1", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "67b40c80-510d-4eb2-88b8-8270e090b106", "node_type": "1", "metadata": {"title": "Shallow Water Equations and Moose Vector Variables", "url": "https://github.com/idaholab/moose/discussions/19356"}, "hash": "15955b95596bfd9fa6542d07cf55ee8cf637c18fa655889510c229b738e2b7a3", "class_name": "RelatedNodeInfo"}, "3": {"node_id": "30daf5ff-8a46-4f59-aa3f-d6b0a510c1f0", "node_type": "1", "metadata": {}, "hash": "ea84fbd6d9a0d3b189ab6660061b484ca198a3d8f21d28ad326be97c6e604e7c", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "Its... for the AI pilot program. The module is made using Codex as a trial for how far I can get running on ignorance and a few million API tokens...\nAnd it turns out: pretty far.\nI need to clean up some idiosyncrasies in the code, HLLC is just 1D right now, but HLL(E) looks  pretty good so far.\n", "mimetype": "text/plain", "start_char_idx": 4986, "end_char_idx": 5283, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}, "30daf5ff-8a46-4f59-aa3f-d6b0a510c1f0": {"__data__": {"id_": "30daf5ff-8a46-4f59-aa3f-d6b0a510c1f0", "embedding": null, "metadata": {"title": "Shallow Water Equations and Moose Vector Variables", "url": "https://github.com/idaholab/moose/discussions/19356"}, "excluded_embed_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "excluded_llm_metadata_keys": ["file_name", "file_type", "file_size", "creation_date", "last_modified_date", "last_accessed_date"], "relationships": {"1": {"node_id": "3c50ebd1-3e49-47f1-9407-0631faa4ffa7", "node_type": "4", "metadata": {"title": "Shallow Water Equations and Moose Vector Variables", "url": "https://github.com/idaholab/moose/discussions/19356"}, "hash": "fe7bdbfb0c1226a62473d918ebb8c591a653eca28a26a4534e5a4a21e5cc2ac1", "class_name": "RelatedNodeInfo"}, "2": {"node_id": "b00e0f04-37df-481a-bcd5-0744578a070c", "node_type": "1", "metadata": {"title": "Shallow Water Equations and Moose Vector Variables", "url": "https://github.com/idaholab/moose/discussions/19356"}, "hash": "8a5058fa596b99e5bae2d0c92a494ce69237c098edbb89868f1c9a48254f21ee", "class_name": "RelatedNodeInfo"}}, "metadata_template": "{key}: {value}", "metadata_separator": "\n", "text": "Have you looked at the HLLC implementation in FV? https://mooseframework.inl.gov/source/fvkernels/CNSFVHLLCBase.html is probably the best doc page\n", "mimetype": "text/plain", "start_char_idx": 5283, "end_char_idx": 5430, "metadata_seperator": "\n", "text_template": "{metadata_str}\n\n{content}", "class_name": "TextNode"}, "__type__": "1"}}, "docstore/metadata": {"2ef2c3f6-5ea4-4136-9d17-a498bd430278": {"doc_hash": "df34c718b4845e09b7aca3d9af1bda8e5f3e1009558c2c31e3d2b9d80f3ebc28", "ref_doc_id": "3c50ebd1-3e49-47f1-9407-0631faa4ffa7"}, "67b40c80-510d-4eb2-88b8-8270e090b106": {"doc_hash": "15955b95596bfd9fa6542d07cf55ee8cf637c18fa655889510c229b738e2b7a3", "ref_doc_id": "3c50ebd1-3e49-47f1-9407-0631faa4ffa7"}, "b00e0f04-37df-481a-bcd5-0744578a070c": {"doc_hash": "8a5058fa596b99e5bae2d0c92a494ce69237c098edbb89868f1c9a48254f21ee", "ref_doc_id": "3c50ebd1-3e49-47f1-9407-0631faa4ffa7"}, "30daf5ff-8a46-4f59-aa3f-d6b0a510c1f0": {"doc_hash": "e46dfd23f0550d4c10aa4e95ea3b38fa09105ca1574336631aa07c403bbc9f4f", "ref_doc_id": "3c50ebd1-3e49-47f1-9407-0631faa4ffa7"}}}